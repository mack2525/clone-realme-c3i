;/*!visitor/common/lib/json3.js*/
(function(){function c(a,exports){function g(c){if(g[c]!==_)return g[c];var a;if("bug-string-char-index"==c)a="a"!="a"[0];else if("json"==c)a=g("json-stringify")&&g("json-parse");else{var h,y='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==c){var C=exports.stringify,O="function"==typeof C&&M;if(O){(h=function(){return 1}).toJSON=h;try{O="0"===C(0)&&"0"===C(new b)&&'""'==C(new v)&&C(U)===_&&C(_)===_&&C()===_&&"1"===C(h)&&"[1]"==C([h])&&"[null]"==C([_])&&"null"==C(null)&&"[null,null,null]"==C([_,U,null])&&C({a:[h,!0,!1,null,"\x00\b\n\f\r	"]})==y&&"1"===C(null,h)&&"[\n 1,\n 2\n]"==C([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==C(new S(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==C(new S(864e13))&&'"-000001-01-01T00:00:00.000Z"'==C(new S(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==C(new S(-1))}catch(j){O=!1}}a=O}if("json-parse"==c){var w=exports.parse;if("function"==typeof w)try{if(0===w("0")&&!w(!1)){h=w(y);var T=5==h.a.length&&1===h.a[0];if(T){try{T=!w('"	"')}catch(j){}if(T)try{T=1!==w("01")}catch(j){}if(T)try{T=1!==w("1.")}catch(j){}}}}catch(j){T=!1}a=T}}return g[c]=!!a}a||(a=y.Object()),exports||(exports=y.Object());var b=a.Number||y.Number,v=a.String||y.String,C=a.Object||y.Object,S=a.Date||y.Date,O=a.SyntaxError||y.SyntaxError,j=a.TypeError||y.TypeError,w=a.Math||y.Math,T=a.JSON||y.JSON;"object"==typeof T&&T&&(exports.stringify=T.stringify,exports.parse=T.parse);var A,N,_,J=C.prototype,U=J.toString,M=new S(-0xc782b5b800cec);try{M=-109252==M.getUTCFullYear()&&0===M.getUTCMonth()&&1===M.getUTCDate()&&10==M.getUTCHours()&&37==M.getUTCMinutes()&&6==M.getUTCSeconds()&&708==M.getUTCMilliseconds()}catch(k){}if(!g("json")){var D="[object Function]",E="[object Date]",P="[object Number]",Z="[object String]",F="[object Array]",$="[object Boolean]",H=g("bug-string-char-index");if(!M)var I=w.floor,Y=[0,31,59,90,120,151,181,212,243,273,304,334],B=function(c,a){return Y[a]+365*(c-1970)+I((c-1969+(a=+(a>1)))/4)-I((c-1901+a)/100)+I((c-1601+a)/400)};if((A=J.hasOwnProperty)||(A=function(c){var a,h={};return(h.__proto__=null,h.__proto__={toString:1},h).toString!=U?A=function(c){var a=this.__proto__,h=c in(this.__proto__=null,this);return this.__proto__=a,h}:(a=h.constructor,A=function(c){var h=(this.constructor||a).prototype;return c in this&&!(c in h&&this[c]===h[c])}),h=null,A.call(this,c)}),N=function(c,a){var g,y,b,v=0;(g=function(){this.valueOf=0}).prototype.valueOf=0,y=new g;for(b in y)A.call(y,b)&&v++;return g=y=null,v?N=2==v?function(c,a){var h,g={},y=U.call(c)==D;for(h in c)y&&"prototype"==h||A.call(g,h)||!(g[h]=1)||!A.call(c,h)||a(h)}:function(c,a){var h,g,y=U.call(c)==D;for(h in c)y&&"prototype"==h||!A.call(c,h)||(g="constructor"===h)||a(h);(g||A.call(c,h="constructor"))&&a(h)}:(y=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],N=function(c,a){var g,b,v=U.call(c)==D,C=!v&&"function"!=typeof c.constructor&&h[typeof c.hasOwnProperty]&&c.hasOwnProperty||A;for(g in c)v&&"prototype"==g||!C.call(c,g)||a(g);for(b=y.length;g=y[--b];C.call(c,g)&&a(g));}),N(c,a)},!g("json-stringify")){var L={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},z="000000",G=function(c,a){return(z+(a||0)).slice(-c)},K="\\u00",Q=function(c){for(var a='"',h=0,g=c.length,y=!H||g>10,b=y&&(H?c.split(""):c);g>h;h++){var v=c.charCodeAt(h);switch(v){case 8:case 9:case 10:case 12:case 13:case 34:case 92:a+=L[v];break;default:if(32>v){a+=K+G(2,v.toString(16));break}a+=y?b[h]:c.charAt(h)}}return a+'"'},R=function(c,a,h,g,y,b,v){var C,S,O,w,T,J,M,k,D,H,Y,L,z,K,V,W;try{C=a[c]}catch(X){}if("object"==typeof C&&C)if(S=U.call(C),S!=E||A.call(C,"toJSON"))"function"==typeof C.toJSON&&(S!=P&&S!=Z&&S!=F||A.call(C,"toJSON"))&&(C=C.toJSON(c));else if(C>-1/0&&1/0>C){if(B){for(T=I(C/864e5),O=I(T/365.2425)+1970-1;B(O+1,0)<=T;O++);for(w=I((T-B(O,0))/30.42);B(O,w+1)<=T;w++);T=1+T-B(O,w),J=(C%864e5+864e5)%864e5,M=I(J/36e5)%24,k=I(J/6e4)%60,D=I(J/1e3)%60,H=J%1e3}else O=C.getUTCFullYear(),w=C.getUTCMonth(),T=C.getUTCDate(),M=C.getUTCHours(),k=C.getUTCMinutes(),D=C.getUTCSeconds(),H=C.getUTCMilliseconds();C=(0>=O||O>=1e4?(0>O?"-":"+")+G(6,0>O?-O:O):G(4,O))+"-"+G(2,w+1)+"-"+G(2,T)+"T"+G(2,M)+":"+G(2,k)+":"+G(2,D)+"."+G(3,H)+"Z"}else C=null;if(h&&(C=h.call(a,c,C)),null===C)return"null";if(S=U.call(C),S==$)return""+C;if(S==P)return C>-1/0&&1/0>C?""+C:"null";if(S==Z)return Q(""+C);if("object"==typeof C){for(K=v.length;K--;)if(v[K]===C)throw j();if(v.push(C),Y=[],V=b,b+=y,S==F){for(z=0,K=C.length;K>z;z++)L=R(z,C,h,g,y,b,v),Y.push(L===_?"null":L);W=Y.length?y?"[\n"+b+Y.join(",\n"+b)+"\n"+V+"]":"["+Y.join(",")+"]":"[]"}else N(g||C,function(c){var a=R(c,C,h,g,y,b,v);a!==_&&Y.push(Q(c)+":"+(y?" ":"")+a)}),W=Y.length?y?"{\n"+b+Y.join(",\n"+b)+"\n"+V+"}":"{"+Y.join(",")+"}":"{}";return v.pop(),W}};exports.stringify=function(c,a,g){var y,b,v,C;if(h[typeof a]&&a)if((C=U.call(a))==D)b=a;else if(C==F){v={};for(var S,O=0,j=a.length;j>O;S=a[O++],C=U.call(S),(C==Z||C==P)&&(v[S]=1));}if(g)if((C=U.call(g))==P){if((g-=g%1)>0)for(y="",g>10&&(g=10);y.length<g;y+=" ");}else C==Z&&(y=g.length<=10?g:g.slice(0,10));return R("",(S={},S[""]=c,S),b,v,y,"",[])}}if(!g("json-parse")){var V,W,X=v.fromCharCode,te={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},ee=function(){throw V=W=null,O()},oe=function(){for(var c,a,h,g,y,b=W,v=b.length;v>V;)switch(y=b.charCodeAt(V)){case 9:case 10:case 13:case 32:V++;break;case 123:case 125:case 91:case 93:case 58:case 44:return c=H?b.charAt(V):b[V],V++,c;case 34:for(c="@",V++;v>V;)if(y=b.charCodeAt(V),32>y)ee();else if(92==y)switch(y=b.charCodeAt(++V)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:c+=te[y],V++;break;case 117:for(a=++V,h=V+4;h>V;V++)y=b.charCodeAt(V),y>=48&&57>=y||y>=97&&102>=y||y>=65&&70>=y||ee();c+=X("0x"+b.slice(a,V));break;default:ee()}else{if(34==y)break;for(y=b.charCodeAt(V),a=V;y>=32&&92!=y&&34!=y;)y=b.charCodeAt(++V);c+=b.slice(a,V)}if(34==b.charCodeAt(V))return V++,c;ee();default:if(a=V,45==y&&(g=!0,y=b.charCodeAt(++V)),y>=48&&57>=y){for(48==y&&(y=b.charCodeAt(V+1),y>=48&&57>=y)&&ee(),g=!1;v>V&&(y=b.charCodeAt(V),y>=48&&57>=y);V++);if(46==b.charCodeAt(V)){for(h=++V;v>h&&(y=b.charCodeAt(h),y>=48&&57>=y);h++);h==V&&ee(),V=h}if(y=b.charCodeAt(V),101==y||69==y){for(y=b.charCodeAt(++V),(43==y||45==y)&&V++,h=V;v>h&&(y=b.charCodeAt(h),y>=48&&57>=y);h++);h==V&&ee(),V=h}return+b.slice(a,V)}if(g&&ee(),"true"==b.slice(V,V+4))return V+=4,!0;if("false"==b.slice(V,V+5))return V+=5,!1;if("null"==b.slice(V,V+4))return V+=4,null;ee()}return"$"},ie=function(c){var a,h;if("$"==c&&ee(),"string"==typeof c){if("@"==(H?c.charAt(0):c[0]))return c.slice(1);if("["==c){for(a=[];c=oe(),"]"!=c;h||(h=!0))h&&(","==c?(c=oe(),"]"==c&&ee()):ee()),","==c&&ee(),a.push(ie(c));return a}if("{"==c){for(a={};c=oe(),"}"!=c;h||(h=!0))h&&(","==c?(c=oe(),"}"==c&&ee()):ee()),(","==c||"string"!=typeof c||"@"!=(H?c.charAt(0):c[0])||":"!=oe())&&ee(),a[c.slice(1)]=ie(oe());return a}ee()}return c},ce=function(c,a,h){var g=ae(c,a,h);g===_?delete c[a]:c[a]=g},ae=function(c,a,h){var g,y=c[a];if("object"==typeof y&&y)if(U.call(y)==F)for(g=y.length;g--;)ce(y,g,h);else N(y,function(c){ce(y,c,h)});return h.call(c,a,y)};exports.parse=function(c,a){var h,g;return V=0,W=""+c,h=ie(oe()),"$"!=oe()&&ee(),V=W=null,a&&U.call(a)==D?ae((g={},g[""]=h,g),"",a):h}}}return exports.runInContext=c,exports}var a="function"==typeof define&&define.amd,h={"function":!0,object:!0},g=h[typeof exports]&&exports&&!exports.nodeType&&exports,y=h[typeof window]&&window||this,b=g&&h[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(y&&(!b||b.global!==b&&b.window!==b&&b.self!==b||(y=b)),g&&!a)c(y,g);else{var v=y.JSON,C=y.JSON3,S=!1,O=c(y,y.JSON3={noConflict:function(){return S||(S=!0,y.JSON=v,y.JSON3=C,v=C=null),O}});y.JSON?(y.JSON.parse||(y.JSON.parse=O.parse),y.JSON.stringify||(y.JSON.stringify=O.stringify)):y.JSON={parse:O.parse,stringify:O.stringify}}}).call(this);
;/*!visitor/common/js/cometd.js*/
(function(){this.org=this.org||{},org.cometd={},org.cometd.JSON={},org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(){throw"Abstract"},org.cometd.Utils={},org.cometd.Utils.isString=function(a){return void 0===a||null===a?!1:"string"==typeof a||a instanceof String},org.cometd.Utils.isArray=function(a){return void 0===a||null===a?!1:a instanceof Array},org.cometd.Utils.inArray=function(a,c){for(var i=0;i<c.length;++i)if(a===c[i])return i;return-1},org.cometd.Utils.setTimeout=function(a,c,g){return window.setTimeout(function(){try{a._debug("Invoking timed function",c),c()}catch(x){a._debug("Exception invoking timed function",c,x)}},g)},org.cometd.Utils.clearTimeout=function(a){window.clearTimeout(a)},org.cometd.TransportRegistry=function(){var a=[],c={};this.getTransportTypes=function(){return a.slice(0)},this.findTransportTypes=function(g,h,v){for(var b=[],i=0;i<a.length;++i){var T=a[i];c[T].accept(g,h,v)===!0&&b.push(T)}return b},this.negotiateTransport=function(g,h,v,b){for(var i=0;i<a.length;++i)for(var T=a[i],y=0;y<g.length;++y)if(T===g[y]){var _=c[T];if(_.accept(h,v,b)===!0)return _}return null},this.add=function(g,h,v){for(var b=!1,i=0;i<a.length;++i)if(a[i]===g){b=!0;break}return b||("number"!=typeof v?a.push(g):a.splice(v,0,g),c[g]=h),!b},this.find=function(g){for(var i=0;i<a.length;++i)if(a[i]===g)return c[g];return null},this.remove=function(g){for(var i=0;i<a.length;++i)if(a[i]===g){a.splice(i,1);var h=c[g];return delete c[g],h}return null},this.clear=function(){a=[],c={}},this.reset=function(){for(var i=0;i<a.length;++i)c[a[i]].reset()}},org.cometd.Transport=function(){var a,c;this.registered=function(g,h){a=g,c=h},this.unregistered=function(){a=null,c=null},this._debug=function(){c._debug.apply(c,arguments)},this._mixin=function(){return c._mixin.apply(c,arguments)},this.getConfiguration=function(){return c.getConfiguration()},this.getAdvice=function(){return c.getAdvice()},this.setTimeout=function(a,g){return org.cometd.Utils.setTimeout(c,a,g)},this.clearTimeout=function(a){org.cometd.Utils.clearTimeout(a)},this.convertToMessages=function(a){if(org.cometd.Utils.isString(a))try{return org.cometd.JSON.fromJSON(a)}catch(x){throw this._debug("Could not convert to JSON the following string",'"'+a+'"'),x}if(org.cometd.Utils.isArray(a))return a;if(void 0===a||null===a)return[];if(a instanceof Object)return[a];throw"Conversion Error "+a+", typeof "+typeof a},this.accept=function(){throw"Abstract"},this.getType=function(){return a},this.send=function(){throw"Abstract"},this.reset=function(){this._debug("Transport",a,"reset")},this.abort=function(){this._debug("Transport",a,"aborted")},this.toString=function(){return this.getType()}},org.cometd.Transport.derive=function(a){function c(){}return c.prototype=a,new c},org.cometd.RequestTransport=function(){function a(a){for(;C.length>0;){var c=C[0],g=c[0],h=c[1];if(g.url!==a.url||g.sync!==a.sync)break;C.shift(),a.messages=a.messages.concat(g.messages),this._debug("Coalesced",g.messages.length,"messages from request",h.id)}}function c(a,c){if(this.transportSend(a,c),c.expired=!1,!a.sync){var g=this.getConfiguration().maxNetworkDelay,h=g;c.metaConnect===!0&&(h+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",h,"ms for the response, maxNetworkDelay",g);var v=this;c.timeout=this.setTimeout(function(){c.expired=!0;var g="Request "+c.id+" of transport "+v.getType()+" exceeded "+h+" ms max network delay",b={reason:g},T=c.xhr;b.httpCode=v.xhrStatus(T),v.abortXHR(T),v._debug(g),v.complete(c,!1,c.metaConnect),a.onFailure(T,a.messages,b)},h)}}function g(a){var g=++_,h={id:g,metaConnect:!1,envelope:a};k.length<this.getConfiguration().maxConnections-1?(k.push(h),c.call(this,a,h)):(this._debug("Transport",this.getType(),"queueing request",g,"envelope",a),C.push([a,h]))}function h(a){var c=a.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",c),null!==w&&w.id!==c)throw"Longpoll request mismatch, completing request "+c;w=null}function v(c,h){var v=org.cometd.Utils.inArray(c,k);if(v>=0&&k.splice(v,1),C.length>0){var b=C.shift(),T=b[0],y=b[1];if(this._debug("Transport dequeued request",y.id),h)this.getConfiguration().autoBatch&&a.call(this,T),g.call(this,T),this._debug("Transport completed request",c.id,T);else{var _=this;this.setTimeout(function(){_.complete(y,!1,y.metaConnect);var a={reason:"Previous request failed"},c=y.xhr;a.httpCode=_.xhrStatus(c),T.onFailure(c,T.messages,a)},0)}}}function b(a){if(null!==w)throw"Concurrent metaConnect requests not allowed, request id="+w.id+" not yet completed";var g=++_;this._debug("Transport",this.getType(),"metaConnect send, request",g,"envelope",a);var h={id:g,metaConnect:!0,envelope:a};c.call(this,a,h),w=h}var T=new org.cometd.Transport,y=org.cometd.Transport.derive(T),_=0,w=null,k=[],C=[];return y.complete=function(a,c,g){g?h.call(this,a):v.call(this,a,c)},y.transportSend=function(){throw"Abstract"},y.transportSuccess=function(a,c,g){c.expired||(this.clearTimeout(c.timeout),this.complete(c,!0,c.metaConnect),g&&g.length>0?a.onSuccess(g):a.onFailure(c.xhr,a.messages,{httpCode:204}))},y.transportFailure=function(a,c,g){c.expired||(this.clearTimeout(c.timeout),this.complete(c,!1,c.metaConnect),a.onFailure(c.xhr,a.messages,g))},y.send=function(a,c){c?b.call(this,a):g.call(this,a)},y.abort=function(){T.abort();for(var i=0;i<k.length;++i){var a=k[i];a&&(this._debug("Aborting request",a),this.abortXHR(a.xhr)||this.transportFailure(a.envelope,a,{reason:"abort"}))}w&&(this._debug("Aborting metaConnect request",w),this.abortXHR(w.xhr)||this.transportFailure(w.envelope,w,{reason:"abort"})),this.reset()},y.reset=function(){T.reset(),w=null,k=[],C=[]},y.abortXHR=function(a){if(a)try{var c=a.readyState;return a.abort(),c!==XMLHttpRequest.UNSENT}catch(x){this._debug(x)}return!1},y.xhrStatus=function(a){if(a)try{return a.status}catch(x){this._debug(x)}return-1},y},org.cometd.LongPollingTransport=function(){var a=new org.cometd.RequestTransport,c=org.cometd.Transport.derive(a),g=!0;return c.accept=function(a,c){return g||!c},c.xhrSend=function(){throw"Abstract"},c.transportSend=function(a,c){this._debug("Transport",this.getType(),"sending request",c.id,"envelope",a);var h=this;try{var v=!0;c.xhr=this.xhrSend({transport:this,url:a.url,sync:a.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(a.messages),onSuccess:function(v){h._debug("Transport",h.getType(),"received response",v);var b=!1;try{var T=h.convertToMessages(v);0===T.length?(g=!1,h.transportFailure(a,c,{httpCode:204})):(b=!0,h.transportSuccess(a,c,T))}catch(x){if(h._debug(x),!b){g=!1;var y={exception:x};y.httpCode=h.xhrStatus(c.xhr),h.transportFailure(a,c,y)}}},onError:function(b,T){h._debug("Transport",h.getType(),"received error",b,T),g=!1;var y={reason:b,exception:T};y.httpCode=h.xhrStatus(c.xhr),v?h.setTimeout(function(){h.transportFailure(a,c,y)},0):h.transportFailure(a,c,y)}}),v=!1}catch(x){g=!1,this.setTimeout(function(){h.transportFailure(a,c,{exception:x})},0)}},c.reset=function(){a.reset(),g=!0},c},org.cometd.CallbackPollingTransport=function(){function a(a,c,x){var g=this;return function(){g.transportFailure(a,c,"error",x)}}var c=new org.cometd.RequestTransport,g=org.cometd.Transport.derive(c),h=2e3;return g.accept=function(){return!0},g.jsonpSend=function(){throw"Abstract"},g.transportSend=function(c,g){for(var v=this,b=0,T=c.messages.length,y=[];T>0;){var _=org.cometd.JSON.toJSON(c.messages.slice(b,b+T)),w=c.url.length+encodeURI(_).length;if(w>h){if(1===T){var x="Bayeux message too big ("+w+" bytes, max is "+h+") for transport "+this.getType();return void this.setTimeout(a.call(this,c,g,x),0)}--T}else y.push(T),b+=T,T=c.messages.length-b}var k=c;if(y.length>1){var C=0,S=y[0];this._debug("Transport",this.getType(),"split",c.messages.length,"messages into",y.join(" + ")),k=this._mixin(!1,{},c),k.messages=c.messages.slice(C,S),k.onSuccess=c.onSuccess,k.onFailure=c.onFailure;for(var i=1;i<y.length;++i){var U=this._mixin(!1,{},c);C=S,S+=y[i],U.messages=c.messages.slice(C,S),U.onSuccess=c.onSuccess,U.onFailure=c.onFailure,this.send(U,g.metaConnect)}}this._debug("Transport",this.getType(),"sending request",g.id,"envelope",k);try{var I=!0;this.jsonpSend({transport:this,url:k.url,sync:k.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(k.messages),onSuccess:function(a){var c=!1;try{var h=v.convertToMessages(a);0===h.length?v.transportFailure(k,g,{httpCode:204}):(c=!0,v.transportSuccess(k,g,h))}catch(x){v._debug(x),c||v.transportFailure(k,g,{exception:x})}},onError:function(a,c){var h={reason:a,exception:c};I?v.setTimeout(function(){v.transportFailure(k,g,h)},0):v.transportFailure(k,g,h)}}),I=!1}catch(R){this.setTimeout(function(){v.transportFailure(k,g,{exception:R})},0)}},g},org.cometd.WebSocketTransport=function(){function a(){if(!C){C=!0;var a=h.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",a);var c;try{var g=h.getConfiguration().protocol;c=g?new org.cometd.WebSocket(a,g):new org.cometd.WebSocket(a)}catch(x){throw T=!1,this._debug("Exception while creating WebSocket object",x),x}_=h.getConfiguration().stickyReconnect!==!1;var v=this,b=null,y=h.getConfiguration().connectTimeout;y>0&&(b=this.setTimeout(function(){b=null,v._debug("Transport",v.getType(),"timed out while connecting to URL",a,":",y,"ms");var g={code:1e3,reason:"Connect Timeout"};v.webSocketClose(c,g.code,g.reason),v.onClose(c,g)},y));var w=function(){v._debug("WebSocket opened",c),C=!1,b&&(v.clearTimeout(b),b=null),S?(h._warn("Closing Extra WebSocket Connections",c,S),v.webSocketClose(c,1e3,"Extra Connection")):v.onOpen(c)},k=function(a){a=a||{code:1e3},v._debug("WebSocket closing",c,a),C=!1,b&&(v.clearTimeout(b),b=null),null!==S&&c!==S?v._debug("Closed Extra WebSocket Connection",c):v.onClose(c,a)},U=function(a){v._debug("WebSocket message",a,c),c!==S&&h._warn("Extra WebSocket Connections",c,S),v.onMessage(c,a)};c.onopen=w,c.onclose=k,c.onerror=function(){k({code:1002,reason:"Error"})},c.onmessage=U,this._debug("Transport",this.getType(),"configured callbacks on",c)}}function c(a,c,g){var h=org.cometd.JSON.toJSON(c.messages);a.send(h),this._debug("Transport",this.getType(),"sent",c,"metaConnect =",g);var v=this.getConfiguration().maxNetworkDelay,b=v;g&&(b+=this.getAdvice().timeout,U=!0);for(var T=this,y=[],i=0;i<c.messages.length;++i)!function(){var g=c.messages[i];g.id&&(y.push(g.id),k[g.id]=this.setTimeout(function(){T._debug("Transport",T.getType(),"timing out message",g.id,"after",b,"on",a);var c={code:1e3,reason:"Message Timeout"};T.webSocketClose(a,c.code,c.reason),T.onClose(a,c)},b))}();this._debug("Transport",this.getType(),"waiting at most",b,"ms for messages",y,"maxNetworkDelay",v,", timeouts:",k)}function g(g,h,v){try{null===g?a.call(this):c.call(this,g,h,v)}catch(x){this.setTimeout(function(){h.onFailure(g,h.messages,{exception:x})},0)}}var h,v=new org.cometd.Transport,b=org.cometd.Transport.derive(v),T=!0,y=!1,_=!0,w={},k={},C=!1,S=null,U=!1,I=null;return b.reset=function(){v.reset(),T=!0,y=!1,_=!0,w={},k={},C=!1,U=!1},b.onOpen=function(a){this._debug("Transport",this.getType(),"opened",a),S=a,y=!0,this._debug("Sending pending messages",w);for(var g in w){var h=w[g],v=h[0];if(v){var b=h[1];I=v.onSuccess,c.call(this,a,v,b)}}},b.onMessage=function(a,c){this._debug("Transport",this.getType(),"received websocket message",c,a);for(var g=!1,h=this.convertToMessages(c.data),v=[],i=0;i<h.length;++i){var b=h[i];if((/^\/meta\//.test(b.channel)||void 0===b.data)&&b.id){v.push(b.id);var T=k[b.id];T&&(this.clearTimeout(T),delete k[b.id],this._debug("Transport",this.getType(),"removed timeout for message",b.id,", timeouts",k))}"/meta/connect"===b.channel&&(U=!1),"/meta/disconnect"!==b.channel||U||(g=!0)}for(var y=!1,_=0;_<v.length;++_){var C=v[_];for(var S in w){var R=S.split(","),E=org.cometd.Utils.inArray(C,R);if(E>=0){y=!0,R.splice(E,1);var L=w[S][0],A=w[S][1];delete w[S],R.length>0&&(w[R.join(",")]=[L,A]);break}}}y&&this._debug("Transport",this.getType(),"removed envelope, envelopes",w),I.call(this,h),g&&this.webSocketClose(a,1e3,"Disconnect")},b.onClose=function(a,c){this._debug("Transport",this.getType(),"closed",a,c),T=_&&y;var g=k;k={};for(var h in g)this.clearTimeout(g[h]);var v=w;w={};for(var b in v){var C=v[b][0],I=v[b][1];I&&(U=!1),C.onFailure(a,C.messages,{websocketCode:c.code,reason:c.reason})}S=null},b.registered=function(a,c){v.registered(a,c),h=c},b.accept=function(){return T&&!!org.cometd.WebSocket&&h.websocketEnabled!==!1},b.send=function(a,c){this._debug("Transport",this.getType(),"sending",a,"metaConnect =",c);for(var h=[],i=0;i<a.messages.length;++i){var v=a.messages[i];v.id&&h.push(v.id)}w[h.join(",")]=[a,c],this._debug("Transport",this.getType(),"stored envelope, envelopes",w),g.call(this,S,a,c)},b.webSocketClose=function(a,c,g){try{a.close(c,g)}catch(x){this._debug(x)}},b.abort=function(){if(v.abort(),S){var a={code:1001,reason:"Abort"};this.webSocketClose(S,a.code,a.reason),this.onClose(S,a)}this.reset()},b},org.cometd.CometD=function(a){function c(a,c){try{return a[c]}catch(x){return void 0}}function g(a){return org.cometd.Utils.isString(a)}function h(a){return void 0===a||null===a?!1:"function"==typeof a}function v(a,c){for(var g="";--c>0&&!(a>=Math.pow(10,c));)g+="0";return g+=a}function b(a,c){if(window.console){var g=window.console[a];if(h(g)){var b=new Date;[].splice.call(c,0,0,v(b.getHours(),2)+":"+v(b.getMinutes(),2)+":"+v(b.getSeconds(),2)+"."+v(b.getMilliseconds(),3)),g.apply(window.console,c)}}}function T(a){kt._debug("Configuring cometd object with",a),g(a)&&(a={url:a}),a||(a={}),Ht=kt._mixin(!1,Ht,a);var c=kt.getURL();if(!c)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var h=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(c),v=h[2],b=h[8],T=h[9];if(St=kt._isCrossDomain(v),Ht.appendMessageTypeToURL)if(void 0!==T&&T.length>0)kt._info("Appending message type to URI "+b+T+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Ht.appendMessageTypeToURL=!1;else{var y=b.split("/"),_=y.length-1;b.match(/\/$/)&&(_-=1),y[_].indexOf(".")>=0&&(kt._info("Appending message type to URI "+b+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Ht.appendMessageTypeToURL=!1)}}function y(a){if(a){var c=Ft[a.channel];c&&c[a.id]&&(delete c[a.id],kt._debug("Removed",a.listener?"listener":"subscription",a))}}function _(a){a&&!a.listener&&y(a)}function w(){for(var a in Ft){var c=Ft[a];if(c)for(var i=0;i<c.length;++i)_(c[i])}}function k(a){It!==a&&(kt._debug("Status",It,"->",a),It=a)}function C(){return"disconnecting"===It||"disconnected"===It}function S(){var a=++Rt;return""+a}function U(a,c,g,v,b){try{return c.call(a,v)}catch(x){var T=kt.onExtensionException;if(h(T)){kt._debug("Invoking extension exception handler",g,x);try{T.call(kt,x,g,b,v)}catch(y){kt._info("Exception during execution of extension exception handler",g,y)}}else kt._info("Exception during execution of extension",g,x);return v}}function I(a){for(var i=0;i<Ot.length&&(void 0!==a&&null!==a);++i){var c=Ht.reverseIncomingExtensions?Ot.length-1-i:i,g=Ot[c],v=g.extension.incoming;if(h(v)){var b=U(g.extension,v,g.name,a,!1);a=void 0===b?a:b}}return a}function R(a){for(var i=0;i<Ot.length&&(void 0!==a&&null!==a);++i){var c=Ot[i],g=c.extension.outgoing;if(h(g)){var v=U(c.extension,g,c.name,a,!0);a=void 0===v?a:v}}return a}function E(a,c){var g=Ft[a];if(g&&g.length>0)for(var i=0;i<g.length;++i){var v=g[i];if(v)try{v.callback.call(v.scope,c)}catch(x){var b=kt.onListenerException;if(h(b)){kt._debug("Invoking listener exception handler",v,x);try{b.call(kt,x,v,v.listener,c)}catch(T){kt._info("Exception during execution of listener exception handler",v,T)}}else kt._info("Exception during execution of listener",v,c,x)}}}function L(a,c){E(a,c);for(var g=a.split("/"),h=g.length-1,i=h;i>0;--i){var v=g.slice(0,i).join("/")+"/*";i===h&&E(v,c),v+="*",E(v,c)}}function A(){null!==Mt&&org.cometd.Utils.clearTimeout(Mt),Mt=null}function F(a){A();var c=Bt.interval+Nt;kt._debug("Function scheduled in",c,"ms, interval =",Bt.interval,"backoff =",Nt,a),Mt=org.cometd.Utils.setTimeout(kt,a,c)}function N(a,c,g,h){for(var i=0;i<c.length;++i){var v=c[i],b=v.id;Et&&(v.clientId=Et),v=R(v),void 0!==v&&null!==v?(v.id=b,c[i]=v):(delete Jt[b],c.splice(i--,1))}if(0!==c.length){var T=kt.getURL();Ht.appendMessageTypeToURL&&(T.match(/\/$/)||(T+="/"),h&&(T+=h));var y={url:T,sync:a,messages:c,onSuccess:function(a){try{Xt.call(kt,a)}catch(x){kt._info("Exception during handling of messages",x)}},onFailure:function(a,c,g){try{var h=kt.getTransport();g.connectionType=h?h.getType():"unknown",Pt.call(kt,a,c,g)}catch(x){kt._info("Exception during handling of failure",x)}}};kt._debug("Send",y),_t.send(y,g)}}function M(a){qt>0||At===!0?Lt.push(a):N(!1,[a],!1)}function O(){Nt=0}function B(){Nt<Ht.maxBackoff&&(Nt+=Ht.backoffIncrement)}function J(){++qt,kt._debug("Starting batch, depth",qt)}function D(){var a=Lt;Lt=[],a.length>0&&N(!1,a,!1)}function W(){if(--qt,kt._debug("Ending batch, depth",qt),0>qt)throw"Calls to startBatch() and endBatch() are not paired";0!==qt||C()||At||D()}function j(){if(!C()){var a={id:S(),channel:"/meta/connect",connectionType:_t.getType()};jt||(a.advice={timeout:0}),k("connecting"),kt._debug("Connect sent",a),N(!1,[a],!0,"connect"),k("connected")}}function H(){k("connecting"),F(function(){j()})}function X(a){a&&(Bt=kt._mixin(!1,{},Ht.advice,a),kt._debug("New advice",Bt))}function P(a){if(A(),a&&_t&&_t.abort(),Et=null,k("disconnected"),qt=0,O(),_t=null,Lt.length>0){var c=Lt;Lt=[],Pt.call(kt,void 0,c,{reason:"Disconnected"})}}function z(a,c,g){var v=kt.onTransportException;if(h(v)){kt._debug("Invoking transport exception handler",a,c,g);try{v.call(kt,g,a,c)}catch(x){kt._info("Exception during execution of transport exception handler",x)}}}function $(a,c){h(a)&&(c=a,a=void 0),Et=null,w(),C()?(Ut.reset(),X(Ht.advice)):X(kt._mixin(!1,Bt,{reconnect:"retry"})),qt=0,At=!0,xt=a,wt=c;var g="1.0",v=kt.getURL(),b=Ut.findTransportTypes(g,St,v),T={id:S(),version:g,minimumVersion:g,channel:"/meta/handshake",supportedConnectionTypes:b,advice:{timeout:Bt.timeout,interval:Bt.interval}},y=kt._mixin(!1,{},xt,T);if(kt._putCallback(y.id,c),!_t&&(_t=Ut.negotiateTransport(b,g,St,v),!_t)){var _="Could not find initial transport among: "+Ut.getTransportTypes();throw kt._warn(_),_}kt._debug("Initial transport is",_t.getType()),k("handshaking"),kt._debug("Handshake sent",y),N(!1,[y],!1,"handshake")}function V(){k("handshaking"),At=!0,F(function(){$(xt,wt)})}function G(a,c){try{a.call(kt,c)}catch(x){var g=kt.onCallbackException;if(h(g)){kt._debug("Invoking callback exception handler",x);try{g.call(kt,x,c)}catch(v){kt._info("Exception during execution of callback exception handler",v)}}else kt._info("Exception during execution of message callback",x)}}function K(a){var c=kt._getCallback([a.id]);h(c)&&(delete Jt[a.id],G(c,a))}function Q(a){var c=Dt[a.id];if(delete Dt[a.id],kt._debug("Handling remote call response for",a,"with context",c),c){var g=c.timeout;g&&org.cometd.Utils.clearTimeout(g);var v=c.callback;if(h(v))return G(v,a),!0}return!1}function Y(a){K(a),L("/meta/handshake",a),L("/meta/unsuccessful",a);var c=!C()&&"none"!==Bt.reconnect;c?(B(),V()):P(!0)}function Z(a){if(a.successful){Et=a.clientId;var c=kt.getURL(),g=Ut.negotiateTransport(a.supportedConnectionTypes,a.version,St,c);if(null===g){var h="Could not negotiate transport with server; client=["+Ut.findTransportTypes(a.version,St,c)+"], server=["+a.supportedConnectionTypes+"]",v=kt.getTransport();return z(v.getType(),null,{reason:h,connectionType:v.getType(),transport:v}),kt._warn(h),void P(!0)}_t!==g&&(kt._debug("Transport",_t.getType(),"->",g.getType()),_t=g),At=!1,D(),a.reestablish=Wt,Wt=!0,K(a),L("/meta/handshake",a);var b=C()?"none":Bt.reconnect;switch(b){case"retry":O(),H();break;case"none":P(!0);break;default:throw"Unrecognized advice action "+b}}else Y(a)}function et(a){var c="1.0",g=kt.getURL(),h=kt.getTransport(),v=Ut.findTransportTypes(c,St,g),b=Ut.negotiateTransport(v,c,St,g);b?(kt._debug("Transport",h.getType(),"->",b.getType()),z(h.getType(),b.getType(),a.failure),Y(a),_t=b):(z(h.getType(),null,a.failure),kt._warn("Could not negotiate transport; client=["+v+"]"),P(!0),Y(a))}function tt(a){L("/meta/connect",a),L("/meta/unsuccessful",a);var c=C()?"none":Bt.reconnect;switch(c){case"retry":H(),B();break;case"handshake":Ut.reset(),O(),V();break;case"none":P(!0);break;default:throw"Unrecognized advice action"+c}}function nt(a){if(jt=a.successful){L("/meta/connect",a);var c=C()?"none":Bt.reconnect;switch(c){case"retry":O(),H();break;case"none":P(!1);break;default:throw"Unrecognized advice action "+c}}else tt(a)}function it(a){jt=!1,tt(a)}function ot(a){P(!0),K(a),L("/meta/disconnect",a),L("/meta/unsuccessful",a)}function st(a){a.successful?(P(!1),K(a),L("/meta/disconnect",a)):ot(a)}function at(a){ot(a)}function ct(a){var c=Ft[a.subscription];if(c)for(var i=c.length-1;i>=0;--i){var g=c[i];if(g&&!g.listener){delete c[i],kt._debug("Removed failed subscription",g);break}}K(a),L("/meta/subscribe",a),L("/meta/unsuccessful",a)}function ut(a){a.successful?(K(a),L("/meta/subscribe",a)):ct(a)}function lt(a){ct(a)}function gt(a){K(a),L("/meta/unsubscribe",a),L("/meta/unsuccessful",a)}function dt(a){a.successful?(K(a),L("/meta/unsubscribe",a)):gt(a)}function ht(a){gt(a)}function ft(a){Q(a)||(K(a),L("/meta/publish",a),L("/meta/unsuccessful",a))}function pt(a){void 0!==a.data?Q(a)||L(a.channel,a):void 0===a.successful?kt._warn("Unknown Bayeux Message",a):a.successful?(K(a),L("/meta/publish",a)):ft(a)}function mt(a){ft(a)}function vt(a){if(a=I(a),void 0!==a&&null!==a){X(a.advice);var c=a.channel;switch(c){case"/meta/handshake":Z(a);break;case"/meta/connect":nt(a);break;case"/meta/disconnect":st(a);break;case"/meta/subscribe":ut(a);break;case"/meta/unsubscribe":dt(a);break;default:pt(a)}}}function bt(a){var c=Ft[a];if(c)for(var i=0;i<c.length;++i)if(c[i])return!0;return!1}function Tt(a,c){var v={scope:a,method:c};if(h(a))v.scope=void 0,v.method=a;else if(g(c)){if(!a)throw"Invalid scope "+a;if(v.method=a[c],!h(v.method))throw"Invalid callback "+c+" for scope "+a}else if(!h(c))throw"Invalid callback "+c;return v}function yt(a,c,g,h){var v=Tt(c,g);kt._debug("Adding",h?"listener":"subscription","on",a,"with scope",v.scope,"and callback",v.method);var b={channel:a,scope:v.scope,callback:v.method,listener:h},T=Ft[a];return T||(T=[],Ft[a]=T),b.id=T.push(b)-1,kt._debug("Added",h?"listener":"subscription",b),b[0]=a,b[1]=b.id,b}var _t,xt,wt,kt=this,Ct=a||"default",St=!1,Ut=new org.cometd.TransportRegistry,It="disconnected",Rt=0,Et=null,qt=0,Lt=[],At=!1,Ft={},Nt=0,Mt=null,Ot=[],Bt={},Jt={},Dt={},Wt=!1,jt=!1,Ht={protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=function(a,g){for(var h=g||{},i=2;i<arguments.length;++i){var v=arguments[i];if(void 0!==v&&null!==v)for(var b in v){var T=c(v,b),y=c(h,b);if(T!==g&&void 0!==T)if(a&&"object"==typeof T&&null!==T)if(T instanceof Array)h[b]=this._mixin(a,y instanceof Array?y:[],T);else{var _="object"!=typeof y||y instanceof Array?{}:y;h[b]=this._mixin(a,_,T)}else h[b]=T}}return h},this._warn=function(){b("warn",arguments)},this._info=function(){"warn"!==Ht.logLevel&&b("info",arguments)},this._debug=function(){"debug"===Ht.logLevel&&b("debug",arguments)},this._isCrossDomain=function(a){return a&&a!==window.location.host};var Xt,Pt;this.send=M,this._getCallback=function(a){return Jt[a]},this._putCallback=function(a,c){var g=this._getCallback(a);return h(c)&&(Jt[a]=c),g},this.receive=vt,Xt=function(a){kt._debug("Received",a);for(var i=0;i<a.length;++i){var c=a[i];vt(c)}},Pt=function(a,c,g){kt._debug("handleFailure",a,c,g),g.transport=a;for(var i=0;i<c.length;++i){var h=c[i],v={id:h.id,successful:!1,channel:h.channel,failure:g};switch(g.message=h,h.channel){case"/meta/handshake":et(v);break;case"/meta/connect":it(v);break;case"/meta/disconnect":at(v);break;case"/meta/subscribe":v.subscription=h.subscription,lt(v);break;case"/meta/unsubscribe":v.subscription=h.subscription,ht(v);break;default:mt(v)}}},this.registerTransport=function(a,c,g){var v=Ut.add(a,c,g);return v&&(this._debug("Registered transport",a),h(c.registered)&&c.registered(a,this)),v},this.getTransportTypes=function(){return Ut.getTransportTypes()},this.unregisterTransport=function(a){var c=Ut.remove(a);return null!==c&&(this._debug("Unregistered transport",a),h(c.unregistered)&&c.unregistered()),c},this.unregisterTransports=function(){Ut.clear()},this.findTransport=function(a){return Ut.find(a)},this.configure=function(a){T.call(this,a)},this.init=function(a,c){this.configure(a),this.handshake(c)},this.handshake=function(a,c){k("disconnected"),Wt=!1,$(a,c)},this.disconnect=function(a,c,g){if(!C()){"boolean"!=typeof a&&(g=c,c=a,a=!1),h(c)&&(g=c,c=void 0);var v={id:S(),channel:"/meta/disconnect"},b=this._mixin(!1,{},c,v);kt._putCallback(b.id,g),k("disconnecting"),N(a===!0,[b],!1,"disconnect")}},this.startBatch=function(){J()},this.endBatch=function(){W()},this.batch=function(a,c){var g=Tt(a,c);this.startBatch();try{g.method.call(g.scope),this.endBatch()}catch(x){throw this._info("Exception during execution of batch",x),this.endBatch(),x}},this.addListener=function(a,c,h){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!g(a))throw"Illegal argument type: channel must be a string";return yt(a,c,h,!0)},this.removeListener=function(a){if(!(a&&a.channel&&"id"in a))throw"Invalid argument: expected subscription, not "+a;y(a)},this.clearListeners=function(){Ft={}},this.subscribe=function(a,c,v,b,T){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!g(a))throw"Illegal argument type: channel must be a string";if(C())throw"Illegal state: already disconnected";h(c)&&(T=b,b=v,v=c,c=void 0),h(b)&&(T=b,b=void 0);var y=!bt(a),_=yt(a,c,v,!1);if(y){var w={id:S(),channel:"/meta/subscribe",subscription:a},k=this._mixin(!1,{},b,w);kt._putCallback(k.id,T),M(k)}return _},this.unsubscribe=function(a,c,g){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(C())throw"Illegal state: already disconnected";h(c)&&(g=c,c=void 0),this.removeListener(a);var v=a.channel;if(!bt(v)){var b={id:S(),channel:"/meta/unsubscribe",subscription:v},T=this._mixin(!1,{},c,b);kt._putCallback(T.id,g),M(T)}},this.resubscribe=function(a,c){return _(a),a?this.subscribe(a.channel,a.scope,a.callback,c):void 0},this.clearSubscriptions=function(){w()},this.publish=function(a,c,v,b){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!g(a))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(a))throw"Illegal argument: cannot publish to meta channels";if(C())throw"Illegal state: already disconnected";h(c)?(b=c,c=v={}):h(v)&&(b=v,v={});var T={id:S(),channel:a,data:c},y=this._mixin(!1,{},v,T);kt._putCallback(y.id,b),M(y)},this.remoteCall=function(a,c,v,b){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!g(a))throw"Illegal argument type: target must be a string";if(C())throw"Illegal state: already disconnected";if(h(c)?(b=c,c={},v=Ht.maxNetworkDelay):h(v)&&(b=v,v=Ht.maxNetworkDelay),"number"!=typeof v)throw"Illegal argument type: timeout must be a number";a.match(/^\//)||(a="/"+a);var T="/service"+a,y={id:S(),channel:T,data:c},_={callback:b};v>0&&(_.timeout=org.cometd.Utils.setTimeout(kt,function(){kt._debug("Timing out remote call",y,"after",v,"ms"),ft({id:y.id,error:"406::timeout",successful:!1,failure:{message:y,reason:"Remote Call Timeout"}})},v),kt._debug("Scheduled remote call timeout",y,"in",v,"ms")),Dt[y.id]=_,M(y)},this.getStatus=function(){return It},this.isDisconnected=C,this.setBackoffIncrement=function(a){Ht.backoffIncrement=a},this.getBackoffIncrement=function(){return Ht.backoffIncrement},this.getBackoffPeriod=function(){return Nt},this.setLogLevel=function(a){Ht.logLevel=a},this.registerExtension=function(a,c){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!g(a))throw"Illegal argument type: extension name must be a string";for(var v=!1,i=0;i<Ot.length;++i){var b=Ot[i];if(b.name===a){v=!0;break}}return v?(this._info("Could not register extension with name",a,"since another extension with the same name already exists"),!1):(Ot.push({name:a,extension:c}),this._debug("Registered extension",a),h(c.registered)&&c.registered(a,this),!0)},this.unregisterExtension=function(a){if(!g(a))throw"Illegal argument type: extension name must be a string";for(var c=!1,i=0;i<Ot.length;++i){var v=Ot[i];if(v.name===a){Ot.splice(i,1),c=!0,this._debug("Unregistered extension",a);var b=v.extension;h(b.unregistered)&&b.unregistered();break}}return c},this.getExtension=function(a){for(var i=0;i<Ot.length;++i){var c=Ot[i];if(c.name===a)return c.extension}return null},this.getName=function(){return Ct},this.getClientId=function(){return Et},this.getURL=function(){if(_t&&"object"==typeof Ht.urls){var a=Ht.urls[_t.getType()];if(a)return a}return Ht.url},this.getTransport=function(){return _t},this.getConfiguration=function(){return this._mixin(!0,{},Ht)},this.getAdvice=function(){return this._mixin(!0,{},Bt)},org.cometd.WebSocket=window.WebSocket}}).call(this);
;/*!visitor/common/js/query.js*/
!function(){var a=function(){function a(a){return a._zid||(a._zid=Nt++)}function c(a){!J.createElement;var c=J.createElement("div");try{return!!a(c)}catch(e){return!1}finally{c.parentNode&&c.parentNode.removeChild(c),c=null}}function h(a,c,g){var y=c&&c.ownerDocument,g=g||[];return a?a.nodeType||a==window.document||a==window?(this.context=a,this.results=[a],this.length=1,this):lt(a)?"undefined"!=typeof yt?this.readyList.push(a):a():a instanceof h?a:((c?c.ownerDocument||c:z)!==J&&H(c),c=c||J,this.selector=a,this.context=c,this.results=v(a,c,g,y),void(this.length=this.results.length)):(this.length=0,this.results=this.results||g,this)}function v(a,c,h,v){if(!a)return h;var m,i,g,y,E,N=c?c.nodeType:9;if(y=k.exec(a),11!==N&&(y=k.exec(a)))if(m=y[1]){if(9===N){if(!(g=c.getElementById(m)))return h;if(g.id===m)return h.push(g),h}else if(c.ownerDocument&&(g=c.ownerDocument.getElementById(m))&&I(c,g)&&g.id===m)return h.push(g),h}else{if(m=y[2])return(T=_.find.TAG(m,c))&&W.apply(h,T),h;if((m=y[3])&&G.getElementsByClassName&&c.getElementsByClassName)return W.apply(h,c.getElementsByClassName(m)),h}if(1!==N&&(v=c,E=a),E)try{return W.apply(h,v.querySelectorAll(E)),h}catch(w){}finally{}var b,T=_.find.TAG("*",c),C=T.length;if(i=0,b=y[2]){var S=[];if(h=c.getElementsByTagName(b),g=Et,"*"===b){for(;g=h[i++];)1===g.nodeType&&S.push(g);return S}return h}for(var B=tt.CLASS,L=B(y[3]);i!==C&&null!=(g=T[i]);i++)g&&1===g.nodeType&&L(g)&&h.push(g);return h}function g(a){return null==a?String(a):dt[ht.call(a)]||"object"}function y(a){return null!=a&&a==a.window}function E(a){return"object"==g(a)}function N(a,c,h){for(var v in c)h&&(pt(c[v])||ct(c[v]))?(pt(c[v])&&!pt(a[v])&&(a[v]={}),ct(c[v])&&!ct(a[v])&&(a[v]=[]),N(a[v],c[v],h)):c[v]!==Et&&(a[v]=c[v])}function a(a){return a._zid||(a._zid=Nt++)}function w(c,h,v,g){function y(c){return!(!c||h.e&&c.e!=h.e||h.ns&&!E.test(c.ns)||v&&a(c.fn)!==a(v)||g&&c.sel!=g)}if(h=b(h),h.ns)var E=T(h.ns);for(var N=wt[a(c)]||[],w=[],i=0;i<N.length;i++)y(N[i])&&w.push(N[i]);return w}function b(a){var c=(""+a).split(".");return{e:c[0],ns:c.slice(1).sort().join(" ")}}function T(a){return new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)")}function C(a,c){return a.del&&!xt&&a.e in Tt||!!c}function S(a){return Ct[a]||xt&&Tt[a]||a}function B(c,h,v,g,y,E,N){var w=a(c),T=wt[w]||(wt[w]=[]);P.fn.each(h.split(/\s/),function(i,a){if("ready"==a)return P(J).ready(v);var h=b(a);h.fn=v,h.sel=y,h.e in Ct&&(v=function(e){var a=e.relatedTarget;return!a||a!==this&&!P.contains(this,a)?h.fn.apply(this,arguments):void 0}),h.del=E;var w=E||v;h.proxy=function(e){if(e=j(e),!e.isImmediatePropagationStopped()){e.data=g;var a=w.apply(c,e._args==Et?[e]:[e].concat(e._args));return a===!1&&(e.preventDefault(),e.stopPropagation()),a}},h.i=T.length,T.push(h),"addEventListener"in c?c.addEventListener(S(h.e),h.proxy,C(h,N)):c.attachEvent("on"+S(h.e),h.proxy)})}function L(c,h,v,g,y){var E=a(c);P.fn.each((h||"").split(/\s/),function(i,a){P.fn.each(w(c,a,v,g),function(a,h){delete wt[E][h.i],"removeEventListener"in c?c.removeEventListener(S(h.e),h.proxy,C(h,y)):c.detachEvent("on"+S(h.e),h.proxy)})})}function j(a,c){return(c||!a.isDefaultPrevented)&&(c||(c=a),P.each(jt,function(h,v){var g=c[h];a[h]=function(){return this[v]=St,g&&g.apply(c,arguments)},a[v]=Bt}),(c.defaultPrevented!==Et?c.defaultPrevented:"returnValue"in c?c.returnValue===!1:c.getPreventDefault&&c.getPreventDefault())&&(a.isDefaultPrevented=St)),a}function A(a){var c,h={originalEvent:a};for(c in a)Lt.test(c)||a[c]===Et||(h[c]=a[c]);return j(h,a)}function D(){}var P,O,I,H,M=[],k=(M.concat,/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/),F=/^[^{]+\{\s*\[native \w/,R=/[\t\r\n\f]/g,U=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,$=/\S+/g,_={find:{},filter:{}},z=window.document,J=window.document,X="echatQuery"+1*new Date,G={},V=[],Q=(V.pop,V.push,V.slice),W=V.push,Y=new RegExp("\\\\([\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),Z=function(a,c,h){var v="0x"+c-65536;return v!==v||h?c:0>v?String.fromCharCode(v+65536):String.fromCharCode(v>>10|55296,1023&v|56320)},K="[\\x20\\t\\r\\n\\f]",et=function(){H()},tt={TAG:function(a){var c=a.replace(Y,Z).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===c}},CLASS:function(a){var c=new RegExp("(^|"+K+")"+a+"("+K+"|$)");return function(a){return c.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")}}};G.getElementsByTagName=c(function(a){return a.appendChild(J.createComment("")),!a.getElementsByTagName("*").length}),H=function(a){var h,v,g=a?a.ownerDocument||a:z;return g===J||9!==g.nodeType||!g.documentElement,J=g,O=J.documentElement,(v=J.defaultView)&&v.top!==v&&(v.addEventListener?v.addEventListener("unload",et,!1):v.attachEvent&&v.attachEvent("onunload",et)),G.attributes=c(function(a){return a.className="i",!a.getAttribute("className")}),G.getElementsByTagName=c(function(a){return a.appendChild(J.createComment("")),!a.getElementsByTagName("*").length}),G.getElementsByClassName=F.test(g.getElementsByClassName),G.getById=c(function(a){return O.appendChild(a).id=X,!J.getElementsByName||!J.getElementsByName(X).length}),G.getById?(_.find.ID=function(a,c){if("undefined"!=typeof c.getElementById){var m=c.getElementById(a);return m?[m]:[]}},_.filter.ID=function(a){var c=a.replace(Y,Z);return function(a){return a.getAttribute("id")===c}}):(delete _.find.ID,_.filter.ID=function(a){var c=a.replace(Y,Z);return function(a){var h="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return h&&h.value===c}}),G.qsa=F.test(g.querySelectorAll),_.find.TAG=G.getElementsByTagName?function(a,c){return"undefined"!=typeof c.getElementsByTagName?c.getElementsByTagName(a):G.qsa?c.querySelectorAll(a):void 0}:function(a,c){for(var h,v=[],i=0,g=z.getElementsByTagName(a);h=g[i++];)1===h.nodeType&&I(c,h)&&v.push(h);return v},_.find.CLASS=G.getElementsByClassName&&function(a,c){return"undefined"!=typeof c.getElementsByClassName&&documentIsHTML?c.getElementsByClassName(a):void 0},h=F.test(O.compareDocumentPosition),I=h||F.test(O.contains)?function(a,c){if(!a||!c)return!1;var h=9===a.nodeType?a.documentElement:a,v=c&&c.parentNode;return a===v||!(!v||1!==v.nodeType||!(h.contains?h.contains(v):a.compareDocumentPosition&&16&a.compareDocumentPosition(v)))}:function(a,c){if(!a)return!1;if(c)for(;c=c.parentNode;)if(c===a)return!0;return!1},g},H(),P=function(a,c){return new h(a,c)};var nt=0,it=/(\=)\?(&|$)|\?\?/i;P.ajaxJSONP=function(a,c){function h(e,h){P(N).remove(),e&&"error"==e.type||!v?a.error&&a.error(null,h||"error",T,a,c):a.success&&a.success(v[0],T,a,c),window[E]=w,v&&lt(w)&&w(v[0]),w=v=Et}if(!("type"in a))return P.ajax(a);var v,g=window.document,y=a.jsonpCallback,E=(lt(y)?y():y)||"jsonp"+ ++nt,N=g.createElement("script"),w=window[E],b=function(a){P(script).triggerHandler("error",a||"abort")},T={abort:b};c&&c.promise(T);g.getElementsByTagName("head")[0];window[E]=function(){v=arguments};var C="$1"+E+"$2";a.url=a.url.replace(it,C);var p="";if(a.data){for(var S in a.data){var d="string"==typeof a.data[S]?a.data[S]:JSON.stringify(a.data[S]);p="&"+S+"="+encodeURIComponent(d)}p&&(p=p.substring(1),p+="&")}a.url+=(/\?/.test(a.url)?"&":"?")+p+(a.jsonpCB||"jsonp")+"="+E;var B="onload"in N;return B?(N.onload=h,N.onerror=function(){h({type:"error"})}):N.onreadystatechange=function(){/loaded|complete/.test(N.readyState)&&h()},a.beforeSend&&a.beforeSend(T)===!1?T:(N.src=a.url,g.getElementsByTagName("head")[0].appendChild(N),T)},P.ajax=function(o){function a(){var a;try{a=new XMLHttpRequest}catch(e){for(var c=["Msxml3.XMLHTTP","Msxml2.XMLHTTP","Microsoft.XMLHTTP"],i=0,h=c.length;h>i;i++)try{a=new ActiveXObject(c[i]);break}catch(e){continue}}return a}if("jsonp"==o.jsonp||"JSONP"==o.jsonp||"jsonp"==o.type||"JSONP"==o.type)return P.ajaxJSONP(o,o.deferred);var c=a();if(c.onreadystatechange=function(){4==c.readyState&&(200==c.status?o.success&&o.success(c.responseText):o.error(c,c.responseText))},c.open(o.type,o.url,!0),o.header)for(var h in o.header)c.setRequestHeader(h,o.header[h]);o.header&&(o.header["Content-Type"]||o.header["Content-type"]||o.header["content-type"])&&o.contentType===!1||c.setRequestHeader("Content-type",o.contentType||"application/json;charset=UTF-8;"),o.beforeSend&&o.beforeSend(c);var d=o.data,v="";if(d&&"[object object]"==Object.prototype.toString.apply(d).toLowerCase())for(var g in d)v+="&"+g+"="+encodeURIComponent(d[g]);window.XMLHttpRequest?d||(d=null):d||(d=Et),c.send(v?v.substring(1):d)};var st,ot=/^-ms-/,at=/-([\da-z])/gi,ut=function(a){return a.replace(ot,"ms-").replace(at,function(a,c){return c.toUpperCase()})};!function(){var a,c,h;a=J.createElement("div"),a.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",h=a.getElementsByTagName("a")[0],c=h&&h.style,c=c.cssText="float:left;opacity:.5",st={"float":c.cssFloat?"cssFloat":"styleFloat"},a=null,h=null}();var lt=function(a){return null==a?!1:"function"==typeof a||"[object Function]"===Object.prototype.toString.call(a)},ct=function(a){return"[object Array]"===Object.prototype.toString.apply(a)},ft=function(a){return"string"==typeof a},dt={},ht=dt.toString,pt=function(a){return E(a)&&!y(a)&&Object.getPrototypeOf(a)==Object.prototype},mt=function(a){return null==a?"":(a+"").replace(U,"")};P.extend=function(a,c,h){for(var v in c)h&&(pt(c[v])||ct(c[v]))?(pt(c[v])&&!pt(a[v])&&(a[v]={}),ct(c[v])&&!ct(a[v])&&(a[v]=[]),N(a[v],c[v],h)):c[v]!==Et&&(a[v]=c[v]);return a},P.cookie=function(a,c,h){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(c))||null===c||c===Et)){if(h=P.extend({},h),(null===c||c===Et)&&(h.expires=-1),"number"==typeof h.expires){var v=h.expires,t=h.expires=new Date;t.setDate(t.getDate()+v)}return c=String(c),J.cookie=[encodeURIComponent(a),"=",h.raw?c:encodeURIComponent(c),h.expires?"; expires="+h.expires.toUTCString():"","; path="+(h.path||"/"),h.domain?"; domain="+h.domain:"",h.secure?"; secure":""].join("")}h=c||{};for(var g,y=h.raw?function(s){return s}:decodeURIComponent,E=J.cookie.split("; "),i=0;g=E[i]&&E[i].split("=");i++)if(y(g[0])===a)return y(g[1]||"");return null},P.toJSON=JSON.stringify;var vt={src:!0,href:!0},gt={isFunction:lt,isArray:ct,isString:ft,isObject:E,isPlainObject:pt,trim:mt,contains:I,readyList:[],find:function(a){var c={};return this.each(function(i,v){h.call(c,a,v,c.results)}),c},match:function(a,c){var v=new h(c),g=null;return v.each(function(i,c){return c==a||I(c,a)?(g=c,!0):void 0}),g},parents:function(a){var c,v,g,y,m;if(a&&this.results&&this.results.length>0&&(c=k.exec(a))&&((m=c[1])?v=function(a){return a.id==m}:(m=c[2])?(m=m.toUpperCase(),v=function(a){return a.tagName==m}):(m=c[3])&&(v=function(a){if(a.className){for(var c=a.className.split(" "),i=0;i<c.length;i++)if(c[i]==m)return!0;return!1}}),v))for(g=this.results[0];y=g.parentNode;){if(v(y))return new h(y,this.context,[]);g=y}return new h(null,this.context,[])},html:function(a){return a||""===a?this.each(function(i,c){c.innerHTML=a}):this.results&&this.results[0]?this.results[0].innerHTML:null},text:function(a){return"string"==typeof a?this.each(function(i,c){"string"==typeof c.textContent?c.textContent=a:c.innerText=a}):this.results&&this.results[0]?this.results[0].textContent||this.results[0].innerText:null},append:function(a){if(a){if(ft(a)){var c=J.createElement("div");c.innerHTML=a;var h=c.childNodes;this.each(function(i,a){for(var c,i=0;c=h[i++];)1==c.nodeType&&(c=c.cloneNode(!0),a.appendChild(c))})}else this.each(function(i,c){c.appendChild(a)});return this}},insertBefore:function(a,c){if(a){var h;if(ft(a)){var v=J.createElement("div");v.innerHTML=a;var g=v.childNodes;this.each(function(i,a){for(var v,i=0;v=g[i++];)1==v.nodeType&&(v=v.cloneNode(!0),h=c||a.childNodes[0],h?a.insertBefore(v,h):a.appendChild(v))})}else this.each(function(i,v){h=c||v.childNodes[0],h?v.insertBefore(a,h):v.appendChild(a)});return this}},show:function(){return this.each(function(i,a){a.style.display="block"}),this},hide:function(){return this.each(function(i,a){a.style.display="none"}),this},removeClass:function(a){for(var c,h,v,g,y=this.results.length,E=0,i=0,N=(a||"").match($)||[];y>i;i++)if(c=this.results[i],h=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(R," "):"")){for(E=0;v=N[E++];)for(;h.indexOf(" "+v+" ")>=0;)h=h.replace(" "+v+" "," ");g=a?mt(h):"",c.className!==g&&(c.className=g)}else c.className="";return this},addClass:function(a){for(var c,h,v,g,y=this.results.length,E=0,i=0,N=(a||"").match($)||[];y>i;i++)if(c=this.results[i],h=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(R," "):"")){for(E=0;v=N[E++];)for(;h.indexOf(" "+v+" ")<0;)h+=v+" ";g=a?mt(h):"",c.className!==g&&(c.className=g)}else c.className=a;return this},attr:function(a,c){if(!a)return this;if("undefined"==typeof c){if("string"==typeof a)return this.results&&this.results.length>0?this.getAttr(this.results[0],a):"";var h=this.results?this.results.length:0;for(var v in a)for(var i=0;h>i;i++){var g=this.results[i];vt[v]?g[v]=a[v]:g.setAttribute(v+"",a[v])}}else for(var h=this.results?this.results.length:0,i=0;h>i;i++){var g=this.results[i];g.setAttribute(a,c),vt[a]?g[a]=c:g.setAttribute(a,c)}return this},css:function(a,c){if(!a)return this;if("undefined"==typeof c)if("string"==typeof a)this.css(a,0===c?"0":"inherit");else for(var h=this.results?this.results.length:0,i=0;h>i;i++)for(var v in a){var n=ut(v);n=st[n]||n;var g=this.results[i];try{g.style[n]=a[v]}catch(e){}}else try{for(var h=this.results?this.results.length:0,i=0;h>i;i++){var n=ut(a);n=st[n]||n;var g=this.results[i];g.style[n]=c}}catch(e){return this}return this},remove:function(){for(var a=this.results?this.results.length:0,i=0;a>i;i++){var c=this.results[i];c.parentNode.removeChild(c)}return this.length=0,this.results=[],this},removeAttr:function(a){return this.each(function(i,c){c.setAttribute(a,""),c.removeAttribute(a)})},ready:function(){for(var a,i=0;this.readyList&&(a=this.readyList[i]);)a.call(window),i++;return this},hasClass:function(a){for(var c=this.results?this.results.length:0,h=[],v=tt.CLASS(a),i=0;c>i;i++){var g=this.results[i];v(g)&&h.push(g)}return h.length},max:function(a,c){return a>c?a:c},width:function(){return this.results&&this.results[0]?gt.max(this.results[0].offsetWidth,this.results[0].clientWidth):null},height:function(){return this.results&&this.results[0]?gt.max(this.results[0].offsetHeight,this.results[0].clientHeight):null},val:function(a){return"undefined"==typeof a?this.results&&this.results[0]?this.results[0].value:null:(this.results&&this.results[0]?this.results[0].value=a+"":null,this)},getAttr:function(a,c){return a.getAttribute(c)},each:function(a,c){if(ct(a))for(var i=0;i<a.length&&!c.call(a[i],i,a[i]);i++);else if(lt(a)){c=a,a=this.results||[];for(var i=0;i<a.length&&!c.call(a[i],i,a[i]);i++);}else for(var i in a)if(c.call(a[i],i,a[i]))break;return this}},yt=function(){function a(){g.removeEventListener("DOMContentLoaded",a,!1),g.removeEventListener("load",a,!1),v()}function c(){"complete"==g.readyState&&(g.detachEvent("onreadystatechange",c),g.detachEvent("onload",h),v())}function h(){g.detachEvent("onreadystatechange",c),g.detachEvent("onload",h),v()}var v=function(){yt&&(gt.ready(),yt=Et)},g=window.document;if(g.addEventListener)g.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1);else if(g.attachEvent)g.attachEvent("onreadystatechange",c),window.attachEvent("onload",h);else if(g.lastChild==g.body)return v();var l=g.getElementsByTagName("body")||[];l.length>0&&v()};yt(),P.fn=gt,P.each=gt.each;var Et,Nt=1,Q=Array.prototype.slice,wt={},bt={},xt="onfocusin"in window,Tt={focus:"focusin",blur:"focusout"},Ct={mouseenter:"mouseover",mouseleave:"mouseout"};bt.click=bt.mousedown=bt.mouseup=bt.mousemove="MouseEvents",P.event={add:B,remove:L},P.proxy=function(c,h){var v=2 in arguments&&Q.call(arguments,2);if(lt(c)){var g=function(){return c.apply(h,v?v.concat(Q.call(arguments)):arguments)};return g._zid=a(c),g}if(ft(h))return v?(v.unshift(c[h],c),P.proxy.apply(null,v)):P.proxy(c[h],c);throw new TypeError("expected function")},P.fn.bind=function(a,c,h){return this.on(a,c,h)},P.fn.unbind=function(a,c){return this.off(a,c)},P.fn.one=function(a,c,h,v){return this.on(a,c,h,v,1)};var St=function(){return!0},Bt=function(){return!1},Lt=/^([A-Z]|returnValue$|layer[XY]$)/,jt={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};P.fn.delegate=function(a,c,h){return this.on(c,a,h)},P.fn.undelegate=function(a,c,h){return this.off(c,a,h)},P.fn.live=function(a,c){return P(J.getElementsByTagName("body")[0]).delegate(this.selector,a,c),this},P.fn.die=function(a,c){return P(J.getElementsByTagName("body")[0]).undelegate(this.selector,a,c),this},P.fn.on=function(a,c,h,v,g){var y,E,N=this;return a&&!ft(a)?(P.each(a,function(a,v){N.on(a,c,h,v,g)}),N):(ft(c)||lt(v)||v===!1||(v=h,h=c,c=Et),(v===Et||h===!1)&&(v=h,h=Et),v===!1&&(v=Bt),N.each(function(N,w){g&&(y=function(e){return L(w,e.type,v),v.apply(this,arguments)}),c&&(E=function(e){e=e||window.event;var a,h=e.target||e.srcElement,g=gt.match(h,c);return g&&g!==w?(a=P.extend(A(e),{currentTarget:g,liveFired:w}),(y||v).apply(g,[a].concat(Q.call(arguments,1)))):void 0}),B(w,a,v,h,c,E||y)}))},P.fn.off=function(a,c,h){var v=this;return a&&!ft(a)?(P.each(a,function(a,h){v.off(a,c,h)}),v):(ft(c)||lt(h)||h===!1||(h=c,c=Et),h===!1&&(h=Bt),v.each(function(){L(this,a,h,c)}))},P.fn.trigger=function(a,c){return a=ft(a)||pt(a)?P.Event(a):j(a),a._args=c,this.each(function(){a.type in Tt&&"function"==typeof this[a.type]?this[a.type]():"dispatchEvent"in this?this.dispatchEvent(a):P(this).triggerHandler(a,c)})},P.fn.triggerHandler=function(a,c){var e,h;return this.each(function(i,v){e=A(ft(a)?P.Event(a):a),e._args=c,e.target=v,P.each(w(v,a.type||a),function(i,a){return h=a.proxy(e),e.isImmediatePropagationStopped()?!1:void 0})}),h},P.fn.each("focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" "),function(i,a){P.fn[a]=function(c){return 0 in arguments?this.bind(a,c):this.trigger(a)}}),P.Event=function(a,c){ft(a)||(c=a,a=c.type);var h=J.createEvent(bt[a]||"Events"),v=!0;if(c)for(var g in c)"bubbles"==g?v=!!c[g]:h[g]=c[g];return h.initEvent(a,v,!0),j(h)},P.isBoolean=D,P.isDate=D,P.isFunction=D,P.isNaN=D,P.isNumber=D,P.isObject=D,P.isRegExp=D,P.isString=D,P.isUndefined=D;for(var At=P,Dt="Array Boolean Date NaN Number Function Object RegExp Undefined".split(" "),i=0;i<Dt.length;i++){var Pt=Dt[i];At["is"+Pt]=function(a){return function(c){return c!==c?"NaN"===a?!0:!1:RegExp(a).test(Object.prototype.toString.call(c))}}(Pt)}return h.prototype=P.fn,P}();window.EChatQuery=a}();
;/*!visitor/common/js/qcometd.js*/
!function(a,c){!function(a,c){function h(a,c){if(c)for(var h in c)"content-type"!==h.toLowerCase()&&a.setRequestHeader(h,c[h])}function k(){var k=new c.LongPollingTransport,g=c.Transport.derive(k);return g.xhrSend=function(c){return a.ajax({url:c.url,async:c.sync!==!0,type:"POST",contentType:"application/json;charset=UTF-8",data:c.body,global:!1,xhrFields:{withCredentials:!0},beforeSend:function(a){try{a.withCredentials=!0}catch(e){}return h(a,c.headers),!0},success:c.onSuccess,error:function(a,h,k){c.onError(h,k);var s="";for(var i in a);for(var i in k)s+=k[i]}})},g}function g(){var k=new c.CallbackPollingTransport,g=c.Transport.derive(k);return g.jsonpSend=function(c){a.ajax({url:c.url,async:c.sync!==!0,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:c.body},beforeSend:function(a){return h(a,c.headers),!0},success:c.onSuccess,error:function(a,h,k){c.onError(h,k)}})},g}return"undefined"!=typeof JSON&&(c.JSON.toJSON=JSON.stringify,c.JSON.fromJSON=JSON.parse),a.CometD=function(a){var h=new c.CometD(a);return c.WebSocket&&h.registerTransport("websocket",new c.WebSocketTransport),h.registerTransport("long-polling",new k),h.registerTransport("callback-polling",new g),h},a.cometd=new a.CometD,a.cometd}(a,c.cometd),function(a){return a.AckExtension=function(){function a(a,h){c._debug(a,h)}var c,h=!1,k=-1;this.registered=function(h,k){c=k,a("AckExtension: executing registration callback")},this.unregistered=function(){a("AckExtension: executing unregistration callback"),c=null},this.incoming=function(c){var g=c.channel;if("/meta/handshake"==g)h=c.ext&&c.ext.ack,a("AckExtension: server supports acks",h);else if("/meta/connect"==g&&c.successful&&h){var y=c.ext;y&&"number"==typeof y.ack&&(k=y.ack,a("AckExtension: server sent ack id",k))}return c},this.outgoing=function(g){var y=g.channel;return"/meta/handshake"==y?(g.ext||(g.ext={}),g.ext.ack=c&&c.ackEnabled!==!1,k=-1):"/meta/connect"==y&&h&&(g.ext||(g.ext={}),g.ext.ack=k,a("AckExtension: client sending ack id",k)),g}}}(c.cometd),function(a,c){var h=new a;return c.registerExtension("ack",h),h}(c.cometd.AckExtension,a.cometd),function(a,c){return c&&(a.COOKIE||(a.COOKIE={},a.COOKIE.set=c,a.COOKIE.get=c)),a.ReloadExtension=function(c){function h(c){if(O.handshakeResponse){S=!0;var h=y.getTransport();h&&h.abort(),g(c),O.cookiePath=T;var k=a.JSON.toJSON(O);v("Reload extension saving cookie value",k),a.COOKIE.set(b,k,{"max-age":E,path:T,expires:new Date((new Date).getTime()+1e3*E)})}}function k(a){return O.url==a.url}function g(a){a&&("number"==typeof a.cookieMaxAge&&(E=a.cookieMaxAge),"string"==typeof a.cookieName&&(b=a.cookieName),"string"==typeof a.cookiePath&&(T=a.cookiePath))}var y,v,O={},b="org.cometd.reload",T="/",E=5,R=!1,S=!1;this.configure=g,this.registered=function(a,c){y=c,y.reload=h,v=y._debug},this.unregistered=function(){delete y.reload,y=null},this.outgoing=function(c){switch(c.channel){case"/meta/handshake":O={},O.url=y.getURL();var h=a.COOKIE.get(b);if(v("Reload extension found cookie value",h),h)try{var g=a.JSON.fromJSON(h);if(a.COOKIE.set(b,"",{"max-age":-1,path:g.cookiePath,expires:-1}),g.handshakeResponse&&k(g)){v("Reload extension restoring state",g);var T=y._getCallback(c.id);return setTimeout(function(){v("Reload extension replaying handshake response",g.handshakeResponse),O.handshakeResponse=g.handshakeResponse,O.transportType=g.transportType,y._putCallback(c.id,T);var a=y._mixin(!0,{},O.handshakeResponse,{id:c.id,ext:{reload:!0}});a.supportedConnectionTypes=[O.transportType],y.receive(a),v("Reload extension replayed handshake response",a)},0),R||(R=!0,y.startBatch()),null}v("Reload extension could not restore state",g)}catch(x){v("Reload extension error while trying to restore cookie",x)}break;case"/meta/connect":if(S===!0)return v("Reload extension aborting /meta/connect during reload"),null;O.transportType||(O.transportType=c.connectionType,v("Reload extension tracked transport type",O.transportType));break;case"/meta/disconnect":O={}}return c},this.incoming=function(a){if(a.successful)switch(a.channel){case"/meta/handshake":O.handshakeResponse||(O.handshakeResponse=a,v("Reload extension tracked handshake response",a));break;case"/meta/connect":R&&(R=!1,y.endBatch());break;case"/meta/disconnect":O={}}return a},g(c)}}(c.cometd,a.cookie),function(a,c,h){var k=new c;return h.registerExtension("reload",k),k}(c.cometd,c.cometd.ReloadExtension,a.cometd)}(EChatQuery,org);
;/*!visitor/common/js/util.js*/
!function($){"undefined"==typeof window.ECHATObjKeyMap&&(window.ECHATObjKeyMap={});var UTIL=function(justBase){function _isPointerEventType(e,a){return e.type=="pointer"+a||e.type.toLowerCase()=="mspointer"+a||e.type=="mouse"+a}function _isPrimaryTouch(a){var t=a.type.indexOf("mouse")>-1||("touch"==a.pointerType||a.pointerType==a.MSPOINTER_TYPE_TOUCH)&&a.isPrimary;return t}this.ECHATConfig={contextPath:"/mychat/visitor"};var _self=this;if(this.bot=/spider|bot/i.test(navigator.userAgent),this.subMap={},this.eventMap={},this.setSub=function(a){this.subMap[a]=a},this.removeSub=function(a){delete this.subMap["string"==typeof a?a:a.KEY]},this.publish=function(a){var c=this.subMap;for(var h in c){var g=ECHATObjKeyMap[h];if(g&&g.eventMap&&g.eventMap[a]){var v=g.eventMap[a];if(this.isArray(v))for(var i=0;i<v.length;i++)v[i].apply(g,arguments)}}},this.subscribe=function(a,c){this.eventMap[a]?this.eventMap[a].push(c):this.eventMap[a]=[c]},this.unSubscribeAll=function(){this.eventMap={}},this.unSubscribe=function(a){if(this.isArray(a))for(var i=0;i<a.length;i++)delete this.eventMap[a[i]];else delete this.eventMap[a]},this.isArray=function(a){return"[object Array]"===Object.prototype.toString.apply(a)},this.getQueryString=function(a){var c=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),r=location.search.substr(1).match(c);return null!=r?decodeURIComponent(r[2]):void 0},this.escapeRegExp=function(){var a=/[\\^$.*+?()[\]{}|]/g,c=new RegExp(a.source);return function(h){return h&&c.test(h)?h.replace(a,"\\$&"):h}}(),this.getQueryParams=function(a){var c={};"string"!=typeof a&&(a=location.search),-1!=a.indexOf("#")&&(a=a.substring(0,a.indexOf("#"))),-1!=a.indexOf("?")&&(a=a.substring(a.indexOf("?")+1));for(var h,g=a.split("&"),v=g.length,i=0;v>i;i++)g[i]&&(h=g[i].split("="),h[0]&&h[1]&&(c[h[0]]=decodeURIComponent(h[1]),c[h[0].toLowerCase()]=c[h[0]]));if(c.visEvt)try{var w=JSON.parse(c.visEvt);w&&w.eventId&&(c.eventId=w.eventId,c.eventid=w.eventId)}catch(e){c.visEvt=void 0,delete c.visEvt}return c},this.queryParams=this.getQueryParams(),this.companyId=this.getQueryString("companyid"),this.getBackground=function(a,c){var h=[],g=parseInt(c||100)/100,v=(a||"rgb(255,255,255)").toLocaleLowerCase().trim();if(0==v.indexOf("rgb"))v=v.replace("rgb","rgba").replace(")",","+g+")");else if(0==v.indexOf("#")){v=v.replace("#","").split("");for(var i=0;i<v.length;i++)3==v.length?h.push(parseInt("0x"+v[i]+v[i])):i%2==0&&h.push(parseInt("0x"+v[i]+v[i+1]));h.push(g),v="rgba("+h.join()+")"}return v},this.hasStorage=function(){var a;try{if(!window.localStorage)return!1;if(window.localStorage.setItem("echt_test_storage","ok"),a=window.localStorage.getItem("echt_test_storage"),!a)return!1}catch(e){return!1}return a&&window.localStorage.removeItem("echt_test_storage"),!0}(),this.hasCookie=function(){$.cookie("echt_test_cookie","ok");var a=$.cookie("echt_test_cookie");return a?($.cookie("echt_test_cookie",null),!0):!1}(),$.store=function(a){return a?function(a,c,h){return a?arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(c))||null===c||void 0===c)?(h=$.extend({},h),(null===c||void 0===c)&&(h.expires=-1),c=String(c),h.session?window.sessionStorage.setItem(a,c):window.localStorage.setItem(a,c),c):(h=c||{},h.local?window.localStorage.getItem(a):h.session?window.sessionStorage.getItem(a):window.localStorage.getItem(a)||window.sessionStorage.getItem(a)||$.cookie(a)):null}:$.cookie}(this.hasStorage),!justBase){this.getDeviceInfo=function(){function G(){var a=/mobile|kgbrowser|(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i,c=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,h=C||D||window.opera,g=a.test(h)||c.test(h.substr(0,4));return g}function L(){return window.document.documentElement.clientWidth>window.document.documentElement.clientHeight}function R(){return E&&/(iemobile|windows phone)/i.test(C)}function T(){return E&&y.test(D)&&(!z.test(C)||/samsung/i.test(C))}function Y(){var a=1.2,c=640,h=window.document.documentElement.clientWidth,g=window.document.documentElement.clientHeight,v=h/g>a,w=window.screen.width,y=window.screen.height,b=!1;v&&y>w&&(b=!0,w=window.screen.height,y=window.screen.width);var S=window.innerWidth,$=h/w;window.devicePixelRatio&&T()&&w>c?$*=window.devicePixelRatio:R()&&($*=1.5);var k=h/S/$;return k=(k/a).toFixed(2),(w/S).toFixed(2)}function Z(){var a=window,c=a.document.documentElement,g=a.document.body,v=null,w={top:0,left:0};if(h(c.getBoundingClientRect)&&(h(a.getComputedStyle)?"relative"==a.getComputedStyle(g).position?v=g:"relative"==a.getComputedStyle(c).position&&(v=c):g.currentStyle?"relative"==g.currentStyle.position?v=g:"relative"==c.currentStyle.position&&(v=c):"relative"==g.style.position?v=g:"relative"==c.style.position&&(v=c)),v){var y=v.getBoundingClientRect();w.top=y.top+a.pageYOffset-c.clientTop,w.left=y.left+a.pageXOffset-c.clientLeft}return w}_self.deviceInfo=F;var b=_self,f=b.indexOf=function(){function a(a){if(null==this)throw new TypeError;var c=Object(this),h=c.length>>>0;if(0===h)return-1;var g=0;if(arguments.length>0&&(g=Number(arguments[1]),g!=g?g=0:0!=g&&1/0!=g&&g!=-1/0&&(g=(g>0||-1)*Math.floor(Math.abs(g)))),g>=h)return-1;for(var v=g>=0?g:Math.max(h-Math.abs(g),0);h>v;v++)if(v in c&&c[v]===a)return v;return-1}function c(a,c,h){return x.call(c,a,h)}var x=Array.prototype.indexOf;return"function"==typeof x&&/\[native code\]/.test(x.toString())||(x=a),c}(),h=b.isFunction=function(){function x(a){return"function"==typeof a}return x}(),i=b.isString=function(){function x(a){return"string"==typeof a}return x}(),q=b.Browser=function(){function $f(a){return a.replace(/^http:/,$a?"https:":"http:")}function $g(){return window.innerHeight!==a?window.innerHeight:document.documentElement?document.documentElement.offsetHeight:document.getElementsByTagName("body").length?document.getElementsByTagName("body")[0].clientHeight:0}function $h(){return window.innerWidth!==a?window.innerWidth:document.documentElement?document.documentElement.offsetWidth:document.getElementsByTagName("body").length?document.getElementsByTagName("body")[0].clientWidth:0}function $o(){var a,c=x.plugins&&x.plugins[$k];if(c)return a=x.mimeTypes&&x.mimeTypes[$m],a&&!a.enabledPlugin?null:c.description;if(window.ActiveXObject)try{return c=new window.ActiveXObject($l),c.AllowScriptAccess="always",c.GetVariable("$version")}catch(h){}}function $p(){var a=x.mimeTypes;return A?Q?!1:"javaEnabled"in x&&x.javaEnabled():a&&(a=a[$n])&&(a=a.enabledPlugin)?a.name:void 0}function $q(){if(!k(S))return S;var a=document.createElement("div"),c=document.createElement("div"),h=a.style,g=c.style;return h.overflow="auto",h.width=h.height="100px",h.position="absolute",h.top="-1000px",g.width="100%",g.height="200px",a.appendChild(c),document.body.appendChild(a),S=a.offsetWidth-a.clientWidth,document.body.removeChild(a),S}function $r(){try{return eval("false")}catch($u){return!0}}function $s(){for(var a=3,c=document.createElement("div"),h=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",h[0];);return a>4?a:document.documentMode}var x=navigator,y=x.userAgent.toLowerCase(),osVersion=0,z=+(/trident.*rv:? *([0-9]+)/.exec(y)||[])[1]||!1,A=$s(),zz=/edge/.exec(y)||!A&&!!window.StyleMedia||!1,B=8==A,C=7==A,D=6==A,E=window.opera&&"[object Opera]"==Object.prototype.toString.call(window.opera)||/webkit/.test(y)&&(/opr/.test(y)||/opera/.test(y)),F="Google Inc."==navigator.vendor,G="Apple Computer, Inc."==navigator.vendor,H=!A&&(F||G||/webkit|khtml/.test(y)),I=+/\d+/.exec(/firefox\/\d+/i.exec(navigator.userAgent)||""),J=y.indexOf("firefox/2")>-1,K=y.indexOf("firefox/3")>-1,L=-1!=y.indexOf("iphone"),M=-1!=y.indexOf("ipod"),N=-1!=y.indexOf("ipad"),O=L||N||M,Q=-1!=y.indexOf("wp7"),kgBrowser=-1!=y.indexOf("kgbrowser"),meizu=-1!=y.indexOf("mzbrowser"),P=meizu||-1!=y.indexOf("android"),R=O||P||Q||kgBrowser||meizu,S,uc=-1!=y.indexOf("ucbrowser"),liebao=-1!=y.indexOf("lbbroser")||y.indexOf("liebao")>-1,qq=-1!=y.indexOf("qqbrowser"),sogou=-1!=y.indexOf("metasr")||-1!=y.indexOf("sogou"),f360=y.match(/360|qhbrowser|qihoobrowser/i),maxth=-1!=y.indexOf("maxthon"),baidu=-1!=y.indexOf("bidubrowser")||-1!=y.indexOf("baidubrowser")||-1!=y.indexOf("baidu"),weixin=-1!=y.indexOf("micromessenger"),chromeIphone=L&&-1!=y.indexOf("crios"),T=A&&"msie"||I&&"firefox"||E&&"opera"||uc&&"uc"||liebao&&"liebao"||qq&&"qq"||zz&&"edge"||sogou&&"sogou"||f360&&"360"||maxth&&"maxth"||baidu&&"baidu"||weixin&&"weixin"||chromeIphone&&"chrome"||G&&"safari"||F&&"chrome"||H&&"chrome",U,V=A&&!W,W="CSS1Compat"==document.compatMode,X=!W,Y=A&&X&&document.documentElement&&!!document.documentElement.style.setExpression,Z=document.documentMode||A,$$=-1!=y.indexOf("windows")||-1!=y.indexOf("win32"),$_=-1!=y.indexOf("macintosh")||-1!=y.indexOf("mac os x")||-1!=window.navigator.platform.indexOf("Mac"),$a="https:"==document.location.protocol,$b=x.language||x.browserLanguage||x.userLanguage||x.systemLanguage,$c={noBoxSizing:7>=Z,ie:{cssBottomRight:D,cssFixed:D||Y,buggyCSS:D||Y}},$d="textContent"in document.createElement("div"),$e=!1;try{window.CustomEvent&&/\[native code\]/.test(window.CustomEvent.toString())&&(new window.CustomEvent("testevent",{bubbles:!1,cancelable:!0,detail:!0}),$e=!0)}catch($u){}switch(T){case"opera":U=+/\d+/.exec(new RegExp("opr[ /]\\d+").exec(y)||"");break;case"msie":case"firefox":case"chrome":U=U||+/\d+/.exec(new RegExp(T+"[ /]\\d+").exec(y)||"");break;case"baidu":U=+/\d+/.exec(new RegExp("bidubrowser[ /]\\d+").exec(y)||"");break;case"maxth":U=+/\d+/.exec(new RegExp("maxthon[ /]\\d+").exec(y)||"");break;case"qq":U=+/\d+/.exec(new RegExp("qqbrowser[ /]\\d+").exec(y)||"");break;case"liebao":U=+/\d+/.exec(new RegExp("lbbroser[ /]\\d+").exec(y)||"");break;case"uc":U=+/\d+/.exec(new RegExp("ucbrowser[ /]\\d+").exec(y)||"");break;case"sogou":U=+/\d+/.exec(new RegExp("metasr[ /]\\d+").exec(y)||"");break;default:U=+/\d+/.exec(/version[ \/]\d+/.exec(y)||"")}if(O&&(osVersion=+/\d+/.exec(new RegExp("iphone os \\d+").exec(y)||"")),D){var $i=[];$c.leaksMemory=function(a){p.isFunction(a),$i.push(a)};var $j=function(){for(var a=0;a<$i.length;a++)$i[a]()};$c.leaksMemory.remove=function(a){for(var c=$i.length-1;c>=0;c--)a==$i[c]&&$i.splice(c,1)},window.attachEvent("onunload",$j)}var $k="Shockwave Flash",$l="ShockwaveFlash.ShockwaveFlash",$m="application/x-shockwave-flash",$n="application/x-java-vm",$t={browser:T,version:U,osVersion:osVersion,isStrict:W,isQuirks:X,isOpera:E,isSafari:G,isWebKit:H,isChrome:!E&&F,isAndroid:P,isIPhone:L,isIPod:M,isIPad:N,isIOS:O,isWP7:Q,isMobile:R,isEdge:zz,isNewIE:z,isIE:A,isIE6:D,isIE7:C,isIE8:B,isFF:I,isFF2:J,isFF3:K,isBorderBox:V,isCustomEvents:$e,engineIE:Z,bugs:$c,isWindows:$$,isXP:/windows nt 5.1/.test(y),isMac:$_,isLinux:/Linux/.test(navigator.platform),isSecure:$a,secureURL:$f,hasFlash:$o(),hasJava:$p(),language:$b,getScrollbarSize:$q,getWindowClientHeight:$g,getWindowClientWidth:$h,isTextContent:$d,hasCSP:$r()};return $t.isPC=!$t.isMobile&&($t.isWindows||$t.isMac||$t.isEdge||$t.isLinux),$t}(),x=b.__$$__jx_ui_HTMLElement,y=/google inc\./i,z=/chrome/i,A=/apple computer, inc\./i,B=/crios/i,C=window.navigator.userAgent||"",D=window.navigator.vendor||"",F={checkLandscape:L,getZoomLevel:Y,getOffset:Z},E=G();_self.Device=F}();var isMobilePage=window.mobilePage||-1!=location.href.split("?")[0].indexOf("/visitor/mobile/")&&!ECHATObjKeyMap.outerId;_self.Device.media=_self.Browser.isMobile||isMobilePage||!_self.Browser.isPC?2:1,_self.Device.OS=this.Browser.isWindows&&"Windows"||this.Browser.isIPhone&&"iPhone"||this.Browser.isIPad&&"IPAD"||this.Browser.isIPod&&"IPOD"||this.Browser.isMac&&"OSX"||this.Browser.isAndroid&&"Android"||this.Device.isWP&&"Windows Phone"||this.Browser.isLinux&&"Linux"||"others",this.hasTranslate=this.Browser.isMobile,this.setTransform=function(x,a){var c="translate("+x+"px,"+a+"px)";$(this).css(_self.hasTranslate?{"-webkit-transform":c,"-o-transfrom":c,"-ms-transform":c,"-moz-transform":c,transform:c}:{left:x+"px",top:a+"px"})},this.setScale=function(){function a(){{var a=_self.deviceInfo.getZoomLevel();(1/a).toFixed(2),window.pageXOffset,window.pageYOffset,window.innerWidth,window.innerHeight,c[0].clientWidth,c[0].clientHeight}return}var c=this;a()};var _clearSlct="getSelection"in window?function(){window.getSelection().removeAllRanges()}:function(){document.selection.empty()};this.pageSlide=function(a,c){$(document).on("mousedown touchstart MSPointerDown pointerdown",a,function(e){e=e||window.event;var a=!1;if(!(a=_isPointerEventType(e,"down"))||_isPrimaryTouch(e)){e=a?e:e.touches&&e.touches[0]||e;var h={};h.x2=void 0,h.y2=void 0;var g=0,v=0,w=0,y=$(this),b=this.parentNode.clientWidth,S=b/8,k=parseInt(y.attr("x")||this.offsetLeft)||0,E=this.clientWidth,C=-E+b-20,M=20;h.x1=e.clientX,h.y1=e.clientY,y.removeClass("transition");var T=function(e){e.preventDefault()};document.body.addEventListener("touchmove",T,{passive:!1});var I=function(e){e=a?e:e.touches&&e.touches[0]||e,h.x2=e.clientX,h.y2=e.clientY,g=h.x2-h.x1,v=h.y2-h.y1;var x=g+k;x=x>M?M:C>x?C:x,_self.setTransform.call(y,x,0),y.attr("x2",x),_clearSlct()},O=function(e){if(_clearSlct(),y){y.addClass("transition");var a=0;if(0==w&&S<Math.abs(g)){{parseInt(y.attr("x2"))}g>=S&&0>=k+b?(_self.setTransform.call(y,k+b,0),y.attr("x",k+b),a=-1):-S>=g&&k-b+E>0?(_self.setTransform.call(y,k-b,0),y.attr("x",k-b),a=1):_self.setTransform.call(y,k,0)}else _self.setTransform.call(y,k,0);var r=c&&c(a);return $(document).off("mousemover mousemove touchmove MSPointerMove pointermove",I).off("mouseup touchend MSPointerUp pointerup",O),y=null,_clearSlct(),r===!1?(e.stopPropagation&&e.stopPropagation,e.preventDefault&&e.preventDefault(),!1):void document.body.removeEventListener("touchmove",T)}};$(document).on("mousemover mousemove touchmove MSPointerMove pointermove",I).on("mouseup touchend MSPointerUp pointerup",O)}})},this.getCSSRule=function(a,c,h){if(h=h||window.document,a=a.toLowerCase(),h.styleSheets)for(var i=0;i<h.styleSheets.length;i++){var g=h.styleSheets[i],v=0,w=!1;do{if(w=g.cssRules?g.cssRules[v]:g.rules[v],w&&w.selectorText&&w.selectorText.toLowerCase()==a)return"delete"==c?(g.cssRules?g.deleteRule(v):g.removeRule(v),!0):w;v++}while(w)}return!1},this.killCSSRule=function(a){return this.getCSSRule(a,"delete")},this.addCSSRule=function(a){return document.styleSheets&&(this.getCSSRule(a)||(document.styleSheets[0].addRule?document.styleSheets[0].addRule(a,null,0):document.styleSheets[0].insertRule(a+" { }",0))),this.getCSSRule(a)},this.addJS=function(a,c){function h(a){g.onload=g.onerror=g.onreadystatechange=null,v.removeChild(g),c&&c(a,g.innerHTML),g=null}var g=document.createElement("script");g.setAttribute("type","text/javascript");var v=document.getElementsByTagName("head")[0],w="onload"in g;w?(g.onload=h,g.onerror=function(){h(!0)}):g.onreadystatechange=function(){/loaded|complete/.test(g.readyState)&&h()},g.src=a,v.appendChild(g)},this.addCSS=function(a){var c=document.createElement("link");c.rel="stylesheet",c.type="text/css",c.href=a,c.media="screen";var h=document.getElementsByTagName("head")[0];h.appendChild(c)},this.base64encode=function(a){var c,i,h,g,v,w,y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(h=a.length,i=0,c="";h>i;){if(g=255&a.charCodeAt(i++),i==h){c+=y.charAt(g>>2),c+=y.charAt((3&g)<<4),c+="==";break}if(v=a.charCodeAt(i++),i==h){c+=y.charAt(g>>2),c+=y.charAt((3&g)<<4|(240&v)>>4),c+=y.charAt((15&v)<<2),c+="=";break}w=a.charCodeAt(i++),c+=y.charAt(g>>2),c+=y.charAt((3&g)<<4|(240&v)>>4),c+=y.charAt((15&v)<<2|(192&w)>>6),c+=y.charAt(63&w)}return c},this.iScrollParam={preventDefault:!1,preventDefaultException:/^(A|PRE|INPUT|TEXTAREA|BUTTON|SELECT|LABEL)$/,tap:!1,click:!1,mouseWheel:!1,fadeScrollbars:!1},this.parseMsgByRule=function(a,c,h){function g(a,c){return a&&a.replace(/<(?:.|\s)*?>/gi,"").substring(0,c||100)}function v(a){if(!a)return a;var c=this.emo;return c&&(a=a.replace(w,function(a){var h=(arguments[0],a.charCodeAt(0)),l=a.charCodeAt(1),e=((h-55296<<10)+(l-56320)+65536).toString(16);return c[e]?'<img class="img-emo" src="/res/emoji/32/'+e+'.png" />':c[h+"_"+l]?'<img class="img-emo" src="/res/emoji/32/'+(h+"_"+l)+'.png" />':a})),a=a.replace(y,function(a){var h=a.replace(/^\[#([\d\w_]+)#\]/g,"$1");return c&&c[h]||!c?'<img class="img-emo" src="/res/emoji/32/'+h+'.png" />':a})}if(c&&a){var w=this.regFace,y=this.regEmo||new RegExp("\\[#[a-z0-9A-Z]+(_[a-z0-9A-Z]+)?#\\]","g"),b=1,S=c[a.mt||0];return S?S=S.replace(/\$\{([^,]+),?([^,]+)?,?([^,]+)?,?([^,]+)?\}/g,function(c,h,g,v,w){if(b="1"==w?1:0,!g&&!v)return a[h];v=parseInt(v);var y=a[h];return v>0&&y.replace(/\[#([^#]+)#\]/g,function(a,c,h){return v>h&&h+a.length>=v?v+=a.length-1:v>h&&(v+=a.length-1),a}),a[h].substring(g,v)}):(S=a.content)||(S=c[0]),(b||h&&h.notPlainText)&&(S=g(S)),w?S&&(S=v(S)):S&&(S=S.replace(y,"[face]")),S}},this.lastMsgRule={0:"",604:"",605:"",621:"",622:"",640:"${content,0,30,1}",641:"[]",642:"[]",647:"${content,0,30,1}",648:":${position}",653:"[]",657:"[]",673:"",674:"",675:"",676:"",10011:"[]",864:"${content,0,30,1}",865:"[]",866:"[]",680:"[]"},this.formatUnreadMsg=function(a){function c(a){this.needHttps&&a.companyLogo&&(a.companyLogo=a.companyLogo.replace(/^http:/,this.needHttps)),"undefined"!=typeof a.unreadMsgNumber&&(a.unreadMsgCount=a.unreadMsgNumber),a.lastMsg=JSON.parse(a.lastMsgContent),a.msgContent=h.parseMsgByRule(a.lastMsg,g)}var h=this;if(!a.lastMsgContent)return{unreadMsgCount:a.unreadMsgNumber||a.unreadMsgCount||0};var g=this.lastMsgRule;return c(a),{chatUrl:(this.loaderHost||location.origin)+"/visitor/mobile/chat.html?companyId="+a.companyId+"&platformSign="+encodeURIComponent(a.signature)+"&metaData="+encodeURIComponent(this.queryParams.metaData)+"&myData="+encodeURIComponent(this.queryParams.myData),msgId:a.mid,platformId:a.platformId||void 0,companyId:a.companyId,companyLogo:a.companyLogo,companyName:a.companyName,msgContent:a.msgContent,unreadMsgCount:a.unreadMsgCount}},this.sendMsgboxUnread=function(){function a(a){if(!y&&_self.visitorId){var c;w.cookieName="unreadNewMsg_"+_self.visitorId,w.readySendName="unreadNewMsgMap_"+_self.visitorId,$.cookie(w.readySendName,""),w.cookieValue=$.cookie(w.cookieName),w.readySend=$.store(w.readySendName),w.readySend?w.readySend=JSON.parse(w.readySend):(w.readySend={order:[]},$.store(w.readySendName,'{ "order": [] }')),w.cookieValue&&(c=w.cookieValue.split("_")[0],w.readySend[c]&&v(w.readySend[c])),y=a}}function c(){w.readySend=$.store(w.readySendName),w.readySend=w.readySend?JSON.parse(w.readySend):{order:[]}}function h(a,h){c();var g=w.readySend.order;if(0===h){if(a.mid&&(w.readySend.lastMid=a.mid),g.length>0){w.readySend[a.mid]=void 0,delete w.readySend[a.mid];for(var i=0;i<g.length;i++)g[i]==a.mid&&g.splice(i,1)}}else if(!w.readySend[a.mid]&&(w.readySend[a.mid]=a,w.readySend.order.unshift(a.mid),w.readySend.order.length>10)){for(var i=10;i<g.length;i++)w.readySend[g[i]]=void 0,delete w.readySend[g[i]];w.readySend.order.length=10}$.store(w.readySendName,JSON.stringify(w.readySend))}function g(a){if(a&&(w.queue.push(a),h(a,1)),0!=w.queue.length){var c=$.cookie(w.cookieName);c&&(w.checkTimer||w.timeoutTimer)?w.checkTimer||w.timeoutTimer||(w.timeoutTimer=setTimeout(function(){w.timeoutTimer=null,g()},300)):(!c&&w.checkTimer&&clearTimeout(w.checkTimer),!c&&w.timeoutTimer&&clearTimeout(w.timeoutTimer),v(w.queue.shift()))}}function v(a){if(a){if(c(),w.readySend.lastMid&&w.readySend.lastMid>=a.mid)return g();w.cookieValue=a.mid+"_"+w.pageTag,$.cookie(w.cookieName,w.cookieValue),w.checkTimer=setTimeout(function(){w.checkTimer=null;var c=$.cookie(w.cookieName);c==w.cookieValue&&(y(a),$.cookie(w.cookieName,""),h(a,0)),$.cookie(w.cookieName)?w.timeoutTimer=setTimeout(function(){w.timeoutTimer=null,g()},300):g()},200)}}var w={cookieName:"",cookieValue:"",readySendName:"",readySend:{lastMid:"",order:[123],123:{}},queue:[],pageTag:(new Date).getTime(),checkTimer:null,timeoutTimer:null},y=null;return{send:g,queue:w.queue,init:a}}(),$(document).on("drag",function(e){return e=e||window.event,e.preventDefault&&e.preventDefault(),!1})}};UTIL.prototype.serverAdaptor={fuzzyBrandI18nRes:function(){}},window.SDK||(UTIL.prototype.serverAdaptor=new function(){var a=1,c={1:"/visitor/capture/CaptureInstall.exe?",2:"/visitor/capture/file/CaptureInstall.exe?"},h={1:"jietu.echatsoft.com:",2:"127.0.0.1:"},g={captureInstall:{2:"captureInstallNoBrand"}},v={1:"30127,30128",2:"30101,30101"};this.getCaptureFilePath=function(){var h="/visitor/capture/CaptureInstall.exe?";return"undefined"!=typeof a&&(h=c[a]||h),h},this.getCaptureServer=function(){var c="jietu.echatsoft.com:";return"undefined"!=typeof a&&(c=h[a]||c),c},this.fuzzyBrandI18nRes=function(c){var h="";for(var v in g)h=g[v][a],h&&(c[v]=c[h])},this.getCaptureSSL=function(){return 1!=a?!1:"https:"==location.protocol},this.getCapturePort=function(){return v[a||1]},this.getCaptureMark=function(){return 1==a?"echatsoft.com":""}}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.toString().replace(/(^\s+)|(\s+$)/g,"")}),Date.prototype.format=function(a){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in o)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?o[c]:("00"+o[c]).substr((""+o[c]).length)));return a},window.UTIL=UTIL,"undefined"==typeof console&&(window.console={log:function(){}})}(EChatQuery);
;/*!visitor/surfer/js/connect.js*/
!function(a){function c(){function c(a){j.publish("startChat",a)}function v(c){j.publish("endChat",c),j.isMini&&(j.unSubscribe(["sendVisitorEvent","visitorCommonEvent"]),k(),a.cometd.disconnect(),E=!0),j.publish("__newEvent",{act:200,eventAction:"Chat_End"})}function b(){j.hasInit=!1,j.unSubscribe("sendVisitorEvent")}function h(){if(!j.hasInit){j.hasInit=!0;{setTimeout(function(){j.hasInit=!1},2e3)}j.unSubscribe("sendVisitorEvent"),j.subscribe("sendVisitorEvent",function(c,v,b){switch(v.et+""){case"101":break;case"102":break;case"107":}A?a.cometd.publish("/service/visitor/event",v,b):j.msgQueue.push({channel:"/service/visitor/event",message:v,callback:b})}),j.publish("initSurfer")}}function I(){j.unSubscribe(["sendVisitorEvent","visitorCommonEvent"]),k(),a.cometd.disconnect(),E=!0}function k(c){return c?(L=null,Q=null,M=null,P=null,U=null,void(_=null)):(_&&a.cometd.unsubscribe(_),_=null,L&&a.cometd.unsubscribe(L),L=null,M&&a.cometd.unsubscribe(M),M=null,Q&&a.cometd.unsubscribe(Q),Q=null,P&&a.cometd.unsubscribe(P),P=null,U&&a.cometd.unsubscribe(U),U=null,H&&a.cometd.unsubscribe(H),void(H=null))}function y(){Q||(Q=a.cometd.subscribe("/visitor/selfmsg",j,j.receiveTrack)),_||(_=a.cometd.subscribe("/visitor/session/"+j.companyId+"/"+j.visitorId+"/"+j.sessionId,j,j.receiveTrack))}function g(){return j.isMini?void(M||(M=a.cometd.subscribe("/visitor/chat/"+j.companyId+"/"+j.visitorId,j,j.receiveTrack))):(P=a.cometd.subscribe("/visitor/track/"+j.companyId,j,j.receiveTrack),L=a.cometd.subscribe("/visitor/track/"+j.companyId+"/"+j.visitorId,j,j.receiveTrack),U||j.routeId&&(U=a.cometd.subscribe("/visitor/route/track/"+j.companyId+"/"+j.routeId,j,j.receiveTrack)),void("undefined"!=typeof j.subscribeUnread&&"0"==j.subscribeUnread||!j.platformId||H||(H=a.cometd.subscribe("/visitor/unread/"+j.platformId+"/"+j.visitorId,j,j.receiveTrack))))}function C(c){a.cometd.batch(function(){y()}),j.preClientId=j.curClientId,j.curClientId=c.clientId,c.data&&c.data.visitorId&&(j.visitorId=c.data.visitorId),j.isMini&&(g(),j.miniParam&&(j.miniParam.visitorId=j.visitorId,j.publish("handlePureInnerChat",j.miniParam),delete j.miniParam))}function S(){for(j.receive({data:{user:"system",chat:"Connection to Server Opened"}}),h();j.msgQueue.length>0&&A;){var c=j.msgQueue[0];a.cometd.publish(c.channel,c.data,c.callback),self.msgQueue.shift()}}function D(){j.receive({data:{user:"system",chat:"Connection to Server Closed"}})}function V(a){if(E)A=!1,D();else{var c=A;A=a.successful===!0,!c&&A?S():"402::Unknown client"==a.error&&(k(1),b())}}function T(a){a.successful&&a.data&&j.receiveTrack(a),a.successful&&C(a)}function w(a){return}UTIL.call(this,!0);var E,M,P,L,Q,U,_,H,j=this,A=!1;this.msgQueue=[],this.join=function(){E=!1,j.isMini=!1;var c=j.dataHost+j.ECHATConfig.contextPath;a.cometd.configure({url:c});var v="";"undefined"!=typeof encryptVID&&(v=encryptVID),"undefined"!=typeof chatVisitorId&&(j.chatVisitorId=chatVisitorId),j.platformSign=j.queryParams.platformSign||void 0;var b={from:1,companyId:j.companyId,encryptVId:v,metaData:j.metaData||void 0,myData:j.myData||void 0,info:j.info||void 0,vip:j.vip?1:0,platformSign:j.platformSign,lan:j.queryParams.lan||navigator.language||navigator.browserLanguage||void 0};a.cometd.handshake({data:b})},this.join_mini=function(){if(j.isMini=!0,"disconnected"==EChatQuery.cometd.getStatus()){E=!1;var c=j.dataHost+j.ECHATConfig.contextPath;a.cometd.configure({url:c});var v="";"undefined"!=typeof encryptVID&&(v=encryptVID);var b={from:1,companyId:j.companyId,encryptVId:v,metaData:j.metaData||void 0,myData:j.myData||void 0,info:j.info||void 0,vip:j.vip?1:0,lan:j.queryParams.lan||navigator.language||navigator.browserLanguage||void 0};a.cometd.handshake({data:b})}},j.subscribe("initMiniChat",function(c,v){"disconnected"==a.cometd.getStatus()&&(j.join_mini(),j.miniParam=a.extend(v,{chatVisitorId:j.chatVisitorId,status:1,chatStatus:2}))}),this.receiveTrack=function(b){var h=b.data;switch(h.mt+""){case"600":j.visitorId=h.visitorId,j.sessionId=h.sessionId,j.platformId=h.platformId,j.publish("handshake",h),w(h);break;case"601":j.publish("staffInvite",h);break;case"602":j.publish("staffChat",h);break;case"603":j.publish("companyState",h);break;case"604":c(h),j.publish("staffInfo",h);break;case"605":v(h);break;case"640":case"641":case"642":case"655":case"680":case"10011":j.publish("getMsg",h);break;case"10010":case"647":j.publish("getSysMsg",h);break;case"648":j.publish("queuePostion",h);break;case"654":L?j.publish("companyState",h):(j.visitorId=h.visitorId,j.routeId=h.routeId,1==h.independentJS&&(j.isMini=!0),g(),j.publish("startSurfer",h),2==h.chatStatus&&c(h));var I=h.externalLink?h.externalLink[0]:{};if(I.extLink&&I.keyword){var k=document.createElement("a");k.className="echatLink",k.href=I.extLink,k.innerText=I.keyword,document.body.appendChild(k)}break;case"685":j.publish("getNewUnreadMsgCount",h);break;case"684":j.publish("getNewUnreadMsgCount",h);break;case"923":var y=h.newVisitorId,C=h.oldVisitorId;j.visitorId=y,j.metaData=h.metaData,j.myData=h.myData,j.info=h.info,j.isMini||(C!=y&&(L?a.cometd.unsubscribe(L,void 0,function(){L=a.cometd.subscribe("/visitor/track/"+j.companyId+"/"+j.visitorId,j,j.receiveTrack)}):L=a.cometd.subscribe("/visitor/track/"+j.companyId+"/"+j.visitorId,j,j.receiveTrack)),j.publish("refreshVisitor",{visitorId:h.newVisitorId,metaData:h.metaData,myData:h.myData,info:h.info}));break;case"10009":return void a.cometd.disconnect()}},this.receive=function(){},j.subscribe("endSurfer",I),a.cometd.addListener("/meta/handshake",T),a.cometd.addListener("/meta/connect",V)}window.Connect=c}(EChatQuery);
;/*!visitor/surfer/js/surferClass.js*/
!function(a){var c=function(){function c(){var c=_.getChatLink();_.chatParam=c.params;var h=_.chatLink=c.chatLink;_.miniLink=c.miniLink,_.Browser.isMobile||(a("#ECHAT_icon_link").attr("href",h),a("#ECHAT_invite_accept").attr("href",h),a("#ECHAT_invite_mask").attr("href",h),a(".echat-menu-item-max").attr("href",h))}function h(a,c,h,v,g){var w={};return c?-1!=a.indexOf("left")?(w.marginLeft=c+"px",w.marginRight="auto"):(w.marginRight=c+"px",w.marginLeft="auto"):(w.marginLeft="auto",w.marginRight="auto"),h?-1!=a.indexOf("center")?(w.marginTop=-(g||0)/2+parseInt(h)+"px",w.marginBottom="auto"):-1!=a.indexOf("bottom")?(w.marginBottom=h+"px",w.marginTop="auto"):-1!=a.indexOf("top")&&(w.marginTop=h+"px",w.marginBottom="auto"):(-1!=a.indexOf("center")&&(w.marginTop=-(g||0)/2+"px",w.marginBottom="auto"),w.marginLeft="auto",w.marginRight="auto"),w}function v(){function c(){a(g).removeClass("echat-moving"),g.removeAttribute("unselectable"),a(g).off("mouseup",c),a(g).off("mousemove",v),a(g).off("mouseout",h)}function h(a){var h=a.toElement||{};"html"==(h.nodeName||h.tagName).toLowerCase()&&c(a)}function v(c){a(b).css({left:_.left+c.clientX-C.x+"px",right:"auto",bottom:_.bottom+C.y-c.clientY+"px",top:"auto",marginLeft:0,marginRight:0})}var g=document.body,w=document.getElementById("ECHAT_menu"),b=document.getElementById("ECHAT_mini"),_={},C={};a(w).on("mousedown",function(w){a(g).addClass("echat-moving"),g.setAttribute("unselectable","on");w.target;_.left=b.offsetLeft,_.bottom=parseInt(b.style.bottom)||0,C.x=w.clientX,C.y=w.clientY,a(g).on("mousemove",v),a(g).on("mouseup",c),a(g).on("mouseout",h)})}function g(a){return a?a.replace(/<(?:.|\s)*?>/gi,""):a}function w(c){_.needHttps&&(c.url=c.url.replace(/^http:/,_.needHttps)),c.url=_.addEchatInnerFrameParam(c.url);var h=document.getElementById("ECHAT_mini"),v="",g=document.getElementById("ECHAT_mini_site"),w=window.innerWidth,b=h.offsetLeft,C=h.clientWidth;"number"!=typeof w&&(w="CSS1Compat"==document.compatMode?document.documentElement.clientWidth:document.body.clientWidth),v=b>w-C-b?"echat-site-left":"echat-site-right",_.Browser.isMobile||(h.style.width=document.getElementById("ECHAT_mini_win").clientWidth+"px");var y='<div class="echat-site-back"><div class="echat-site-title" title="'+(c.title||"")+'">'+(c.title||"")+'</div><a class="echat-site-back-icon"></a></div><iframe id="ECHAT_site_iframe" name="echatSiteIframe" class="echat-site-iframe" src="'+c.url+'" allowtransparency="true" border="0" frameborder="0"></iframe>';if(g){a("#ECHAT_mini_site").html(y),a("#ECHAT_mini_site").addClass("echat-hidden");var I=a("#ECHAT_site_iframe").attr("src");I!=c.url&&a("#ECHAT_site_iframe").attr("src",c.url),setTimeout(function(){a("#ECHAT_mini_site").removeClass("echat-hidden")},120)}else{var T=document.createElement("DIV");T.className="echat-mini-site echat-hidden "+v,T.id="ECHAT_mini_site",h.appendChild(T),T.innerHTML=y,setTimeout(function(){a("#ECHAT_mini_site").removeClass("echat-hidden")},30)}_.postMessage({innerURL:"opening"})}function b(a){var c=a.src.toUpperCase();if("PNG"==c.substring(c.length-3,c.length)){var h=a.id?"id='"+a.id+"' ":"",v=a.className?"class='"+a.className+"' ":"",g=a.title?"title='"+a.title+"' ":"title='"+a.alt+"' ",w="display:inline-block;"+a.style.cssText;"left"==a.align&&(w="float:left;"+w),"right"==a.align&&(w="float:right;"+w),a.parentElement.href&&(w="cursor:hand;"+w);var b="<span "+h+v+g+' style="width:'+(a.width||a.clientWidth)+"px; height:"+(a.height||a.clientHeight)+"px;"+w+";filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a.src+"', sizingMethod='scale');\"></span>";a.outerHTML=b}}UTIL.call(this);var _=this;this.msgNum=0,this.hasMini=!1,this.staffInvite=0,this.ie6=/MSIE 6/g.test(navigator.userAgent),_.ltIE9=_.Browser.isIE&&_.Browser.version<9,this.companyOff=!1,this.Browser.isMobile&&-1!=navigator.userAgent.toLowerCase().indexOf("huawei")&&(this.isHuawei=!0),this.documentTitle=function(){if("title"in document)return document.title||"";var a,t=document.getElementsByTagName("title");return t&&t[0]?(a=t[0],"textContent"in a?a.textContent||"":"innerText"in a?a.innerText||"":""):(a=document.createElement("title"),document.getElementsByTagName("head")[0].appendChild(a),"")}(document),this.subscribe("initSurfer",function(){if(_.ltIE9||"undefined"!=typeof _.initMid)_.sendBaseInfo();else var t=0,a=setInterval(function(){t++,("undefined"!=typeof _.initMid||t>10)&&(clearInterval(a),_.sendBaseInfo())},50)}),this.subscribe("refreshVisitor",function(a,h){_.visitorId=h.visitorId,_.metaData=h.metaData,_.myData=h.myData,_.info=h.info,c()}),this.hasNative=function(){return"undefined"!=typeof window.EchatJsBridge||window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.callEchatNative}(),this.__nativeAPI=function(a,c){if(this.hasNative&&a)try{var h={functionName:a};"undefined"!=typeof c&&(h.value=c),"undefined"!=typeof EchatJsBridge?EchatJsBridge.callEchatNative(JSON.stringify(h)):window.webkit&&window.webkit.messageHandlers.callEchatNative.postMessage(JSON.stringify(h))}catch(e){}},function(){function a(a){var c;return c="string"==typeof a?JSON.parse(a+""):a}function c(c){try{var v=a(c);v.functionName&&(h[v.functionName]?h[v.functionName](v.value):(_.postMessage({action:"echatPageService",params:v}),("setLinkOpener"==v.functionName||"setMediaPlayer"==v.functionName)&&(_.chatAppCache[v.functionName]=v)))}catch(e){}}_.chatAppCache={};var h={};if(window.callEchatJs){var v=window.callEchatJs;window.callEchatJs=function(){c.apply(window,arguments),v.apply(window,arguments)}}else window.callEchatJs=c}(),this.showTip=function(){if(!document.all){var c=".leave-tip{position:absolute;top:140px;left:0;z-index:2147483647;font-size:1.4rem;text-align:center;width:100%;-moz-transition:all 500ms ease-in-out;-webkit-transition:all 500ms ease-in-out;-o-transition:all 500ms ease-in-out;-ms-transition:all 500ms ease-in-out;transition:all 500ms ease-in-out;}body .tiphide{opacity:0;visibility:hidden;}.leave-tip-content{position:relative;display:inline-block;margin:0 10px;line-height:24px;padding:5px 18px;word-wrap:break-word;overflow:hidden;background:rgba(0,0,0,0.5);color:#FFF;border-radius:18px;}.leave-tip-content .info-con{display:inline;padding:0;word-break: break-all;}";if(document.all)window.style=c,document.createStyleSheet("javascript:style"),window.style="";else{var h=document.createElement("style");h.type="text/css",h.innerHTML=c,document.getElementsByTagName("HEAD").item(0).appendChild(h)}var v=document.getElementById("leave-tip")||document.createElement("div");return v.id="leave_tip",v.className="leave-tip tiphide",document.getElementsByTagName("body").length&&document.getElementsByTagName("body")[0].appendChild(v),function(c){_.tipTimer&&clearTimeout(_.tipTimer);var h=document.getElementById("leave_tip");h.innerHTML='<div class="leave-tip-content"><div class="info-con" id="leave_tip_con">'+c+"</div></div>",h.className="leave-tip",_.tipTimer=setTimeout(function(){a("#leave_tip").addClass("tiphide")},3e3)}}}(),this.subscribe("handshake",function(c,h){function v(c){var h,v="",w=!1,b=location.host,_=a.cookie("echat_referrer")||"",C=a.cookie("echat_referrer_timer"),y=a.cookie("echat_referrer_pre"),I=!_;return I?(_=c,a.cookie("echat_referrer_timer","echat_referrer_timeout",{expires:1}),a.cookie("echat_referrer",_),a.cookie("echat_referrer_pre","")):(null!=c&&(h=g(c))&&h!=b&&c!=_&&c!=y&&(_=c,w=!0,a.cookie("echat_referrer_timer","echat_referrer_timeout",{expires:1}),a.cookie("echat_referrer",_),a.cookie("echat_referrer_pre","")),w||"direct"==_||C||(a.cookie("echat_referrer_pre",_),_="direct",a.cookie("echat_referrer",_))),"direct"!=_&&_&&(v=_),v}_.visitorId=h.visitorId,_.companyName=h.companyName,_.apiServerDomain=window.location.protocol+"//"+h.apiServerDomain,_.__nativeAPI("sendVisitorId",{visitorId:_.visitorId,encryptVId:window.encryptVID}),_.hasNative&&setTimeout(function(){_.postBridgeMessage({platformInit:!0,visitorId:h.visitorId})}),this.unSubscribe("getNewUnreadMsgCount"),this.subscribe("getNewUnreadMsgCount",function(a,c){(500002==c.platformId||500003==c.platformId||20==c.platformId)&&_.showTip("685"+c.lastMsgContent),c=_.formatUnreadMsg(c),_.publish("__newEvent",{act:100,eventAction:"platformNewMsg",eventLabel:c}),_.postBridgeMessage({platformNewMsg:c})});var g=function(a){return a?(-1!=a.indexOf("://")&&(a=a.substr(a.indexOf("://")+3)),-1!=a.indexOf("/")&&(a=a.substring(0,a.indexOf("/"))),a):void 0};_.referrer=v(document.referrer)}),this.subscribe("startSurfer",function(c,h){_.companyOff=2==h.status?!0:!1,_.visitorId=h.visitorId;var v=_.hasParsedParam,g=_.miniWinParam=h.chatBoxExtInfo,w=_.Device.getZoomLevel();if(!_.partScreen&&g&&g.chatBoxTopMargin&&parseInt(g.chatBoxTopMargin)>0&&(_.partScreen=parseInt(g.chatBoxTopMargin),(w>1.1||.9>w)&&(_.partScreen=_.partScreen/w)),h.independentJS&&(_.isMini=!0),(h.chatButtonInfo||h.mobileChatButtonInfo)&&_.parseParam(h),1!=_.Device.media||_.Browser.isMobile||_.setViewImgBox(),!v&&_.Browser.isMobile){var b=_.Device.getZoomLevel();1!=b&&a(".echat").css("zoom",1/b)}g&&1!=_.echatInnerFrame&&(_.pcMiniWinParam=a.extend({min:1==g.enableMinimizeBtn,max:1==g.enableMaximizeBtn,close:1==g.enableCloseBtn,width:g.floatingWindowWidth||400,height:g.floatingWindowHeight||550},_.pcMiniWinParam),g.minimizeBtnImg&&a(".echat-menu-item-min").css("background","inherit").html('<img src="'+(_.needHttps?g.minimizeBtnImg.replace(/^http:/i,_.needHttps):g.minimizeBtnImg)+'"/>'),g.maximizeBtnImg&&a(".echat-menu-item-max").css("background","inherit").html('<img src="'+(_.needHttps?g.maximizeBtnImg.replace(/^http:/i,_.needHttps):g.maximizeBtnImg)+'"/>'),g.chatEndBtnImg&&a(".echat-menu-item-close").css("background","inherit").html('<img src="'+(_.needHttps?g.chatEndBtnImg.replace(/^http:/i,_.needHttps):g.chatEndBtnImg)+'"/>'),_.companyOff||1!=g.enableOnlinePopAfterLoad||setTimeout(function(){!_.hasMini&&_.miniChat(void 0,8)},1e3*(parseInt(g.onlineAutoPopLoadTime)||0)),_.companyOff&&1==g.enableOfflinePopAfterLoad&&setTimeout(function(){!_.hasMini&&_.miniChat(void 0,8)},1e3*(parseInt(g.offlineAutoPopLoadTime)||0))),v||_.initTrailEvent(),(1==h.chatStatus||1==_.echatInnerFrame)&&(_.inviteTimeout&&clearTimeout(_.inviteTimeout),a("#ECHAT_invite").hide()),_.chatStatus=h.chatStatus,(_.isMini&&2!=_.chatStatus||1==_.echatInnerFrame)&&(_.inviteTimeout&&clearTimeout(_.inviteTimeout),_.publish("endSurfer")),_.isReady||(_.isReady=!0,_.publish("__ready")),_.isMini||1!=h.chatStatus&&2!=h.chatStatus||!_.visitorEventObj||(_.publish("sendVisitorEvent",_.visitorEventObj),_.visitorEventObj=null);var C=h.unreadMsgNumber||h.mNumber;if(C){if(_.setDocumentTitle("s"),_.miniUnfold)return;_.msgNum+=parseInt(C),a(".echat-mini-num").html(_.msgNum>9?"9+":_.msgNum).show(),_.publish("__newMsg",_.msgNum)}_.publish("__newEvent",{act:100,eventAction:"staffStatus",eventLabel:h.status}),setTimeout(function(){_.hasMini||a.cookie("ECHAT_"+_.companyId+"_"+_.visitorId+"_miniHide","0")},2e3)}),this.subscribe("staffInfo",function(a,c){var h=c.staffDetailInfo||{};_.chatStatus=2,_.staffLabel={staffId:c.staffId,staffNickName:c.staffNickName||"",staffPhone:h.staffPhone||"",staffHead:h.staffHead||"",staffInfo:h.staffInfo||""},_.publish("__newEvent",{act:100,eventAction:"chatStaffInfo",eventLabel:JSON.stringify({staffId:c.staffId,staffNickName:c.staffNickName||"",staffHead:h.staffHead||"",staffInfo:h.staffInfo||"",recordId:"1_"+c.talkId})})}),this.sendBaseInfo=function(){var c=_.initMid,h=a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read");c&&h&&(c=Math.max(c,h)),"undefined"!=c&&c||(c=void 0),this.baseInfo={et:101,companyId:_.companyId,page:location.href,title:_.documentTitle,referrer:_.referrer||"",media:_.Device.media,browserName:_.Browser.browser,browserVersion:_.Browser.version,osName:_.Device.OS,firstEnterUrl:_.firstUrl,firstEnterTitle:_.firstTitle,echatTag:_.echatTag||void 0,screenResolution:window.screen.width+"x"+window.screen.height,mid:c},_.bot&&(this.baseInfo.bot=1),ECHATObjKeyMap.cometdId.preClientId&&(this.baseInfo.preClientId=ECHATObjKeyMap.cometdId.preClientId),this.publish("sendVisitorEvent",this.baseInfo)};var C=location.href;this.getChatLink=function(a){function c(c){for(var h,i=0;i<c.length;i++)h=c[i],("undefined"!=typeof _.queryParams[h]||a[h])&&(g+="&"+h+"="+encodeURIComponent(a[h]||_[h]||_.queryParams[h]))}a=a||{};var h,v,g;(h=a.chatWindowParam||_.chatWindowParam)&&(h=JSON.stringify({maxWidth:h.maxWidth,maxHeight:h.maxHeight,bgColor:h.bgColor,bgImage:h.bgImage,bgRepeat:h.bgRepeat})),v=a.visEvt||_.visitorEventData||_.visEvt,"object"==typeof v&&(v=JSON.stringify(v)),g="?companyId="+_.companyId,1==a.autoPop&&(g+="&autoPop=1&autoChat="+a.autoChat),g+="&encryptVID="+encodeURIComponent(window.encryptVID||"")+"&chatVisitorId="+encodeURIComponent(window.chatVisitorId||"")+(1==a.acceptInvite?"&acceptInvite=1":""),c(["routeEntranceId","platformSign","metaData","myData","info","echatTag","fastQuestion","lan","defaultLan","pushInfo","subscribeUnread","echatTitleBar","businessUrl","businessIcon","multipleFile"]),g+=(h?"&chatWindowParam="+encodeURIComponent(h):"")+(v?"&visEvt="+encodeURIComponent(v):"")+"&enterUrl="+encodeURIComponent(C)+"&enterTitle="+encodeURIComponent(_.documentTitle)+"&firstUrl="+encodeURIComponent(_.firstUrl)+"&firstTitle="+encodeURIComponent(_.firstTitle)+(_.referrer?"&referrer="+encodeURIComponent(_.referrer):"")+(_.echatIframeDisable?"&echatIframeDisable="+(_.echatIframeDisable||""):"")+"&fromHost="+encodeURIComponent(window.location.protocol+"//"+window.location.host)+(_.dataHost?"&dataHost="+encodeURIComponent(_.dataHost):"");var w=this.loaderHost+"/visitor/",b=_.Device.getZoomLevel();return{chatLink:w+(_.Browser.isMobile?"mobile/chat.html":"pc/chat.html")+g,miniLink:w+(_.Browser.isMobile?.9>b|b>1.1?"mobile/miniMB2.html":"mobile/miniMB.html":"pc/miniPC.html")+g,params:g}},this.initMiniHTML=function(){if(!document.getElementById("ECHAT_mini_chat")){var c;if(_.data={icon:{enable:0},invite:{enable:0}},_.Browser.isMobile?0==a("#echat_mini_holder").results.length&&(c='<div class="echat-mini-holder echat-hide" id="echat_mini_holder"></div>'):0==a("#ECHAT_mini").results.length&&(c='<div id="ECHAT_mini" class="echat echat-mini echat-hide echat-left-bottom" style="margin: 0px 10px 23px; display: block;">  <div id="ECHAT_mini_win" class="echat echat-mini-win">  <div id="ECHAT_menu" class="echat-mini-btn echat-menu"><div class="echat-menu-list"><a draggable="false" class="echat-menu-item echat-menu-item-min" onclick="ECHAT.hideMiniChat(this)" onmousedown="return false" href="javascript:;"></a><a draggable="false" class="echat-menu-item echat-menu-item-max" onclick="return ECHAT.maxMiniChat(this)" ></a><a draggable="false" class="echat-menu-item echat-menu-item-close" onclick="ECHAT.closeMiniChat(this)" href="javascript:;"></a></div></div>    <iframe id="ECHAT_mini_chat" name="ECHAT_mini_chat" scrolling="no" border="0" allowtransparency="true" frameborder="0" ondragstart="return false" onselectstart="return false" onselect="if(document.selection)document.selection.empty()" oncopy="document.selection.empty()" onbeforecopy="return false"></iframe> </div><div id="echat_mm" class="echat-movable-cover"></div></div>'),!c)return;var h=document.createElement("div");h.innerHTML=c;for(var v,g=document.getElementsByTagName("body")[0],w=h.childNodes,i=0;v=w[i++];)1==v.nodeType&&(v=v.cloneNode(!0),g.appendChild(v));w=null,h=null}},this.initCheckChatStatus=function(){},this.initCheckNewMsg=function(){},this.parseParamMobile=function(c,v){var g=document.createElement("div"),w="",b=null;if(c.icon.buttonCanClose=0,c.icon){if("0"==c.icon.mobileType&&1==c.icon.buttonEnable){var C=v.offline?c.icon.buttonOfflineImg:c.icon.buttonOnlineImg,y=new Image;y.onload=function(){var v=a("#ECHAT_icon"),g=a("#ECHAT_icon_link"),w=this.width/2,b=this.height/2,_=h(c.icon.buttonDir||"right-center",c.icon.buttonSideMargin||0,c.icon.buttonBottomMargin||0,w,b);_.width=w+"px",_.height=b+"px",_.display="block",v.css(_),g.css({width:w+"px",height:b+"px"})},b='<div id="ECHAT_icon" class="echat echat-icon echat-'+(0!=c.icon.buttonDir&&c.icon.buttonDir?c.icon.buttonDir:"right-center")+'" style="display:none;"><div id="ECHAT_icon_link" class="echat-icon-link"  onclick="return ECHAT.miniChat(this,1)""> <img id="ECHAT_icon_img"  alt="'+ECHAT.LANG.iconTitle+'" class="echat-icon-img big_icon_inv" src="'+C+'"/><span class="echat-mini-num"></span></div></div>'}else if("1"==c.icon.mobileType&&1==c.icon.mobileTextEnable){var I=v.offline?c.icon.mobileOfflineTxt:c.icon.mobileOnlineTxt;b=' <div id="ECHAT_icon" class="echat echat-icon echat-icon-mb echat-'+c.icon.mobileDir+'" style="text-align:center;display:block;margin:'+(c.icon.mobileBottomMargin||0)+"px "+(c.icon.mobileSideMargin||0)+'px !important;">   <div id="ECHAT_icon_linkmb2" class="echat-icon-mb-text"    style="display:block;background: '+(c.icon.mobileBackColor||"false")+';color: #ffffff;"    onclick="return ECHAT.miniChat(this,2)">'+(I||ECHAT.LANG.clickChat)+' </div><div class="echat-mini-num"></div></div>'}!c.icon.renderId&&b&&(w+=b,b=null)}if(_.initInvite=function(h){_.initInvite=null;var v=new Image;v.onload=function(){var v=this.width/2,g=this.height/2;a("#ECHAT_invite").css({width:v+"px",height:g+"px",marginLeft:-v/2+"px",marginTop:-g/2+"px"}),"0"!=c.invite.enable?(_.inviteTimeout&&clearTimeout(_.inviteTimeout),_.hasMini||_.companyOff||(_.inviteTimeout=setTimeout(function(){var c=a("#ECHAT_invite");c.css({visibility:"visible"}),_.hasMini||_.companyOff||(c.show(),_.publish("__newEvent",{act:200,eventAction:"Chat_Invite_Show"}))},c.invite.inviteDelaySeconds?1e3*parseInt(c.invite.inviteDelaySeconds):0))):h?(a("#ECHAT_invite").css({visibility:"visible"}).show(),_.publish("__newEvent",{act:200,eventAction:"Chat_Invite_Show"})):a("#ECHAT_invite").hide().css({visibility:"visible"})};var g,w;c.invite.inviteAccpetBtnImg&&(g=new Image,g.onload=function(){a("#ECHAT_invite_accept").css({width:this.width/2+"px",height:this.height/2+"px",lineHeight:this.height/2+"px",background:"url("+c.invite.inviteAccpetBtnImg+") no-repeat",backgroundSize:this.width/2+"px,"+this.height/2+"px"})}),"1"==c.invite.inviteCanCancel&&c.invite.inviteCancelBtnImg&&(w=new Image,w.onload=function(){a("#ECHAT_invite_reject").css({width:this.width/2+"px",height:this.height/2+"px",lineHeight:this.height/2+"px",background:"url("+c.invite.inviteCancelBtnImg+") no-repeat",backgroundSize:this.width/2+"px,"+this.height/2+"px"})});var b=("1"==c.invite.inviteType?'  <img id="ECHAT_invite_bg"  class="echat-invite-bg" src="'+c.invite.inviteBackImg+'"/>  <div class="echat-invite-container">    <div class="echat-invite-title" style="'+(c.invite.inviteTitlePos||"")+';">'+(c.invite.inviteTitleTxt||"")+'</div>    <div class="echat-invite-text" style="'+(c.invite.inviteContentPos||"")+';">'+(c.invite.inviteContentTxt||"")+'</div>  </div>   <div id="ECHAT_invite_accept" class="echat-invite-accept" style="'+(c.invite.inviteAcceptBtnPos||"")+';" onclick="return ECHAT.miniChat(this,3)">     <span>'+(c.invite.inviteAcceptTxt||"&nbsp;")+"</span></div>"+("1"==c.invite.inviteCanCancel?'   <div id="ECHAT_invite_reject" class="echat-invite-reject" style="'+(c.invite.inviteCancelBtnPos||"")+';" onclick="ECHAT.rejectInvite(this,1)">'+(c.invite.inviteCancelTxt||"")+"</div>":""):'<div class="echat_invite_mask" id="ECHAT_invite_mask" onclick="return ECHAT.miniChat(this,3)" >  <img id="ECHAT_invite_bg" class="echat-invite-bg big_icon_inv" src="'+c.invite.inviteBackImg+'"/></div>')+("1"==c.invite.inviteCanClose&&c.invite.inviteCloseBtnImg?'<div id="ECHAT_invite_close" class="echat-invite-close cursor-p" style="'+c.invite.inviteCloseBtnPos+';line-height:0;" onclick="ECHAT.rejectInvite(this,2)"><img class="cursor-p button_icon" alt="'+ECHAT.LANG.close+'" src="'+c.invite.inviteCloseBtnImg+"\" onload=\"this.style.width=this.naturalWidth/2+'px';this.style.height=this.naturalHeight/2+'px';\"/></div>":"")+"</div>";v&&(v.src=c.invite.inviteBackImg),g&&(g.src=c.invite.inviteAccpetBtnImg),w&&(w.src=c.invite.inviteCancelBtnImg),document.getElementById("ECHAT_invite").innerHTML=b},"0"!=c.invite.enable&&setTimeout(_.initInvite,10),w+='<div id="ECHAT_invite" class="echat echat-invite '+("0"==c.invite.inviteType?"allimg":"")+'" style="visibility:hidden;display:'+(v.offline?"none;":"block;")+'"></div>',0==a("#echat_mini_holder").results.length&&(w=w+'<div class="echat-mini-holder echat-hide" id="echat_mini_holder">'+("file:"==location.protocol?'<div class="echat-mini-close" onclick="ECHAT.hideMiniChat()"></div>':"")+"</div>"),b){var T=document.createElement("div");T.id="ECHAT_icon_wrap",T.className="echat-icon-static",T.innerHTML=b,document.getElementById(c.icon.renderId).appendChild(T)}var E=navigator.userAgent.toLowerCase(),H=E.match(/bidubrowser|baidubrowser/i);if(_.Browser.isAndroid&&H&&a("body").addClass("android-bidubrowser"),_.isHuawei?(a("body").addClass("huawei"),_.Browser.isAndroid&&-1!=E.indexOf("baiduboxapp")&&a("body").addClass("android-baiduboxapp")):_.Browser.isIOS&&-1!=E.indexOf("baidubrowser")?a("body").addClass("ios-baidubrowser"):_.Browser.isAndroid&&E.match(/lite baiduboxapp/i)?a("body").addClass("android-lite-baiduboxapp"):_.Browser.isAndroid&&E.match(/baiduboxapp/i)?a("body").addClass("android-baiduboxapp"):_.Browser.isAndroid&&E.match(/vivobrowser/i)&&_.Browser.version<66&&a("body").addClass("android-vivo"),_.Browser.isAndroid&&H){var A="0"==c.icon.mobileType?c.icon.buttonDir:c.icon.mobileDir;A=-1!=A.indexOf("top")?0:-1!=A.indexOf("center")?.5:1,window.addEventListener("scroll",function(){var c=a("body").results[0].scrollTop;a("#ECHAT_icon").css("top",window.innerHeight*A+c+"px"),a("#ECHAT_invite").css("top",.5*window.innerHeight+c+"px")});var M=a("body").results[0].scrollTop;a("#ECHAT_icon").css("top",window.innerHeight*A+M+"px"),a("#ECHAT_invite").css("top",.5*window.innerHeight+M+"px")}g.innerHTML=w;for(var k,B=document.getElementsByTagName("body")[0],S=g.childNodes,i=0;k=S[i++];)1==k.nodeType&&(k=k.cloneNode(!0),B.appendChild(k));S=null,B=null,y&&(y.src=C),document.getElementById("echat_mini_holder").addEventListener("touchmove",function(e){return e.preventDefault&&e.preventDefault(),!1},!1)},this.parseParam=function(c){if(_.hasParsedParam)return void _.publish("companyState",c);if(_.hasParsedParam=!0,1==_.Device.media)var g={invite:c.inviteBoxInfo,icon:c.chatButtonInfo};else var g={invite:c.mobileInviteBoxInfo,icon:c.mobileChatButtonInfo};var w=this.data={offline:_.companyOff,blacklist:!1,themeColor:g.icon.innerColor,textColor:"#FFFFFF",miniToBlank:!1,invite:g.invite,icon:g.icon};1==_.echatInnerFrame&&(w.invite.enable="0");var b=_.getChatLink();_.chatParam=b.params;var C=_.chatLink=b.chatLink;if(_.miniLink=b.miniLink,_.needHttps){var y,I;if(g.invite){y=["inviteAccpetBtnImg","inviteBackImg","inviteCancelBtnImg","inviteCloseBtnImg"];for(var i=0;i<y.length;i++)I=g.invite[y[i]],I&&(g.invite[y[i]]=I.replace(/^http:/,_.needHttps))}if(g.icon){y=["buttonCloseIconImg","buttonOfflineImg","buttonOnlineImg","innerOfflineImg","innerOnlineImg"];for(var i=0;i<y.length;i++)I=g.icon[y[i]],I&&(g.icon[y[i]]=I.replace(/^http:/,_.needHttps))}}if(1!=_.Device.media||_.Browser.isMobile)return this.parseParamMobile(g,w,_.chatLink,_.miniLink);var T=document.createElement("div"),E="",H=null;if(g.icon.buttonCanClose=0,g.icon&&1==g.icon.buttonEnable){var A=w.offline?g.icon.buttonOfflineImg:g.icon.buttonOnlineImg,M=new Image;M.onload=function(){var c=a("#ECHAT_icon"),v=a("#ECHAT_icon_link");"0"==g.icon.buttonEnable?c.hide():c.show();var w=this.width,b=this.height,C=h(g.icon.buttonDir||"right-center",g.icon.buttonSideMargin||0,g.icon.buttonBottomMargin||0,w,b);if(C.width=w+"px",C.height=b+"px",c.css(C),v.css({width:w+"px",height:b+"px"}),correctPNG(document.getElementById("ECHAT_icon_img")),_.ie6){var y=document.getElementById("ECHAT_icon_img");y.style.width=w+"px",y.style.height=b+"px"}},H='<div id="ECHAT_icon" class="echat echat-icon echat-'+(0!=g.icon.buttonDir&&g.icon.buttonDir?g.icon.buttonDir:"right-center")+'" style="display:none;">'+("0"==g.icon.buttonOpenType?'<div target="_blank" id="ECHAT_icon_link" class="echat-icon-link" href="'+C+'" onclick="return ECHAT.miniChat(this,0)"><img id="ECHAT_icon_img" alt="'+ECHAT.LANG.iconTitle+'" class="echat-icon-img" src="'+A+'" /><span class="echat-mini-num"></span></div>':'<a target="_blank" id="ECHAT_icon_link" class="echat-icon-link" href="'+C+'" onclick="return ECHAT.iconChat(this)"><img id="ECHAT_icon_img" alt="'+ECHAT.LANG.iconTitle+'" class="echat-icon-img" src="'+A+'" /><span class="echat-mini-num"></span></a>')+"</div>",g.icon.renderId||(E+=H,H=null)}_.initInvite=function(c){_.initInvite=null;var h=new Image;h.onload=function(){var h=this.width,v=this.height;if(a("#ECHAT_invite").css({width:h+"px",height:v+"px",marginLeft:-h/2+"px",marginTop:-v/2+"px"}),correctPNG(document.getElementById("ECHAT_invite_bg")),_.ie6){var w=document.getElementById("ECHAT_invite_bg");w.style.width=h+"px",w.style.height=h+"px"}"0"!=g.invite.enable?(_.inviteTimeout&&clearTimeout(_.inviteTimeout),_.hasMini||_.companyOff||(_.inviteTimeout=setTimeout(function(){var c=a("#ECHAT_invite");c.css({visibility:"visible"}),_.hasMini||_.companyOff||(c.show(),_.publish("__newEvent",{act:200,eventAction:"Chat_Invite_Show"}))},g.invite.inviteDelaySeconds?1e3*parseInt(g.invite.inviteDelaySeconds):0))):c?(a("#ECHAT_invite").css({visibility:"visible"}).show(),_.publish("__newEvent",{act:200,eventAction:"Chat_Invite_Show"})):a("#ECHAT_invite").hide().css({visibility:"visible"})};var v,w;g.invite.inviteAccpetBtnImg&&(v=new Image,v.onload=function(){a("#ECHAT_invite_accept").css({width:this.width+"px",height:this.height+"px",lineHeight:this.height+"px",background:"url("+g.invite.inviteAccpetBtnImg+") no-repeat"})}),"1"==g.invite.inviteCanCancel&&g.invite.inviteCancelBtnImg&&(w=new Image,w.onload=function(){a("#ECHAT_invite_reject").css({width:this.width+"px",height:this.height+"px",lineHeight:this.height+"px",background:"url("+g.invite.inviteCancelBtnImg+") no-repeat"})});var b=("1"==g.invite.inviteType?'  <img id="ECHAT_invite_bg" class="echat-invite-bg" src="'+g.invite.inviteBackImg+'"/>  <div class="echat-invite-container">    <div class="echat-invite-title" style="'+(g.invite.inviteTitlePos||"")+';">'+(g.invite.inviteTitleTxt||"")+'</div>    <div class="echat-invite-text" style="'+(g.invite.inviteContentPos||"")+';">'+(g.invite.inviteContentTxt||"")+'</div>  </div>   <a id="ECHAT_invite_accept" class="echat-invite-accept" style="'+(g.invite.inviteAcceptBtnPos||"")+';" onclick="return ECHAT.inviteChat(this)" href="'+C+'" target="_blank">     <span>'+(g.invite.inviteAcceptTxt||"&nbsp;")+"</span></a>"+("1"==g.invite.inviteCanCancel?'   <div id="ECHAT_invite_reject" class="echat-invite-reject" style="'+(g.invite.inviteCancelBtnPos||"")+';" onclick="ECHAT.rejectInvite(this,1)">'+(g.invite.inviteCancelTxt||"")+"</div>":""):'<a target="_blank" class="echat_invite_mask" id="ECHAT_invite_mask" href="'+C+'" onclick="return ECHAT.inviteChat(this)">  <img id="ECHAT_invite_bg" class="echat-invite-bg" src="'+g.invite.inviteBackImg+'"/></a>')+("1"==g.invite.inviteCanClose&&g.invite.inviteCloseBtnImg?'<div id="ECHAT_invite_close" class="echat-invite-close cursor-p" style="'+g.invite.inviteCloseBtnPos+';" onclick="ECHAT.rejectInvite(this,2)"><img onload="correctPNG(this)" class="cursor-p" alt="'+ECHAT.LANG.close+'" src="'+g.invite.inviteCloseBtnImg+'"/></div>':"");h&&(h.src=g.invite.inviteBackImg),v&&(v.src=g.invite.inviteAccpetBtnImg),w&&(w.src=g.invite.inviteCancelBtnImg),document.getElementById("ECHAT_invite").innerHTML=b},"0"!=g.invite.enable&&setTimeout(_.initInvite,10),E+='<div id="ECHAT_invite" class="echat echat-invite '+("0"==g.invite.inviteType?"allimg":"")+'" style="visibility:hidden;display:'+(w.offline?"none;":"block;")+'"></div>';var k=w.offline?g.icon.innerOfflineTxt:g.icon.innerOnlineTxt,B=w.offline?g.icon.innerOfflineImg:g.icon.innerOnlineImg,S=["margin:0 "+(g.icon.innerSideMargin||10)+"px "+(g.icon.innerBottomMargin?g.icon.innerBottomMargin+"px;":"0;"),w.themeColor?"background-color:"+w.themeColor+";":""];if(E=E+'  <a  id="ECHAT_mini_icon" style="display:'+("0"==g.icon.innerEnable?"none;":"block;")+S.join("")+';"  class="echat echat-mini echat-mini-icon cursor-p  echat-'+(0!=g.icon.innerDir&&g.icon.innerDir?g.icon.innerDir:"left-bottom")+'" onclick="return ECHAT.miniChat(this,2)">'+(B?'    <div class="echat-mini-img cursor-p"  style="display:'+(B?"block":"none")+';"><img width="26"  height="18" onload="correctPNG(this)" class="echat-mini-img-img" src="'+(B||"")+'"/></div>':"")+'    <div class="echat-mini-text cursor-p" style="padding-left:'+(B?"44":"14")+'px;">'+(k||ECHAT.LANG.clickChat)+'</div>    <div class="echat-mini-num"></div>  </a>',0==a("#ECHAT_mini").results.length&&(S.splice(S.length-1,1),E=E+'<div id="ECHAT_mini" class="echat echat-mini echat-hide echat-mini-pc echat-'+(0!=g.icon.innerDir&&g.icon.innerDir?g.icon.innerDir:"left-bottom")+' " style="'+S.join("")+'">  <div id="ECHAT_mini_win" class="echat echat-mini-win">    <div id="ECHAT_menu"  class="echat-mini-btn echat-menu" ><div class="echat-menu-list"><a draggable="false" class="echat-menu-item echat-menu-item-min" onclick="ECHAT.hideMiniChat(this)" href="javascript:;"></a><a draggable="false" class="echat-menu-item echat-menu-item-max" onclick="return ECHAT.maxMiniChat(this)" target="_blank" href="'+_.chatLink+'" ></a><a draggable="false" class="echat-menu-item echat-menu-item-close" onclick="ECHAT.closeMiniChat(this)" href="javascript:;"></a></div></div>    <iframe id="ECHAT_mini_chat" name="ECHAT_mini_chat" scrolling="no" border="0" allowtransparency="true" frameborder="0" ondragstart="return false" onselectstart="return false" onselect="if(document.selection)document.selection.empty()" oncopy="document.selection.empty()" onbeforecopy="return false"></iframe>  </div><div id="echat_mm" class="echat-movable-cover"></div></div>'),H){var I=document.createElement("div");I.id="ECHAT_icon_wrap",I.className="echat-icon-static",I.innerHTML=H,document.getElementById(g.icon.renderId).appendChild(I)}this.coverFlash(),T.innerHTML=E;for(var L,P=document.getElementsByTagName("body")[0],N=T.childNodes,i=0;L=N[i++];)1==L.nodeType&&(L=L.cloneNode(!0),P.appendChild(L));N=null,P=null,M&&(M.src=A),_.ie6&&_.parseIE6Png(),v(g.icon),a("#ECHAT_mini").on("click",".echat-site-back-icon",function(){_.hideInnerURLPage()})},this.setViewImgBox=function(){var a='<div id="ECHAT_IMG_VIEW" class="ECHAT_IMG_VIEW hide" draggable="false"><div class="img-play-close"></div><div class="img-play-foot"><div class="img-play-pre img-play-btn"><i class="img-play-pre-icon"></i></div><div class="img-play-next img-play-btn cursor-p"><i class="img-play-next-icon"></i></div><a class="img-play-download img-play-btn cursor-p" target="downFile"><i class="img-play-download-icon"></i></a><div class="img-play-rotate img-play-btn cursor-p"><i class="img-play-rotate-icon"></i></div></div><div class="img-play-resize"></div><div id="echat_img_play_loading" class="img-play-loading"></div><ul id="echat_img_play_list" class="clearfix img-play-list transition"></ul></div>',c=document.getElementsByTagName("body")[0],h=document.createElement("div");h.innerHTML=a,c.appendChild(h.childNodes[0])},this.showImg=function(){var c=arguments[0].imgList,h=arguments[0].imgIndex,v=document.documentElement.clientHeight||a("body")[0].clientHeight||window.innerHeight,g=document.documentElement.clientWidth||a("body")[0].clientWidth||window.innerWidth,w=g>800?800:g-20,b=v>680?680:v-20;_.imgLength=c.length,_.imgIndex=h,_.setPreNext(),_.initSlideImgFlag||_.initSlideImg(),a("#echat_img_play_list").css({width:w*c.length+"px",height:b-100+"px",left:-w*_.imgIndex+"px"}).html(c.join("")),a("#echat_img_play_list li").css({width:w+"px",height:b-100+"px",lineHeight:b-100+"px"}),a(".img-play-btn").removeClass("hover-btn"),a(".img-play-close").removeClass("hover"),a("#img_dot_list").removeClass("hover"),a("#ECHAT_IMG_VIEW").css({width:w+"px",height:b+"px",left:(g-w)/2+"px",top:(v-b)/2+"px"}).removeClass("hide");
var C=a(a(a("#echat_img_play_list").find("li").results[h]).find("img").results[0]),y=C.attr("attname"),I=C.attr("bigimg")||C.attr("big"),T=I.match(/[^\/]+\.[\w]+$/);a(".img-play-download").attr("href",I+(-1==I.indexOf("?")?"?":"&")+"attname="+((y?y:T?T[0]:0)||"Echat"+(new Date).format("yyyyMMddhhmmss")+".png"))},this.setPreNext=function(){0==_.imgIndex?a(".img-play-pre").addClass("disabled"):a(".img-play-pre").removeClass("disabled"),_.imgIndex==_.imgLength-1?a(".img-play-next").addClass("disabled"):a(".img-play-next").removeClass("disabled")},this.initSlideImg=function(){function c(p,c){if(!(0>p||p>_.imgLength-1||p==_.imgIndex)){var h=a(a(a("#echat_img_play_list").find("li").results[p]).find("img").results[0]),v=h.attr("attname"),g=h.attr("bigimg")||h.attr("big");if(h.attr("loaded"))a("#echat_img_play_loading").hide();else{a("#echat_img_play_loading").show();var w=new Image;h.css({top:0,left:0}),w.onload=function(){h.css("visibility","hidden"),h.attr("src",h.attr("bigimg")),w.onload=null,w=null,h=null},w.src=g}var b=g.match(/[^\/]+\.[\w]+$/);if(a(".img-play-download").attr("href",g+(-1==g.indexOf("?")?"?":"&")+"attname="+((v?v:b?b[0]:0)||"Echat"+(new Date).format("yyyyMMddhhmmss")+".png")),c){var ul=a("#echat_img_play_list"),C=a(a("#echat_img_play_list").find("li").results[0]).width();_.setTransform.call(ul,-C*p,0),ul.attr("x",-C*p)}_.imgIndex=p,_.setPreNext()}}function h(){}function v(){function c(e){if(I){var x=T.x-(e.pageX||e.clientX),c=T.y-(e.pageY||e.clientY);x=v.width-x,c=v.height-c,200>x&&(x=200),200>c&&(c=200),b.css({width:x+"px",height:c+"px"}),a("#echat_img_play_list li").css({width:x+"px",height:c-100+"px",lineHeight:c-100+"px"}),a("#echat_img_play_list").css({width:x*a("#echat_img_play_list li").length+"px",height:c+"px",left:-x*_.imgIndex+"px"}),(x-8<h.width||c-100<h.height)&&g.css({width:x-8+"px"})}w()}var h,v,g,y=a(".img-play-resize"),I=0,T={x:0,y:0};y.on("mousedown",function(e){g=a(a(a("#echat_img_play_list").find("li").results[_.imgIndex]).find("img").results[0]),I=1,T={x:e.pageX||e.clientX,y:e.pageY||e.clientY},v={width:b.width(),height:b.height()},h={width:g.results[0].naturalWidth,height:g.results[0].naturalHeight},e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),w(),C.on("mousemove",c)}),C.on("mouseup",function(){I&&(I=0,C.off("mousemove",c))}),a(window).on("resize",function(){var c=document.documentElement.clientHeight||a("body")[0].clientHeight||window.innerHeight,h=document.documentElement.clientWidth||a("body")[0].clientWidth||window.innerWidth,v={width:b.width(),height:b.height()};b.css({top:(c-v.height)/2+"px",left:(h-v.width)/2+"px"})})}function g(){function c(e){if(T){var a={};h.width<v.width&&(a.left=v.offsetLeft+(e.pageX||e.clientX)-E.x+"px"),h.height<v.height&&(a.top=v.offsetTop+(e.pageY||e.clientY)-E.y+"px"),g.css(a),y=1}else if(I){var c=e.pageX-E.x,_=e.pageY-E.y;b.css({left:h.left+c+"px",top:h.top+_+"px"})}w()}var h,v,g,I=0,T=0,E={};b.on("mousedown",function(e){g=a(a(a("#echat_img_play_list").find("li").results[_.imgIndex]).find("img").results[0]),h={width:b.width(),left:b.results[0].offsetLeft,top:b.results[0].offsetTop,height:b.height()},v={width:g.results[0].clientWidth,height:g.results[0].clientHeight,offsetLeft:g.results[0].offsetLeft,offsetTop:g.results[0].offsetTop},E={x:e.pageX||e.clientX,y:e.pageY||e.clientY},h.width<v.width||h.height-100<v.height?T=1:I=1,C.on("mousemove",c),e.stopPropagation&&e.stopPropagation(),w()}),C.on("mouseup",function(){(T||I)&&(T=0,I=0,g=null,C.off("mousemove",c))})}_.initSlideImgFlag=!0,window.centerImg=function(c,h){a("#echat_img_play_loading").hide();a("#ECHAT_IMG_VIEW").height();c.style.visibility="visible",h&&(a(c).attr("loaded","loaded"),c.onload=null)},a("#ECHAT_IMG_VIEW").on("click",".img-play-pre",function(){c(_.imgIndex-1,!0)}).on("click",".img-play-next",function(){c(_.imgIndex+1,!0)}).on("click",".img-play-close",function(){a("#ECHAT_IMG_VIEW").addClass("hide"),_.imgIndex=0}).on("click",".img-play-rotate",function(){var c=a(a(a("#echat_img_play_list").find("li").results[_.imgIndex]).find("img").results[0]);c.hasClass("rotate-90")?(c.removeClass("rotate-90"),c.addClass("rotate-180")):c.hasClass("rotate-180")?(c.removeClass("rotate-180"),c.addClass("rotate-270")):c.hasClass("rotate-270")?c.removeClass("rotate-270"):c.addClass("rotate-90")}).on("mouseover",".img-play-btn",function(){a(this).addClass("hover-btn")}).on("mouseout",".img-play-btn",function(){a(this).removeClass("hover-btn")}).on("mouseover",function(){a(this).addClass("hover"),a("#ECHAT_IMG_VIEW .img-play-foot").addClass("hover")}).on("mouseout",function(){a(this).removeClass("hover"),a("#ECHAT_IMG_VIEW .img-play-foot").removeClass("hover")}),a("#ECHAT_IMG_VIEW .img-play-close").on("mouseover",function(){a(".img-play-close").addClass("hover")}).on("mouseout",function(){a(".img-play-close").removeClass("hover")});var w="getSelection"in window?function(){window.getSelection().removeAllRanges()}:function(){document.selection.empty()},b=a("#ECHAT_IMG_VIEW"),C=a("body");v();var y=0;g();var I=2;a("#ECHAT_IMG_VIEW").on("mousewheel","img",function(e){var c=this,v=c.width-e.deltaY/1.5;return 30>v&&(v=30),v>c.naturalWidth*I&&(v=c.naturalWidth*I),a(c).css({maxWidth:"10000px",maxHeight:"10000px",width:v+"px"}),h(),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}),a("#ECHAT_IMG_VIEW").on("keydown",function(e){var a=e.keyCode;return a>=37&&40>=a?(e.preventDefault||e.preventDefault(),!1):void 0}),a(document).on("keydown",function(e){e=e||window.event,e=e||window.event;var h=e.keyCode||e.which||e.charCode||0;37!=h&&39!=h||a("#ECHAT_IMG_VIEW").hasClass("hide")||(37==h?c(_.imgIndex-1,!0):39==h&&c(_.imgIndex+1,!0))})},this.setTransform=function(x,c){a(this).css({left:x+"px",top:c+"px"})},this.coverFlash=function(){},this.showInvite=function(){},this.showIcon=function(){},this.init=function(){},this.postBridgeMessage=function(a){window.addEventListener&&document.getElementById("echatBridgeIframe")&&(document.getElementById("echatBridgeIframe").contentWindow||document.frames.echatBridgeIframe).postMessage(a,"*")},this.subscribe("_openChat",function(a,c){if("blank"==c.type);else if("inner"==c.type);else if("default"==c.type){if(!_.Browser.isMobile&&_.openEchatWin&&!_.openEchatWin.closed)try{return void _.openEchatWin.focus()}catch(e){}if(1==_.echatInnerFrame&&!_.mixedCompany)return void _.postChatMessage({evt:"echatjs",type:"openChat"});var h;if("invite"==c.from&&(h={acceptInvite:1}),_.Browser.isMobile)_.openEchatWin=window.open(_.getChatLink(h).chatLink);else{if((2==_.chatStatus||1==_.chatStatus||"undefined"==typeof _.chatStatus)&&(_.targetWinName="ECHAT_WIN"+(new Date).getTime()),_.queryParams.chatWindowParam)return ECHAT.customNewWinChat(_.queryParams);var v=(window.screen.height-30-600)/2,g=(window.screen.width-10-900)/2;_.openEchatWin=window.open(_.getChatLink(h).chatLink,_.targetWinName,"width=900,height=600,top="+v+",left="+g+",directories=no,menubar=no,toolbar=no")}}}),this.msgBoxPageBack=function(){this.msgBoxWindow?this.msgBoxWindow.postMessage({evt:"echatjs",name:"msgBoxPageBack"},"*"):_.publish("__newEvent",{act:100,eventAction:"echatPageStatus",eventLabel:{event:3}})},_.canRefresh=!1,window.addEventListener&&(_.postMessageSources=[],window.addEventListener("message",function(e){if(e.data){var h=e.data,v=e.source;if("echatjs"!=h.evt)if("initWxSDK"!=h.type){if("wxSwipeImage"==h.type&&wx.previewImage({current:h.url[h.index||0],urls:h.url}),"msgbox"==h.type)return void("msgboxReady"==h.name?_.msgBoxWindow=v:"echatPageStatus"==h.name&&h.data&&_.publish("__newEvent",{act:100,eventAction:"echatPageStatus",eventLabel:h.data}));if(_.loaderHost&&e.origin==_.loaderHost){if(e.data&&e.data.isBridge)return _.handleBridge(e.data);if(2==e.data)_.canRefresh=!1;else if("miniReady"==e.data){if(_.miniReady=!0,_.postMessage({action:"sendMiniShowStatus",miniShow:_.miniUnfold}),_.visitorId&&!_.hasInitLocalHistory){var g="CHAT_HIS_"+_.companyId+"_"+_.visitorId;_.postMessage({type:"initLocalHistory",key:g,value:window.localStorage.getItem(g)||"",robotPhoneChatBox:window.localStorage.getItem("ECHAT_"+_.companyId+"_robotPhoneChatBox")||"",mobileChatBoxInfo:window.localStorage.getItem("ECHAT_"+_.companyId+"_mobileChatBoxInfo")||""}),_.hasInitLocalHistory=!0}for(var w in _.chatAppCache)_.postMessage({action:"echatPageService",params:_.chatAppCache[w]})}else if(3==e.data)_.canRefresh=!0;else if("hideMBmini"==e.data||"hideMini"==e.data)_.hideMiniChat();else if("hideMBminiNoBack"==e.data)_.hideMiniChat(!0,!0);else if("topScroll"==e.data);else if("inputScroll"==h.type)_.handleKeyboard.focus(h);else if("inputScrollStop"==e.data)_.handleKeyboard.blur(h);else if("toLeaveMessage"==e.data)a(".echat-staff").addClass("echat-hide");else if(100==e.data.act||200==e.data.act){if(100==e.data.act){if("chatStaffInfo"==e.data.eventAction||EChatQuery.cometd.getStatus().match(/connected|connecting/i)&&e.data.eventAction.match(/newMsg|newSysMsg|queuePostion/i))return;if("chatStaffInfo"==e.data.eventAction){var h=JSON.parse(e.data.eventLabel);delete h.userSetStaffPhoto,_.staffLabel=h}else"chatStatus"==e.data.eventAction&&(e.data.eventLabel.match(/^end/)?(_.chatStatus=4,_.staffLabel=""):"chatting"==e.data.eventLabel?(_.chatStatus=2,!_.isMini||a.cometd&&"disconnected"!=a.cometd.getStatus()||_.publish("initMiniChat",{fromInner:!0}),_.visitorEventData="",c()):e.data.eventLabel.match(/^leave/)?_.chatStatus=0:"waiting"==e.data.eventLabel&&(_.chatStatus=1,_.visitorEventData="",c()),_.miniChatStatus=e.data.eventLabel)}_.publish("__newEvent",e.data)}else 300==e.data.act?_.handleInnerURLPage(e.data):"native"==h.action&&h.params?_.__nativeAPI(h.params.functionName,h.params.value):"bridgePlatformNewMsg"==h.type&&h.data?(_.__nativeAPI("platformNewMsg",h.data),(500002==h.data.platformId||500003==h.data.platformId||20==h.data.platformId)&&_.showTip("platformNewMsg"+h.data.msgContent)):"initLocalHistory"==h.type?(!_.hasInitLocalHistory&&_.postMessage({type:"initLocalHistory",key:h.key,value:window.localStorage.getItem(h.key)||"",robotPhoneChatBox:window.localStorage.getItem("ECHAT_"+_.companyId+"_robotPhoneChatBox")||"",mobileChatBoxInfo:window.localStorage.getItem("ECHAT_"+_.companyId+"_mobileChatBoxInfo")||""}),_.hasInitLocalHistory=!0):("updateLocalHistory"==h.type||"updateLocalChatbox"==h.type)&&_.hasStorage&&window.localStorage.setItem(h.key,h.value);return!1}}else if("function"==typeof define&&(define.amd||define.cmd)&&"function"==typeof require)try{{require([h.src],function(a){window.wx=window.wx||a,_.postMessage({action:"hasWxSdk"})})}}catch(e){}else _.addJS(h.src,function(a){a!==!0&&_.postMessage({action:"hasWxSdk"})});else if("echatInnerFrame"==h.type&&v)try{var b={type:"echatInnerFrameCallback",companyId:_.companyId,visitorId:_.visitorId,chatVisitorId:window.chatVisitorId,encryptVID:window.encryptVID,metaData:_.metaData||""};v.postMessage(b,h.origin),-1==_.postMessageSources.indexOf(v)&&_.postMessageSources.push(v)}catch(e){}else"openChat"==h.type?(_.postMessage({evt:"echatjs",type:"openChat"}),_.miniChat()):"closeFramePage"==h.type?(_.hideInnerURLPage(),_.__nativeAPI("closeUrlView")):"sendTextMsg"==h.type&&_.postMessage({evt:"echatjs",type:"sendTextMsg",content:h.content})}},!0)),this.initTrailEvent=function(){function h(){_.initInvite&&_.initInvite(!0),setTimeout(function(){_.staffInvite++,_.inviteTimeout&&clearTimeout(_.inviteTimeout),a("#ECHAT_invite").show().css({visibility:"visible"})}),_.publish("__newEvent",{act:200,eventAction:"Chat_Invite_Show"})}function v(c,h){if(c.mid&&!b[c.mid]){b[c.mid]=1;var v;if("680"==c.mt&&(v='<a target="_blank" href="'+c.pushUrlDetail.url+'">'+c.pushUrlDetail.urlName+"</a>"),v=v||_.parseMsgByRule(c,w),v&&_.publish("__newEvent",{act:100,eventAction:1==h?"newMsg":"newSysMsg",eventLabel:v}),!_.Browser.isMobile){var g=a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read_click"),C=_.bridgeData&&_.bridgeData.midClick;g=C>g?C:g,(!g||g<c.mid)&&_.setDocumentTitle("s")}_.lasMid=_.lasMid||a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read")||0,_.lasGetMid=c.mid,_.miniUnfold&&c.mid?a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read",c.mid):"605"!=c.mt&&(_.msgNum++,a(".echat-mini-num").html(_.msgNum>9?"9+":_.msgNum).show(),_.publish("__newMsg",_.msgNum))}}function g(c,v){_.unSubscribe("staffInvite"),_.subscribe("staffInvite",h),_.chatStatus=4,_.staffLabel="",v&&v.content&&_.publish("getSysMsg",v),a.cookie("ECHAT_"+_.companyId+"_"+_.visitorId+"_miniHide","0")}this.subscribe("companyState",function(c,h){var v=_.companyOff;_.companyOff=2==h.status?!0:!1,v&&!_.companyOff?(_.offToOn=!0,_.onToOff=!1):!v&&_.companyOff?(_.onToOff=!0,_.offToOn=!1):(_.onToOff=!1,_.offToOn=!1),_.companyOff?(_.inviteTimeout&&clearTimeout(_.inviteTimeout),a("#ECHAT_invite").hide(),a(".echat-icon-img").attr("src",_.data.icon.buttonOfflineImg),a(".echat-mini-text").html(_.data.icon.innerOfflineTxt),a(".echat-mini-img-img").attr("src",_.data.icon.innerOfflineImg),a("#ECHAT_icon_linkmb2").html(_.data.icon.mobileOfflineTxt)):(a(".echat-icon-img").attr("src",_.data.icon.buttonOnlineImg),a(".echat-mini-text").html(_.data.icon.innerOnlineTxt),a(".echat-mini-img-img").attr("src",_.data.icon.innerOnlineImg),a("#ECHAT_icon_linkmb2").html(_.data.icon.mobileOnlineTxt),1==_.data.invite.enable&&(_.inviteTimeout&&clearTimeout(_.inviteTimeout),_.offToOn&&a("#ECHAT_invite").show().css({visibility:"visible"}),_.publish("__newEvent",{act:200,eventAction:"Chat_Invite_Show"}))),_.publish("__newEvent",{act:100,eventAction:"staffStatus",eventLabel:h.status})}),this.subscribe("staffChat",function(a,c){var h=_.companyOff;h&&(_.offToOn=!0,_.onToOff=!1),_.miniChat(void 0,5),_.postMessage({action:"staffChat",msg:c}),h&&(_.onToOff=!0,_.offToOn=!1)});var w={0:ECHAT.LANG.newMsg,605:"${content,0,200,1}",640:"${content,0,200,1}",641:ECHAT.LANG.imageMsg,642:ECHAT.LANG.fileMsg,647:"${content,0,200,1}",10011:ECHAT.LANG.customMsg,865:ECHAT.LANG.imageMsg,866:ECHAT.LANG.fileMsg};_.unSubscribe("getMsg"),_.unSubscribe("getSysMsg");var b={};_.subscribe("getMsg",function(a,c){if("10011"==c.mt){if(3==c.mst)return _.publish("getSysMsg",c);if(1==c.mst)return}v(c,1)}),_.subscribe("getSysMsg",function(a,c){return"647"==c.mt&&5==c.type?_.publish("getMsg",c):void(("647"!=c.mt||6!=c.type&&8!=c.type&&9!=c.type)&&v(c,2))}),_.subscribe("queuePostion",function(a,c){_.publish("__newEvent",{act:100,eventAction:"queuePostion",eventLabel:c.position||""})}),_.unSubscribe("__newMsg");var C=0;_.subscribe("__newMsg",function(a,c){C!=c&&(C=c,_.miniWinParam&&c>0&&!_.companyOff&&1==_.miniWinParam.enableOnlineChatWhenMsg&&_.miniChat(void 0,9))}),_.subscribe("clearGetMsg",function(c,h){_.msgNum=0,a(".echat-mini-num").hide().html(""),_.publish("__newMsg",_.msgNum),h&&h.mid&&a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read",h.mid)}),this.updateBridgeRead=function(a){window.addEventListener&&document.getElementById("echatBridgeIframe")&&(document.getElementById("echatBridgeIframe").contentWindow||document.frames.echatBridgeIframe).postMessage({update:!0,updateType:a.type,updateValue:a.value},"*")},this.subscribe("startChat",function(h,v){_.visitorEventData="",c(),2==v.chatStatus,_.miniUnfold&&4==_.chatStatus&&_.canRefresh&&_.restartMiniChat(),_.chatStatus=2,_.inviteTimeout&&clearTimeout(_.inviteTimeout),a("#ECHAT_invite").hide(),_.unSubscribe("staffInvite"),a(".echat-staff").removeClass("echat-hide")}),_.subscribe("endChat",g),this.subscribe("staffInvite",h),this.subscribe("_rejectInvite",function(){_.publish("sendVisitorEvent",{et:102,content:ECHAT.LANG.rejectInvite})})},this.supportPartScreen=function(){var a=navigator.userAgent.toLocaleLowerCase();if(_.Device.isIOS){if(-1!=a.indexOf("baidubrowser"))return!1}else if(_.Browser.isAndroid&&-1!=a.indexOf("baiduboxapp"))return!1;return!0}(),this.hasPartScreen=!1,this.setMobilePageHeight=function(c){var h=c?c-0:!1;_.partScreen=h;var v=_.Device.getZoomLevel();(v>1.1||.9>v)&&(_.partScreen=h="number"==typeof h?_.partScreen/v:80/v);var g,w=document.documentElement;if(w&&a(w).removeClass("echat-html"),_.Browser.isMobile&&_.partScreen&&_.supportPartScreen){a("body").removeClass("echat-body-hide");var b="";"number"==typeof h?(b=h+"px",g="calc(100% - "+h+"px)"):_.partScreen&&(b="80px",g="calc(100% - 80px)"),a("#ECHAT_mini_chat").css({top:b,height:g}),a("body").addClass("echat-body-fix"),_.hasPartScreen=!0}else _.Browser.isMobile&&(a("body").removeClass("echat-body-fix"),a("#ECHAT_mini_chat").css({top:0,height:"100%"}))},this.rejectInvite=function(c,h){a("#ECHAT_invite").hide(),_.staffInvite&&_.publish("_rejectInvite"),2==_.data.invite.inviteTimes&&_.data.invite.inviteRepeat>0&&(_.inviteTimeout=setTimeout(function(){a("#ECHAT_invite").show().css({visibility:"visible"}),_.publish("__newEvent",{act:200,eventAction:"Chat_Invite_Show"}),_.data.invite.inviteRepeat=+_.data.invite.inviteRepeat-1},_.data.invite.inviteIntervalSeconds?1e3*+_.data.invite.inviteIntervalSeconds:5e3)),1==h?_.publish("__newEvent",{act:200,eventAction:"Chat_Invite_Refuse"}):2==h&&_.publish("__newEvent",{act:200,eventAction:"Chat_Invite_Close"})},this.iconChat=function(){return _.publish("_openChat",{type:"default",from:"icon"}),!1},this.inviteChat=function(){return _.publish("__newEvent",{act:200,eventAction:"Chat_Invite_Agree"}),_.publish("_openChat",{type:"default",from:"invite"}),!1},this.maxMiniChat=function(){return _.publish("_openChat",{type:"default",from:"mini"}),!1},this.restartMiniChat=function(){this.miniUnfold=!0,_.miniLink=_.getChatLink(arguments[2]).miniLink,_.hasMini&&_.setMiniSrc(_.miniLink+"&time="+(new Date).getTime()+"#TOECHAT",{replace:!0})},this.sendTextMsg=function(a,c){if("undefined"!=typeof a){a+="";var h=!0;if(c||(c=function(){}),window.top==self&&(navigator.userAgent.match(/Echat_WKWeb/i)||window.EchatJsBridge))return _.sendTextMsgApi(a,c);h=1==_.echatInnerFrame?_.postChatMessage({evt:"echatjs",type:"sendTextMsg",content:a}):_.postMessage({evt:"echatjs",type:"sendTextMsg",content:a}),c({successful:h,msg:""})}},this.closeFramePage=function(){_.__nativeAPI("closeUrlView"),_.postChatMessage({evt:"echatjs",type:"closeFramePage",url:location.href})},this.ltIE9=_.Browser.isIE&&_.Browser.version<9,this.ltIE8=_.Browser.isIE&&_.Browser.version<8,this.initScale=function(){if(_.Browser.isMobile){var c=_.Device.getZoomLevel();1!=c&&a(".echat").css("zoom",1/c)}_.initScale=!1;for(var h,v=document.getElementsByTagName("meta"),i=0;i<v.length;i++)if(h=v[i],"viewport"==h.name||"viewport"==h.getAttribute("name")){h.setAttribute("id","echatTempViewport"),_.viewportContent=h.getAttribute("content");break}_.toggleViewport=function(a){return}},this.miniChat=function(c,h,v,g){if(1==_.echatInnerFrame)return void(_.mixedCompany?_.openEchatWin=window.open(_.getChatLink(v).chatLink):_.postChatMessage({evt:"echatjs",type:"openChat"}));var w={event:7,eventValue:{companyId:_.companyId,companyName:_.companyName}};_.__nativeAPI("echatPageStatus",w),_.publish("__newEvent",{act:100,eventAction:"echatPageStatus",eventLabel:w}),_.initScale&&_.initScale();var b=!this.miniUnfold,C=_.hasMini;0==a("#ECHAT_mini_chat").results.length&&_.initMiniHTML(),this.miniUnfold=!0,_.toggleViewport&&_.toggleViewport(!0);var y=6==h||!C&&_.visitorId&&(5==h||7==h)&&4!=_.chatStatus&&!_.Browser.isMobile&&1==a.cookie("ECHAT_"+_.companyId+"_"+_.visitorId+"_miniHide");!_.Browser.isMobile||C||6!=h&&7!=h||(y=!0),b||(y=!1),y||(a("#ECHAT_mini_icon").hide(),a.cookie("ECHAT_"+_.companyId+"_"+_.visitorId+"_miniHide","0")),_.inviteTimeout&&clearTimeout(_.inviteTimeout),a("#ECHAT_invite").hide();var I=_.data;if(c&&c.nodeType&&I.miniToBlank)return a(c).attr("target","_blank").attr("href",_.getChatLink(v).chatLink),a("#ECHAT_icon").hide(),_.publish("_openChat",{type:"blank",from:"mini"}),!0;_.Browser.isMobile&&b&&(_.windowLastTop=document.body.scrollTop||0,document.body.scrollTop=0,window.scrollTo(0,0));var T=a("body").hasClass("echat-win-show"),E=!1;if(_.hasMini)2!=_.chatStatus&&1!=_.chatStatus&&_.miniLink.replace("&miniInitHide=1","")!=_.getChatLink(v).miniLink?(_.miniLink=_.getChatLink(v).miniLink,_.setMiniSrc(_.miniLink,{replace:!0}),E=!1):!_.isMini&&_.ltIE9||"leaveToUrl"==!_.miniChatStatus?(_.offToOn||4==_.chatStatus||5==h)&&_.restartMiniChat(arguments):E=!0,_.offToOn=!1;else{if(_.hasMini=!0,a(".echat-menu-item").on("mousedown",function(e){e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0}),_.Browser.isMobile){a("body").addClass("echat-win-show");var H=document.documentElement;H&&a(H).addClass("echat-html"),_.partScreen||a("body").addClass("echat-body-hide")}_.initHistoryLength=window.history.length||0,8==h&&2!=_.chatStatus&&(v=v||{},v.autoPop="1",v.autoChat=_.miniWinParam&&1==_.miniWinParam.enableOnlineChatWhenPop?"1":"0"),_.miniLink=_.getChatLink(v).miniLink,y&&(_.miniLink+="&miniInitHide=1"),_.setMiniSrc(_.miniLink)}2!=_.chatStatus&&1!=_.chatStatus&&3!=_.chatStatus&&(_.chatStatus=0);var A={},M=document.getElementById("ECHAT_mini"),k="auto !important",B="px !important";if(!_.Browser.isMobile&&!C){_.pcMiniWinParam=a.extend({left:void 0,right:void 0,bottom:void 0,width:400,height:550,min:!0,max:!0,close:!0},_.pcMiniWinParam),g=a.extend(_.pcMiniWinParam,g||{}),A.width=(g&&g.width||400)+B,A.height=(g&&g.height||550)+B,g&&(g.left?(A.left=g.left+B,A.right=k,A.marginLeft="0px",A.marginRight="0px"):g.right&&(A.left=k,A.right=g.right+B,A.marginLeft="0px",A.marginRight="0px"),g.bottom?(A.bottom=g.bottom+B,A.top=k):g.top&&(A.bottom=k,A.top=g.top+B),g.min===!1?a(".echat-menu-item-min").addClass("hide"):a(".echat-menu-item-min").removeClass("hide"),g.max===!1?a(".echat-menu-item-max").addClass("hide"):a(".echat-menu-item-max").removeClass("hide"),g.close===!1?a(".echat-menu-item-close").addClass("hide"):a(".echat-menu-item-close").removeClass("hide"));var S="";for(var c in A)S+=";"+c+":"+A[c];M.style.cssText=M.style.cssText+S}if(M=null,a("#echat_mini_holder").removeClass("echat-hide"),_.Browser.isMobile){history.pushState&&(T||y||(_.lastHash="#TOECHAT"+(new Date).getTime(),history.pushState({title:ECHAT.LANG.onlineStaff},ECHAT.LANG.onlineStaff,location.href+_.lastHash),8==h&&_.Browser.isIOS&&"chrome"==_.Browser.browser&&_.Browser.osVersion>12&&(_.lastHash=void 0))),a("body").addClass("echat-win-show");var H=document.documentElement;H&&a(H).addClass("echat-html"),_.partScreen&&_.supportPartScreen?_.partScreen&&a("body").addClass("echat-body-fix"):a("body").addClass("echat-body-hide")}if(b&&!y){var L=a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read");_.lasGetMid&&(!L||_.lasGetMid>parseInt(L))&&a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read",_.lasGetMid,{local:!0}),_.lasGetMid&&a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read_click",_.lasGetMid,{local:!0})}return y?(_.hideMiniChat(void 0,void 0,!0),_.postMessage({action:"showMiniChat",mayNeedRestart:E,type:h,hide:!0})):(a("#ECHAT_mini").show(),this.miniUnfold=!0,_.publish("__showMiniWin",1),_.publish("__newEvent",{act:100,eventAction:"showMiniWin",eventLabel:""}),_.publish("clearGetMsg"),_.postMessage({action:"showMiniChat",mayNeedRestart:E,type:h})),_.scrollHeight=document.body.scrollHeight,!1},this.getMobileTopHeight=function(){var a;return _.Browser.isMobile&&(a=_.partScreen?_.partScreen-0:"",a&&_.supportPartScreen&&("number"==typeof a?a="top:"+a+"px;height:"+("calc(100% - "+a+"px);"):_.partScreen&&(a="top:80px;height:calc(100% - 80px);"))),a||""},this.setMiniSrc=function(c,h){if(c){var v;_.Browser.isMobile?(v='<iframe id="ECHAT_mini_chat" src="'+c+'" style="display: none;'+_.getMobileTopHeight()+'" name="ECHAT_mini_chat" scrolling="auto" border="0" allowtransparency="true" frameborder="0"></iframe>',document.getElementById("ECHAT_mini_chat")?h&&h.needReplace?(a("#ECHAT_mini_chat").remove(),a("#echat_mini_holder").append(v)):a("#ECHAT_mini_chat").attr("src",c):a("#echat_mini_holder").append(v)):a("#ECHAT_mini_chat").attr("src",c)}},this.hideMiniChat=function(c,h,v){if(_.toggleViewport&&_.toggleViewport(!1),_.hideInnerURLPage(),a.cookie("ECHAT_"+_.companyId+"_"+_.visitorId+"_miniHide","1"),this.miniUnfold!==!1){if(_.postMessage({action:"hideMiniChat"}),_.__nativeAPI("echatPageStatus",{event:8}),_.publish("__newEvent",{act:100,eventAction:"echatPageStatus",eventLabel:{event:8}}),this.miniUnfold=!1,v||_.publish("clearGetMsg"),a("#ECHAT_mini").hide(),a("#echat_mini_holder").addClass("echat-hide"),1==_.data.icon.innerEnable&&a("#ECHAT_mini_icon").show(),_.Browser.isMobile){if(!h&&c!==!0&&history.pushState&&a("body").hasClass("echat-win-show")){if(a("body").removeClass("echat-win-show").removeClass("echat-body-hide"),"MicroMessenger"!=navigator.userAgent.match(/MicroMessenger/i)&&!navigator.userAgent.match(/MQQBrowser/i))try{_.lastHash&&(_.initHistoryLength<window.history.length||-1!=location.href.indexOf(_.lastHash))&&history.back()}catch(e){}}else a("body").removeClass("echat-win-show").removeClass("echat-body-hide");var g=document.documentElement;g&&a(g).removeClass("echat-html")}else _.publish("__newEvent",{act:100,eventAction:"visitorHide",eventLabel:""});return _.Browser.isMobile&&"undefined"!=typeof _.windowLastTop&&setTimeout(function(){document.body.scrollTop=_.windowLastTop,window.scrollTo(0,_.windowLastTop)},20),_.miniWinParam&&4!=_.chatStatus&&(_.autoPopTimer&&clearTimeout(_.autoPopTimer),_.companyOff&&1==_.miniWinParam.enableOfflinePopAfterHide?_.autoPopTimer=setTimeout(function(){_.miniChat(void 0,8)},1e3*(parseInt(_.miniWinParam.offlineAutoPopHideTime)||0)):_.companyOff||1!=_.miniWinParam.enableOnlinePopAfterHide||(_.autoPopTimer=setTimeout(function(){_.miniChat(void 0,8)},1e3*(parseInt(_.miniWinParam.onlineAutoPopHideTime)||0)))),!0}},this.targetWinName="ECHAT_WIN",this.openChatWindow=function(e,a,c){if(a=a||{},!_.Browser.isMobile&&_.openEchatWin&&!_.openEchatWin.closed)try{return void _.openEchatWin.focus()}catch(h){}if(1==_.echatInnerFrame&&!_.mixedCompany)return void _.postChatMessage({evt:"echatjs",type:"openChat"});var v,g=_.getChatLink(a).chatLink;if(c){var w=window.screen.width/2,b=window.screen.height-100,C=w>900?900:w;C=600>C?600:C,b=b>600?600:b,b=500>b?500:b;var y=parseInt(c.height||_.queryParams.chatWindowParam&&_.queryParams.chatWindowParam.height||b),I=parseInt(c.width||_.queryParams.chatWindowParam&&_.queryParams.chatWindowParam.width||C),T=(window.screen.height-30-y)/2,E=(window.screen.width-10-I)/2,H=c.features||"width="+I+",height="+y+",top="+T+",left="+E+",di r ecto r ies=no ,menubar=no,t o olbar=no";return _.Browser.isMobile?_.openEchatWin=v=window.open(g,void 0,H):((2==_.chatStatus||1==_.chatStatus||"undefined"==typeof _.chatStatus)&&(_.targetWinName="ECHAT_WIN"+(new Date).getTime(),c.name&&(c.name=c.name+(new Date).getTime())),_.openEchatWin=v=window.open(g,c.name||_.targetWinName,H)),v}return _.Browser.isMobile&&!_.mixedCompany?_.miniChat(void 0,4,a):(_.openEchatWin=v=window.open(g),v)},this.surferEndChat=function(){"disconnected"!=EChatQuery.cometd.getStatus()&&window.ltIE10||!_.postMessage({action:"closeChat"})?_.publish("sendVisitorEvent",{et:107,content:ECHAT.LANG.closeInner}):"disconnected"==EChatQuery.cometd.getStatus()&&_.publish("endChat")},this.pageTitle=_.documentTitle||"",this.titles=[ECHAT.LANG.newMsg,this.pageTitle],this.showChangeTitle=!1,this.setPageTitle=function(a){return a?(this.pageTitle=a,this.titles[1]=a,!0):void 0};var y=function(){var c=a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read");_.miniUnfold&&_.lasGetMid&&c&&_.lasGetMid==parseInt(c)&&(a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read_click",_.lasGetMid,{local:!0}),_.updateBridgeRead({update:!0,type:"_mid_read_click",value:_.lasGetMid})),_.showChangeTitle=!1,_.setDocumentTitle("c")};a(window).on("focus",y).on("blur",function(){_.showChangeTitle=!0});var I="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"mozHidden"in document?"mozHidden":null,T=I&&I.replace(/hidden/i,"visibilitychange");a(window).on("focus",y).on("blur",function(){_.showChangeTitle=!0}),I&&document.addEventListener(T,function(){document[I]?_.showChangeTitle=!0:y(1)}),a(document).on("mouseover keydown touchstart",y).on("mouseout",function(){_.showChangeTitle=!0}),a("#ECHAT_mini_chat").on("mouseover keydown touchend",y);var E=function(){if("title"in document)return function(a){document.title=a};var a,t=document.getElementsByTagName("title");return t&&t[0]?a=t[0]:(a=document.createElement("title"),document.getElementsByTagName("head")[0].appendChild(a)),"textContent"in a?function(a){document.getElementsByTagName("title")[0].textContent=a}:"innerText"in a?function(a){document.getElementsByTagName("title")[0].innerText=a}:function(){}}(document);this.setDocumentTitle=function(a){if(_.showChangeTitle&&"c"!=a){if(E(_.titles[0]),!_.pageTitleTimer){var i=1;_.pageTitleTimer=setInterval(function(){E(_.titles[i++%2])},800)}}else E(_.pageTitle),clearInterval(_.pageTitleTimer),_.pageTitleTimer=null},this.refreshVisitorMetaData=function(c,h,v){c&&("disconnected"==EChatQuery.cometd.getStatus()||_.isMini===!0||1==_.echatInnerFrame?!function(){function g(a){var c,h="";for(var v in a)c=0===a[v]||a[v]===!1?a[v]+"":a[v]||"",c&&(h+=(h?"&":"")+v+"="+encodeURIComponent(c));return h}{var w={from:1,companyId:_.companyId,encryptVId:window.encryptVID,metaData:c,myData:h};_.apiServerDomain+"/refreshVisitorMetaData?"+g(w)}a.ajax({url:_.apiServerDomain+"/refreshVisitorMetaData?"+g(w),type:"jsonp",jsonpCB:"jsonpCallback",success:function(){v({successful:!0})},error:function(){v({successful:!1})}})}():_.publish("sendVisitorEvent",{et:125,metaData:c,myData:h},function(a){"function"==typeof v&&v({successful:a.successful,msg:""})}))},this.getVisitorId=function(){return _.visitorId||void 0},this.getChatPageUrl=function(a){return a?_.getChatLink(a).chatLink:_.chatLink||_.getChatLink().chatLink},this.sendTextMsgApi=function(c,h){function v(a){var c,h="";for(var v in a)c=0===a[v]||a[v]===!1?a[v]+"":a[v]||"",c&&(h+=(h?"&":"")+v+"="+encodeURIComponent(c));return h}if(c){h||(h=function(){});var g={companyId:_.companyId,visitorId:_.visitorId,encryptVId:window.encryptVID,metaData:_.metaData,content:c};_.metaData&&(g.myData=_.myData);var w=_.dataHost+"/chatapi/stm?"+v(g);a.ajax({url:w,type:"jsonp",jsonpCB:"jsonpCallback",success:function(a){h({successful:!0,msg:a})},error:function(){h({successful:!1})}})}},this.pushVisitorEvent=function(a,h){h||(h=function(){}),2!=_.chatStatus&&1!=_.chatStatus&&(_.visitorEventData=JSON.stringify(a),c());var v={et:126,customizeMsgType:a.customizeMsgType||1,dedup:0,eventId:a.eventId,title:g(a.title),content:a.content,imageUrl:a.imageUrl,url:a.url,urlForVisitor:a.urlForVisitor,urlForStaff:a.urlForStaff,memo:g(a.memo),visibility:a.visibility,urlEnableForVisitor:a.urlEnableForVisitor,closeURLPage:a.closeURLPage};"disconnected"==EChatQuery.cometd.getStatus()||_.isMini===!0||1==_.echatInnerFrame?!function(){function c(a){var c,h="";for(var v in a)c=0===a[v]||a[v]===!1?a[v]+"":a[v]||"",c&&(h+=(h?"&":"")+v+"="+encodeURIComponent(c));return h}var v={companyId:_.companyId,customizeMsgType:a.customizeMsgType||1,eventId:a.eventId,title:g(a.title),content:a.content,imageUrl:a.imageUrl,url:a.url,urlForVisitor:a.urlForVisitor,urlForStaff:a.urlForStaff,memo:g(a.memo),visibility:a.visibility,urlEnableForVisitor:a.urlEnableForVisitor,closeURLPage:a.closeURLPage,encryptVID:window.encryptVID,metadata:_.metaData,info:_.info};_.metaData&&(v.myData=_.myData),window.isEchatSdk&&(v.from=3);var w=_.dataHost+"/cms?"+c(v);_.addJS(w,function(a,c){var v=a===!0;h({successful:!v,msg:""+(v?-1:c)})})}():2==_.chatStatus||1==_.chatStatus?_.publish("sendVisitorEvent",v,function(a){h({successful:a.successful,msg:""})}):_.isReady?_.publish("sendVisitorEvent",v,function(a){h({successful:a.successful,msg:""})}):(_.visitorEventObj=v,h({successful:!1,msg:""}))},this.parseIE6Png=function(){function a(){c.onreadystatechange=null,h.removeChild(c),c=null,setTimeout(function(){DD_belatedPNG.fix(".echat-invite-reject,.echat-invite-accept,.echat-menu-item-icon,.fr"),correctPNG(!1)
},500)}var c=document.createElement("script");c.setAttribute("type","text/javascript");var h=document.getElementsByTagName("head")[0];c.onreadystatechange=function(){c.readyState&&/loaded|complete/.test(c.readyState)&&a()},c.src=this.loaderHost+"/visitor/common/lib/DD_belatedPNG_0.0.8a.js",h.appendChild(c)},this.handleInnerURLPage=function(a){"open"==a.type?w(a):_.hideInnerURLPage(a)},this.initBridge=function(){function c(){var h=a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read");h&&_.lasGetMid&&(h==_.lasGetMid||h>_.lasGetMid)&&_.publish("clearGetMsg");var w=a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read_click");w!=g&&(g=w,_.setDocumentTitle("c")),v=setTimeout(c,1e3)}var h="";if("undefined"!=typeof encryptVID&&(h=encryptVID),"undefined"!=typeof chatVisitorId&&(_.chatVisitorId=chatVisitorId),!_.Browser.isMobile){var v,g;v=setTimeout(c,1e3);var w=_.bridgeData={},b=_.loaderHost+"/visitor/surfer/bridge.html?companyId="+_.companyId+"&visitorId="+encodeURIComponent(_.chatVisitorId)+"&fromHost="+encodeURIComponent(location.origin),C=document.createElement("div");C.style.cssText="display:none",C.innerHTML='<iframe id="echatBridgeIframe" name="echatBridgeIframe" src="'+b+'"></iframe>',document.getElementsByTagName("body")[0].appendChild(C),_.handleBridge=function(c){"undefined"==typeof w.mid?(w.mid=Math.max(c.mid,a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read")||0),_.initMid=w.mid):(c.mid&&w.mid!=c.mid&&(w.mid=c.mid,_.publish("clearGetMsg",c)),w.midClick||(w.midClick=a.cookie("ECHAT_"+_.companyId+"_"+window.chatVisitorId+"_mid_read_click")||""),c.midClick&&w.midClick!=c.midClick&&(w.midClick=c.midClick,_.setDocumentTitle("c")),2==c.chatStatus&&2!=_.chatStatus&&(_.chatStatus=c.chatStatus,w.chatStatus=c.chatStatus,_.publish("initMiniChat",c)),w.chatStatus!=c.chatStatus&&(_.chatStatus=c.chatStatus),c.staffHead&&w.staffHead!=c.staffHead&&(w.staffHead=c.staffHead,_.publish("handlePureInnerChat_staffHead",c)))}}},this.subscribe("handlePureInnerChat",function(a,h){h.fromInner||!_.Browser.isMobile&&!h.refresh||_.miniChat(void 0,h.refresh?7:6,void 0),"undefined"!=typeof h.chatStatus&&(_.chatStatus=h.chatStatus),2==_.chatStatus&&(_.visitorEventData="",c())}),this.subscribe("handlePureInnerChat_staffHead",function(){}),this.addEchatInnerFrameParam=function(a){if(a){var c=a.split("#"),h=c[1]||"",v=c[0],g=-1==v.indexOf("?")?0:1;return v+(g?"&":"?")+"echatInnerFrame=1"+(h?"#":"")+h}},this.hideInnerURLPage=function(){a("#ECHAT_mini_site").remove(),_.postMessage({innerURL:"closed"})},this.posInnerURLPage=function(){},this.setChatLanRes=function(a){_.postMessage({action:"extendLanRes",lanRes:a})},this.postMessage=function(a){if(!_.hasMini||!_.miniReady)return!1;try{return(document.getElementById("ECHAT_mini_chat").contentWindow||document.frames.ECHAT_mini_chat).postMessage(a,_.loaderHost||"*"),!0}catch(e){}return!1},this.postChatMessage=function(a){if(!a||window.top==window.self)return!1;try{return a.origin=location.protocol+"//"+location.host,window.parent.postMessage(a,"*"),!0}catch(e){}return!1},this.handleKeyboard=function(){function c(c){w=0,b=0;var h="";return C=!0,v&&clearTimeout(v),c.lastMinInnerHeight?(E=H,g&&clearInterval(g),void _.postMessage({action:"innerConsole",msg:""+E})):(a("#echat_mini_holder").addClass("echat-input-focus"),function M(){w=Math.max(w,document.body.scrollTop),H=Math.min(H,window.innerHeight),g=setTimeout(M,1)}(),_.Browser.isAndroid||(v=setTimeout(function(){function c(){(A.innerHeight==window.innerHeight||T-window.innerHeight>100&&2*window.innerHeight-T>50*I)&&(B=40*I)}if(g&&clearInterval(g),v=null,C){b=window.innerHeight;var M=document.getElementById("echat_mini_holder").getBoundingClientRect().bottom,k=T-b,B=0;if(_.postMessage({action:"innerConsole",msg:";00:bottom"+document.getElementById("echat_mini_holder").getBoundingClientRect().bottom+";"+window.innerHeight+";nowInnerHeight"+b+";minInnerHeight"+H+";"+w+"</br>"}),k>100&&(M-b>5||-5>M-b)?h+="<1>":k>5&&b>H?(B=b-H,h+="<2>"):_.partScreen&&T==b&&b-H>100?(B=b-H,h+="<2-2>"):document.body.scrollTop>100&&document.body.scrollTop<w?(B=w-document.body.scrollTop,h+="<3>"):k>100&&E?(B=b-E,0==B&&c(),h+="<4>"):(h+="<5>",B=0,T-window.innerHeight>100&&A.firstIn&&!A.innerHeight&&M>300*I&&(A.innerHeight=window.innerHeight,a.cookie("input_fix_first",A.innerHeight)),"uc"!=y&&c()),B>5||-5>B){h+=B+"<>;","uc"==y?_.postMessage("inputScrollBack"):document.getElementById("echat_mini_holder").style.height="calc(100% - "+B+"px)";var S=document.createElement("div");S.className="echat-fix-input",S.style.height=B+"px",document.getElementById("echat_mini_holder").appendChild(S)}_.postMessage({action:"innerConsole",msg:h+";now bottom"+document.getElementById("echat_mini_holder").getBoundingClientRect().bottom+";bottom"+M+";firstFocus"+JSON.stringify(A)+";"+window.innerHeight+";"+b+";"+H+";"+w+"</br>"})}},650)),void setTimeout(function(){_.focusH=window.innerHeight},500))}function h(){C=!1,_.focusH=0,A.firstIn=!1,v&&clearTimeout(v),a("#echat_mini_holder").removeClass("echat-input-focus"),document.getElementById("echat_mini_holder").style.height="100%",a(".echat-fix-input").remove(),_.Browser.isMobile&&_.Browser.isIOS&&(document.body.scrollTop=0,window.scrollTo(0,0)),window.blur()}if(!_.Browser.isMobile||!window.addEventListener)return{};{var v,g,w,b,C=!1,y=_.Browser.browser,I=1/_.Device.getZoomLevel(),T=window.innerHeight,E=0,H=T,A={innerHeight:a.cookie("input_fix_first")||0,firstIn:!0};!function(){if(_.Browser.isAndroid)return null;var c=a.cookie("input_fix_inner");return c&&JSON.parse(c)||{}}()}return"safari"==y&&-1==navigator.userAgent.indexOf("Safari")&&(y="iosApp"),window.addEventListener("resize",function(){_.focusH&&window.innerHeight-_.focusH>150&&(a("#echat_mini_holder").removeClass("echat-input-focus"),_.postMessage({action:"blurInput",from:"resize"}))}),window.addEventListener("scroll",function(){!_.Browser.isAndroid&&C&&null===v&&(T-window.innerHeight>100&&E?c(-1):document.body.scrollTop<w&&c(-1))}),{focus:c,blur:h}}();var H=[];window.correctPNG=function(a){if(_.ie6&&(a&&H.push(a),"undefined"!=typeof DD_belatedPNG)){for(var i=0;i<H.length;i++){var c=H[i];"echat-mini-img-img"==c.className?b(c):DD_belatedPNG.fixPng(H[i])}H=[]}}};window.Surfer=c}(EChatQuery);
;/*!visitor/surfer/js/surfer.js*/
!function(a){function c(a,c){function h(a){if(!a)return"";var c=a.replace("-",""),h="",w=a.split("-")[0],y={zhhk:"zhtw",zhmo:"zhtw",zhcht:"zhtw",zhsg:"zhcn",jp:"ja"};if(g[c])h=c;else if(y[c])h=y[c];else for(var v in g)if(0==v.indexOf(w)){h=v;break}return h}var g={zhcn:{iconTitle:"",clickChat:"",invite:"",close:"",unfoldIcon:"",foldIcon:"",closeInner:"",rejectInvite:"",onlineStaff:"",newMsg:"...",imageMsg:"[]",fileMsg:"[]",customMsg:"[]"},enus:{iconTitle:"Conversation icon",clickChat:"Click for inqueries",invite:"Invitation window",close:"shut down",unfoldIcon:"Expand icon",foldIcon:"Close icon",closeInner:"The visitor ends the conversation from the inside page",rejectInvite:"Visitor declined to invite",onlineStaff:"Online Service",newMsg:"There is a new message...",imageMsg:"[image]",fileMsg:"[file]",customMsg:"[New Message]"},ja:{iconTitle:"",clickChat:"",invite:"",close:"",unfoldIcon:"",foldIcon:"",closeInner:"",rejectInvite:"",onlineStaff:"",newMsg:"...",imageMsg:"[]",fileMsg:"[]",customMsg:"[]"},ko:{iconTitle:" ",clickChat:" .",invite:" ",close:"",unfoldIcon:" ",foldIcon:" ",closeInner:"    .",rejectInvite:"  .",onlineStaff:"  ",newMsg:"   ...",imageMsg:"[]",fileMsg:"[]",customMsg:"[ ]"},de:{iconTitle:"Unterhaltungssymbol",clickChat:"Klicken Sie hier, um sich zu beraten",invite:"Einladungsfenster",close:"Schlieen",unfoldIcon:"Erweitern Sie das Symbol",foldIcon:"Schlieen Sie das Symbol",closeInner:"Der Besucher beendet die Konversation von der inneren Seite",rejectInvite:"Der Besucher lehnte eine Einladung ab",onlineStaff:"Online-Kundenservice",newMsg:"Sie haben neue Nachrichten ...",imageMsg:"[Bild]",fileMsg:"[Datei]",customMsg:"[Graphische Nachricht]"},fr:{iconTitle:"Icne de conversation",clickChat:"Cliquez pour consulter",invite:"Fentre d'invitation",close:"Fermer",unfoldIcon:"Dvelopper l'icne",foldIcon:"Icne de fermeture",closeInner:"Le visiteur termine la conversation depuis la page intrieure",rejectInvite:"Le visiteur a refus d'inviter",onlineStaff:"Service clientle en ligne",newMsg:"Vous avez de nouvelles nouvelles ...",imageMsg:"[photo]",fileMsg:"[Documentation]",customMsg:"[Message graphique]"},zhtw:{iconTitle:"",clickChat:"",invite:"",close:"",unfoldIcon:"",foldIcon:"",closeInner:"",rejectInvite:"",onlineStaff:"",newMsg:"...",imageMsg:"[]",fileMsg:"[]",customMsg:"[]"}},w=window.lanName=a||navigator.language||navigator.browserLanguage||"zh-CN";w=w.toLowerCase();var y=h(w);return y||(y=a?c&&h(c)||"enus":"zhcn"),g[y]}function h(a,c){function h(a){g.onload=g.onerror=g.onreadystatechange=null,w.removeChild(g),g=null,c(a)}var g=document.createElement("script");g.setAttribute("type","text/javascript");var w=document.getElementsByTagName("head")[0],y="onload"in g;y?(g.onload=h,g.onerror=function(){h(!0)}):g.onreadystatechange=function(){/loaded|complete/.test(g.readyState)&&h()},g.src=a,w.appendChild(g)}function g(){function c(c){var h;if("object"!=typeof c)return{};h=c;var g={},w={mini:1,domain:1,fastQuestion:1,companyId:1,echatTag:1,myData:1,metaData:1,info:1,routeEntranceId:1,subscribeUnread:1,lan:1,defaultLan:1,visEvt:1,pcMiniWinParam:2,chatWindowParam:2,partScreen:1,platformSign:1,loaderHost:1,pushInfo:1,echatIframeDisable:1,echatInnerFrame:1,echatTitleBar:1,businessUrl:1,businessIcon:1,multipleFile:1};for(var y in h)w[y]&&("domain"==y?(g.dataHost=C.param.dataHost=location.protocol+"//"+h.domain,C.param.loaderHost||(C.param.loaderHost=g.dataHost)):("metaData"==y||"info"==y)&&(g.vip=C.param.vip=1),g[y]=C.param[y]=w[y]>1?"object"==typeof h[y]?h[y]:"string"==typeof h[y]?JSON.parse(h[y]):void 0:"object"==typeof h[y]?JSON.stringify(h[y]):h[y]);return C.param.queryParams=a.extend(C.param.queryParams||{},c),g}if(window._echat=function(){var a,c=arguments,h=c[0];if(I[h]){a=[];for(var i=1;i<c.length;i++)a[i-1]=c[i];return I[h].apply(I,a)}},window._echat.isInit=!0,I.initParam=function(a){a&&c(a)},I.on=function(a){if(a){if("function"==typeof a.init)if(I.isInit)try{a.init()}catch(e){}else M.subscribe("__init",function(c,h){try{a.init(h)}catch(e){}});if("function"==typeof a.ready)if(I.isReady&&I.isReady())try{a.ready()}catch(e){}else M.subscribe("__ready",function(c,h){try{a.ready(h)}catch(e){}});var c;"function"==typeof a.newMsg&&M.subscribe("__newMsg",function(h,g){if("undefined"==typeof c||c!=g){c=g;try{a.newMsg(g)}catch(e){}}}),"function"==typeof a.newEvent&&M.subscribe("__newEvent",function(c,h){100==h.act?h.eventCategory="echat":200==h.act&&(h.eventCategory="analytics"),setTimeout(function(){a.newEvent(h)},1)})}},I.off=function(a){a&&M.unSubscribe(a)},window.ECHAT={on:I.on,off:I.off},"function"==typeof b&&b.q)for(var h=b.q,i=0;i<h.length;i++)("initParam"==h[i][0]||"on"==h[i][0])&&(_echat.apply(_echat,h[i]),h[i][0]=void 0);M.subscribe("__ready",function(){try{if("function"==typeof b&&b.q)for(var a=b.q,i=0;i<a.length;i++)a[i][0]&&_echat.apply(_echat,a[i])}catch(e){}})}function w(a){function c(a){var c;c="string"==typeof a?{echatTag:a}:"object"==typeof a?a:{};var h={},g={visEvt:1,lan:1,defaultLan:1,echatTag:1,info:1,myData:1,metaData:1,fastQuestion:1,routeEntranceId:1,subscribeUnread:1,echatTitleBar:1,businessUrl:1,businessIcon:1,pcMiniWinParam:2,chatWindowParam:2,partScreen:1,platformSign:1,pushInfo:1,echatIframeDisable:1,multipleFile:1};for(var w in c)g[w]&&(h[w]=g[w]>1?"object"==typeof c[w]?c[w]:"string"==typeof c[w]?JSON.parse(c[w]):void 0:"object"==typeof c[w]?JSON.stringify(c[w]):c[w]);return h}a.ec=I,I.isInit=!0,I.isReady=function(){return a.isReady},I.customOpenChat=function(h){var g=c(h);return M.publish("__newEvent",{act:200,eventAction:"Button Clicked"}),a.openChatWindow(void 0,g,!1)},I.customNewWinChat=function(h,g){var w,y,v=c(h);return M.publish("__newEvent",{act:200,eventAction:"Button Clicked"}),g=g||h&&h.windowOptions,g||(h=h||{},y=h.chatWindowParam,!g&&y&&(w={features:y.features,width:y.width,height:y.height,name:y.name}),g=w&&(w.features||w.width||w.height||w.name)?w:{features:h.features,width:h.width,height:h.height,name:h.name}),a.openChatWindow(void 0,v,g)},I.customMiniChat=function(h){var g=c(h),w=arguments[1];return!w&&h&&(w=h.pcMiniWinParam),M.publish("__newEvent",{act:200,eventAction:"Button Clicked"}),a.miniChat(void 0,4,g,w)},I.pushVisitorEvent=function(c,h){c&&(c.url||c.imageUrl||c.urlForVisitor||c.urlForStaff)&&a.pushVisitorEvent(c,h)},I.getChatPageUrl=function(h){return h&&(h=c(h)),a.getChatPageUrl(h)},I.getEchatVisitorId=function(){return a.getVisitorId()},I.refreshVisitorMetaData=function(){return a.refreshVisitorMetaData.apply(a,arguments)},I.setPageTitle=function(c){return c&&a.setPageTitle(c)},I.setMobilePageTop=function(c){a.setMobilePageHeight(c)},I.getMiniStatus=function(){return a.miniUnfold?"open":"close"},I.getChatStatus=function(){return 4==a.chatStatus?0:a.chatStatus},I.getUnReadMsgCount=function(){return a.msgNum},I.getChatStaffInfo=function(){return a.staffLabel},I.setFastQuestion=function(c){return a.fastQuestion=c||""},I.setChatLanRes=function(c){return a.setChatLanRes(c)},I.rejectInvite=function(c,h){return a.rejectInvite(c,h)},I.iconChat=function(){return M.publish("__newEvent",{act:200,eventAction:"Button Clicked"}),a.iconChat()},I.inviteChat=function(){return M.publish("__newEvent",{act:200,eventAction:"Button Clicked"}),a.inviteChat()},I.miniChat=function(){return M.publish("__newEvent",{act:200,eventAction:"Button Clicked"}),a.miniChat.apply(a,arguments)},I.hideMiniChat=function(){return a.hideMiniChat()},I.closeMiniChat=function(){return(4==a.chatStatus||"leaveToUrl"==a.miniChatStatus)&&a.hideMiniChat(),a.surferEndChat(),!0},I.maxMiniChat=function(){return a.hideMiniChat(),a.maxMiniChat()},I.sendTextMsg=function(){return a.sendTextMsg.apply(a,arguments)},I.closeFramePage=function(){return a.closeFramePage.apply(a,arguments)},I.msgBoxPageBack=function(){return a.msgBoxPageBack.apply(a,arguments)},I.showImg=function(){return a.showImg.apply(a,arguments)},window.ECHAT.isInit=!0,window.ECHAT.isReady=function(){return I.isReady()},window.ECHAT.customOpenChat=function(){return I.customOpenChat.apply(I,arguments)},window.ECHAT.customNewWinChat=function(){return I.customNewWinChat.apply(I,arguments)},window.ECHAT.customMiniChat=function(){return I.customMiniChat.apply(I,arguments)},window.ECHAT.refreshVisitorMetaData=function(){return I.refreshVisitorMetaData.apply(I,arguments)},window.ECHAT.pushVisitorEvent=function(){return I.pushVisitorEvent.apply(I,arguments)},window.ECHAT.getChatPageUrl=function(){return I.getChatPageUrl.apply(I,arguments)},window.ECHAT.getEchatVisitorId=function(){return I.getEchatVisitorId.apply(I,arguments)},window.ECHAT.setPageTitle=function(){return I.setPageTitle.apply(I,arguments)},window.ECHAT.setMobilePageTop=function(){return I.setMobilePageTop.apply(I,arguments)},window.ECHAT.getMiniStatus=function(){return I.getMiniStatus.apply(I,arguments)},window.ECHAT.getChatStatus=function(){return I.getChatStatus.apply(I,arguments)},window.ECHAT.getUnReadMsgCount=function(){return I.getUnReadMsgCount.apply(I,arguments)},window.ECHAT.getChatStaffInfo=function(){return I.getChatStaffInfo.apply(I,arguments)},window.ECHAT.setFastQuestion=function(){return I.setFastQuestion.apply(I,arguments)},window.ECHAT.setChatLanRes=function(){return I.setChatLanRes.apply(I,arguments)},window.ECHAT.rejectInvite=function(){return I.rejectInvite.apply(I,arguments)},window.ECHAT.iconChat=function(){return I.iconChat.apply(I,arguments)},window.ECHAT.inviteChat=function(){return I.inviteChat.apply(I,arguments)},window.ECHAT.miniChat=function(){return I.miniChat.apply(I,arguments)},window.ECHAT.hideMiniChat=function(){return I.hideMiniChat.apply(I,arguments)},window.ECHAT.closeMiniChat=function(){return I.closeMiniChat.apply(I,arguments)},window.ECHAT.maxMiniChat=function(){return I.maxMiniChat.apply(I,arguments)},window.ECHAT.sendTextMsg=function(){return I.sendTextMsg.apply(I,arguments)},window.ECHAT.closeFramePage=function(){return I.closeFramePage.apply(I,arguments)},window.ECHAT.msgBoxPageBack=function(){return I.msgBoxPageBack.apply(I,arguments)},window.ECHAT.showImg=function(){return I.showImg.apply(I,arguments)}}function y(c){function h(){a("body").hasClass("echat-win-show")&&g.hideMiniChat(!0)}var g=new Surfer,y=new Connect;c&&c.inChatPage&&(g.inChatPage=!0),ECHATObjKeyMap.cometdId=y,ECHATObjKeyMap.surferId=g,y.setSub("surferId"),g.setSub("cometdId"),g.setSub("surferId"),g.setSub("outerId"),g.connect=y,y.surfer=g,M.initPostIframeMessage&&M.initPostIframeMessage(g),w(g);var v=document.createElement("link");v.rel="stylesheet",v.type="text/css",v.href=C.param.loaderHost+"/visitor/surfer/css/surfer_001c46f.css",v.media="screen";var I=document.getElementsByTagName("head")[0];I.appendChild(v),a.store(C.param.domain+"_"+C.param.companyId+"_encryptVID",encryptVID),a.store(C.param.domain+"_"+C.param.companyId+"_chatVisitorId",chatVisitorId),E(g),E=null,C.setParam(g),C.setParam(y),C.setParam(window.ECHATConfig),g.apiServerDomain=g.dataHost+"/chatapi",g.pcMiniWinParam=g.pcMiniWinParam||{},C=null,c&&c.encryptVID?(g.visitorId=c.visitorId,y.visitorId=y.visitorId,window.isEchatSdk||c.metaData||!g.metaData?(window.isEchatSdk&&(g.metaData=c.metaData,g.myData=c.myData),M.publish("__init"),g.isReady=!0,g.publish("__ready")):(g.initBridge(),y.join(),M.publish("__init"),g.unSubscribe("handshake"),g.subscribe("handshake",function(){g.publish("endSurfer"),g.isReady=!0,g.publish("__ready"),y.unSubscribe("initMiniChat")}))):1==g.echatInnerFrame||M.mixedCompany?(M.publish("__init"),g.isReady=!0,g.publish("__ready"),g.mixedCompany=M.mixedCompany):(g.initBridge(),y.join(),M.publish("__init")),M.hadInitEvent=!0,-1!=g.loaderHost.indexOf("https:")&&(g.needHttps="https:"),g.Browser.isMobile&&history.pushState&&setTimeout(function(){window.addEventListener("popstate",function(){h()})},2e3),g.__nativeAPI("echatPageStatus",{event:5})}function v(){window.isEchatClient||a(function(){window.encryptVID=a.store(C.param.domain+"_"+C.param.companyId+"_encryptVID"),window.chatVisitorId=a.store(C.param.domain+"_"+C.param.companyId+"_chatVisitorId"),encryptVID&&chatVisitorId&&chatVisitorId+""!="null"&&encryptVID+""!="null"?y():h(C.param.dataHost+"/ysc?companyId="+C.param.companyId+"&t="+(new Date).getTime(),y)})}var I={},C=function(){function a(a){var m=a.match(v);return m&&m[0].substr(1)}function c(a){return a.hasAttribute?a.src:a.getAttribute("src",4)}{var h,g,w,y,v=/[?#][^?#]*/,I="undefined"==typeof window&&"undefined"!=typeof importScripts&&isFunction(importScripts),C=/^(about|blob):/;!location.href||C.test(location.href)?"":a(location.href)}if(I){var b;try{var E=new Error;throw E}catch(e){b=e.stack.split("\n")}b.shift();for(var m,M=/.*?((?:http|https|file)(?::\/{2}[\w]+)(?:[\/|\.]?)(?:[^\s"]*)).*?/i,S=/(.*?):\d+:\d+\)?$/;b.length>0;){var T=b.shift();if(m=M.exec(T),null!=m)break}var _;if(null!=m)var _=S.exec(m[1])[1];h=_}else{var H=document,P=H.scripts,A=H.getElementById("echatmodulejs")||P[P.length-1]||{};h=c(A)||""}if(h&&-1==h.indexOf("//")&&(h=location.protocol+"//"+h),"undefined"!=typeof _echatServer&&"[object Array]"===Object.prototype.toString.apply(_echatServer)){var r=parseInt(Math.random()*_echatServer.length);(r||0===r)&&_echatServer[r]&&(g=_echatServer[r]),h||(h=w=location.protocol+"//"+(g.match(/^([^\.]+)s\./)?g:g.replace(/^([^\.]+)\./,"$1s.")))}else h||(g="e.echatsoft.com",h=w=location.protocol+"//es.echatsoft.com");w||(w=/^(http[s]?:\/\/[^\/]+).*/g.exec(h)[1],"https:"==location.protocol&&(w=w.replace("http:","https:"))),y=w.split("//")[1],g||(g=w.split("//")[1].replace(/^([^\.]+)s\./,"$1."));var V=function(a){var c={};if("string"!=typeof a)return c;-1!=a.indexOf("#")&&(a=a.substring(0,a.indexOf("#"))),-1!=a.indexOf("?")&&(a=a.substring(a.indexOf("?")+1));for(var h,g=a.split("&"),w=g.length,i=0;w>i;i++)g[i]&&(h=g[i].split("="),h[0]&&h[1]&&(c[h[0]]=decodeURIComponent(h[1]),c[h[0].toLowerCase()]=c[h[0]]));return c}(h),p={param:{},setParam:function(a){if(a){for(var c in p.param)"undefined"!=typeof p.param[c]&&(a[c]=p.param[c]);"1"==p.param.mini&&(a.isMini=!0)}}};g=g.replace(/www\.echatsoft\./,"e.echatsoft.").replace(/www\.rainbowred\./,"v.rainbowred."),p.param.dataHost=(-1!=w.indexOf("https:")?"https:":"http:")+"//"+g,p.param.loaderHost=w;for(var k=["companyId","lan","defaultLan","echatTag","metadata","info","myData","routeEntranceId","subscribeUnread","echatTitleBar","businessUrl","businessIcon","visEvt","mini","echatInnerFrame","pushInfo","platformSign","echatIframeDisable","multipleFile"],i=0,D=k.length;D>i;i++)p.param[k[i]]=V[k[i].toLowerCase()]||void 0;p.param.domain=y,p.param.vip=p.param.metaData||p.param.info?1:void 0;try{p.param.pcMiniWinParam=V.pcMiniWinParam?JSON.parse(V.pcMiniWinParam):{},p.param.chatWindowParam=V.chatWindowParam?JSON.parse(V.chatWindowParam):void 0}catch(e){}return p.param.queryParams=V,V.partscreen&&(p.param.partScreen=V.partscreen),window.top!=window&&-1!=location.href.indexOf("echatInnerFrame=1")&&(p.param.echatInnerFrame=1),p}(),b=window._echat,E=function(c){var f=a.cookie("echat_firsturl");f||(a.cookie("echat_firsturl",location.href),a.cookie("echat_firsttitle",function(){if("title"in document)return document.title||"";var a,t=document.getElementsByTagName("title");return t&&t[0]?(a=t[0],"textContent"in a?a.textContent||"":"innerText"in a?a.innerText||"":""):(a=document.createElement("title"),document.getElementsByTagName("head")[0].appendChild(a),"")}(document))),c.firstUrl=a.cookie("echat_firsturl"),c.firstTitle=a.cookie("echat_firsttitle")||""},M=ECHATObjKeyMap.outerId;if(M||(M={},UTIL.call(M,!0),ECHATObjKeyMap.outerId=M,M.setSub("outerId")),!window._echat||!_echat.isInit){if(g(),!C.param.companyId)return void M.publish("error",{msg:"There is not companyId"});if(12363!=C.param.companyId||location.host.match(/(ledmary\.net|ledmary.com|mrled\.cn|mrledipsly.com)$/))return ECHAT.LANG=c(C.param.lan,C.param.defaultLan),((window.isEchatSdk=window.top==self&&(navigator.userAgent.match(/Echat_WKWeb/i)||window.EchatJsBridge))||window.top!=self&&window.addEventListener)&&(window.top.postMessage({evt:"echatjs",type:"echatInnerFrame",origin:location.protocol+"//"+location.host},"*"),M.initInnerSurfer=function(a){M.initInnerSurfer=null,a&&a.encryptVID&&(C.param.echatInnerFrame=1,C.param.companyId!=a.companyId?(M.mixedCompany=!0,v()):(window.encryptVID=a.encryptVID,window.chatVisitorId=a.chatVisitorId,y(a)))},isEchatSdk)?(window.setVisitorInfo=function(a){a="string"==typeof a?JSON.parse(a+""):a,M.initInnerSurfer&&M.initInnerSurfer(a),delete window.setVisitorInfo},void(window.EchatJsBridge?EchatJsBridge.callEchatNative('{"functionName": "getVisitorId","callback":"setVisitorInfo"}'):window.webkit&&window.webkit.messageHandlers.callEchatNative.postMessage('{"functionName": "getVisitorId","callback":"setVisitorInfo"}'))):void(window.top!=self&&window.addEventListener?(setTimeout(function(){M.hadInitEvent||(M.initInnerSurfer=null,v())},300),setTimeout(function(){try{window.parent.postMessage({evt:"echatjs",type:"echatInnerFrame",origin:location.protocol+"//"+location.host},"*")}catch(e){}},50),window.addEventListener&&window.addEventListener("message",function(e){if(e.data){if(e.data&&"echatInnerFrameCallback"==e.data.type)!M.initInnerSurfer,M.initInnerSurfer&&M.initInnerSurfer(e.data);else if("echatClient"==e.data.type)M.initInnerSurfer=null,window.isEchatClient=!0;else if("echatViewImg"==e.data.type&&data.imgList&&data.imgList.length)return ECHAT.showImg(data);M.initInnerSurfer&&M.initInnerSurfer(e.data)}})):(window.addEventListener&&window.addEventListener("message",function(e){if(e.data){var a=e.data,c=e.source;if("echatjs"!=a.evt||I.isReady&&I.isReady()){if("echatjs"==a.evt&&"echatViewImg"==a.type&&a.imgList&&a.imgList.length)return ECHAT.showImg(a)}else"echatInnerFrame"==a.type&&c&&(M.initPostIframeMessage=function(h){M.initPostIframeMessage=null;try{c.postMessage({type:"echatInnerFrameCallback",companyId:h.companyId,visitorId:h.visitorId,chatVisitorId:window.chatVisitorId,encryptVID:window.encryptVID,metaData:h.metaData||""},a.origin)}catch(e){}})}}),v()))}}(EChatQuery);